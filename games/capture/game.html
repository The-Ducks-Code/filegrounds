<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8" />
        <title>Capture [Game]</title>
        <link rel="stylesheet"
            href="https://fonts.googleapis.com/css?family=Tinos&display=swap">
        <style>
            /* People tend to think that this is a shorthand for the body element selector and therefore, everthing will inherit the following properties. However, this is the universal selector. That means that every element will have these properties applied to them. What does that mean? The children of elements that have had these properties changed won't inherit those changed properties. Additionally, some properties aren't inherited so they won't be applied to every element if you use the body element selector */
            * {
                margin: 0;
                overflow: hidden;
                animation-fill-mode: both; /* This is actually standard and existant */
                animation-duration: 0.2s; /* All other elements will inherit this */
            }
            
            :root {
                --bold-red: rgb(199, 47, 24);
            }
            
            @keyframes fadeIn {
                from {
                    opacity: 0%;
                }
                
                to {
                    opacity: 100%;
                }
            }
            @keyframes fadeOut {
                from {
                    opacity: 100%;
                }
                
                to {
                    opacity: 0%;
                }
            }
            @keyframes slideIn {
                from {
                    top: -650px;
                }
                
                to {
                    top: 0px;
                }
            }
            @keyframes slideOut {
                from {
                    top: 0px;
                }
                
                to {
                    top: -650px;
                }
            }
            @keyframes rot {
                from {
                    transform: rotate(0turn);
                }
                
                to {
                    transform: rotate(1turn);
                }
            }
            @keyframes sax {
                /*As in saxophone*/
                from {
                    left: 400px;
                    transform: scale(0) rotate(0turn);
                    
                }
                50% {
                    transform: scale(1) rotate(1turn);
                }
                to {
                    left: 200px;
                    transform: scale(0) rotate(2turn);
                }
            }
            @keyframes fall {
                from {
                    transform: translate3d(-400px, -400px,0px) rotate3d(1,1,1, -500deg);
                }
                to {
                    transform: translate3d(0px, 0px, 0px) rotate3d(1,1,1, 0deg);
                }
            }
            
            
            canvas {
                position: absolute;
                left: 0px;
                top: 0px;
                z-index: 0;
            }
            img {
                position: absolute;
                width: 400px;
                filter: invert(85.9%);
                display: none;
            }
            div {
                position: absolute;
                left: 0px;
                top: 0px;
                background-color: rgb(36, 36, 36);
                transform-origin: center;
                z-index: 12 !important;
            }
            section {
                position: absolute;
                left: 0px;
                top: 0px;
                display: block;
            }
            strong {
                color: var(--bold-red);
            }
            a {
                display: block;
                cursor: pointer;
                color: var(--bold-red);
                width: min-content;
            }
            button {
                font-family: 'Tinos',serif;
                font-weight: bold;
                font-size: 20px;
                color: var(--bold-red);
                background-color: white;
                border-style: solid;
                border-color: rgb(36, 36, 36);
                border-radius: 5px;
            }
            button:hover {
                cursor: pointer;
            }
            input {
                background-color: rgb(0, 0, 0, 0);
                border: none;
                caret-color: transparent;
            }
            input:focus {
                outline: none;
                text-decoration: underline;
            }
            input::placeholder, input {
                font-weight: bold;
                font-family: 'Tinos', serif;
                font-size: 26px;
                color: var(--bold-red);
            }
            
            .frame {
                background-color: rgb(36, 36, 36);
            }
            .message, .fire, .o-text {
                position: absolute;
                user-select: none;
                top: 5000px;
                color: rgb(36, 36, 36);
                background-color: rgb(252, 252, 252);
                padding: 4px;
                z-index: 11;
                width: 200px;
                border-color: rgb(36, 36, 36);
                border-width: 2px;
                border-style: solid;
                border-radius: 10px;
            }
            .glass {
                background-color: rgb(255, 255, 255, 0.9);
                /*animation-name: slideIn;*/
                animation-duration: 1s;
                text-align: center;
                font-size: 1.5em;
                color: rgb(36, 36, 36);
                border-radius: 0px 0px 50px 50px;
                backdrop-filter: blur(10px); /*Glassmorphism*/
            }
            .totem {
                position: absolute !important;
                /*animation-delay: 0.7s;*/
                /*animation-duration: 0.5s;*/
                /*animation-name: fadeIn;*/
                /*left: -300px;*/
                /*top: -300px;*/
                
                animation-duration: 2s;
                animation-timing-function: ease-out;
            }
            .end {
                position: absolute;
                margin: auto;
                z-index: 15 !important;
                width: 100%;
                height: 100%;
                background-color: rgb(0, 0, 0, 0);
                text-align: center;
                overflow-y: scroll;
                color: rgb(36, 36, 36);
                background-color: rgb(255, 255, 255);
                display: none;
            }
            .seperator {
                position: relative;
                margin: auto;
                background-color: rgb(36, 36, 36);
                width: 420px;
                height: 3px;
                border-style: solid;
                border-radius: 5px;
                border-width: 1px;
            }
            
            #start {
                display: block;
            }
            #death-overlay {
                animation-name: fadeOut;
                pointer-events: none;
            }
            #overlay, #oCanvas {
                pointer-events: none;
            }
            #tell-time {
                width: 100px;
                position: absolute;
                margin: auto;
                z-index: 16;
                background-color: rgb(0, 0, 0, 0);
                text-align: center;
                font-size: 25px;
            }
            #oCanvas {
                pointer-events: none;
            }
            #thumbnail {
                all: initial;
                cursor: pointer;
            }
            #saxophone {
                top: 245px;
                width: 50px;
                filter: none;
                margin-left: -25px;
                animation-duration: 0.7s;
                animation-timing-function: linear;
            }
            #help {
                z-index: 10;
                top: -650px;
                width: 600px;
                height: 650px;
            }
            #settings-spine {
                /*It's a wierd name but it gets the point across*/
                position: absolute;
                left: 170px;
                top: 140px;
                background-color: rgb(36, 36, 36);
                width: 3px;
                height: 125px;
                border-radius: 5px;
            }
            #gear {
                animation-duration: 2s;
            }
            #gear:hover {
                animation-name: rot;
                cursor: pointer;
            }
            #time {
                position: absolute;
                top: 0px;
                left: calc(100% - 80px);
                margin: 2px 0px 0px -4px;
                font-size: 20px;
                width: 80px;
                text-align: right;
                z-index: 11;
                color: var(--bold-red);
                font-weight: bold;
                background-color: transparent;
                display: none;
            }
            #totem-construct {
                overflow: initial;
                width: 400px;
                height: 400px;
                left: 100px;
                top: 100px;
                border-radius: 50px 50px 50px 50px;
                animation-duration: 0.2s;
            }
            #totem-back {
                left: 0px;
                top: 0px;
            }
            #totem-back-container {
                overflow: initial;
                position: relative;
                background-color: rgb(0, 0, 0, 0);
                margin: 0 auto;
                left: -20px;
                width: 200px;
                height: 200px;
            }
            #totem-close {
                background-color: rgb(255, 255, 255);
            }
            #incorrect-width {
                position: relative;
                margin: auto;
                top: 60px;
                width: 70%;
                height: 520px;
                background-color: transparent;
                text-align: center;
                z-index: 100px;
                display: none;
            }
        </style>
    </head>
    <body style = 'background-color: rgb(252, 252, 252)'>
    <img id = 'camera' src = 'https://upload.wikimedia.org/wikipedia/commons/c/c2/OOjs_UI_icon_camera-invert.svg'>
    <canvas id = 'back' width = '600' height = '600' style = 'background-color: rgb(252, 252, 252); z-index: -4;'></canvas>
    <canvas id = 'canvas' width = '600' height = '600' style = 'z-index: 0;'></canvas>
    <canvas id = 'next-level' width = '600' height = '600' style = 'z-index: 0;'></canvas>
    <canvas id = 'capture-preview' width = '280' height = '280' style = 'display: none'></canvas>
    <canvas id = 'particles' width = '600' height = '600' style = 'z-index: -1;'></canvas>
    <canvas id = 'wind-particles' width = '600' height = '600' style = 'z-index: -3;'></canvas>
    <canvas id = 'back-blocks' width = '600' height = '600' style = 'z-index: -2;'></canvas>
    
    <canvas id = 'player-canvas' width = '80' height = '55' style = 'z-index: 10;'></canvas>
    <canvas id = 'tutorial-canvas' width = '55' height = '55' style = 'z-index: 10;'></canvas>
    <canvas id = 'chaser-canvas' width = '600' height = '600' style = 'z-index: 10;'></canvas>
    
    <!--All of the tutorial dialouge-->
    <div class = 'message' id = 'start'>
        <strong style = 'color: rgb(36, 36, 36)'>Would you like to activate the tutorial?</strong>
        <a onclick = 'activate(true);'><strong>Yes</strong></a>
        <a onclick = 'activate(false);'><strong>No</strong></a> 
    </div>
    <div class = 'message'>Hi! I'm duck! (press <strong>ctrl</strong> to continue)</div>
    <div class = 'message'>Before we get started, you should know that I will <strong>always</strong> close this dialouge box when I don't have anymore to say.</div>
    <div class = 'message'>Let's begin! Use the <strong>arrow keys</strong> or <strong>w, a, s, d</strong> to move. However, this can be changed in the settings. <canvas id = 'tutorial-gear' width = '15' height = '15' style = 'position: relative; top: 3px;'></canvas></div>
    <div class = 'message'>Come with me! >:)</div>
    <div class = 'message'>blank</div>
    <div class = 'message'>The entire world is <strong>connected</strong>. The only things that are preventing you from going somewhere are your own <strong>abilities</strong>.</div>
    <div class = 'message'>blank</div>
    <div class = 'message'>Case and point.</div>
    <div class = 'message'>blank</div>
    <div class = 'message'>"Why is there a dubious looking coffee table at the top of a staircase?"<br><br>"Are we going to have brunch?"<br><br>And "You again? I don't need your help" are all great questions that you should be asking yourself right now.</div>
    <div class = 'message'>Well, not the last one. That hurt.</div>
    <div class = 'message'>That coffee table isn't actually a coffee table at all, it's a <strong>checkpoint</strong>! Walk over to it activate it. Once magical flames start to roast your feet, your progress is <strong>saved</strong>.</div>
    <div class = 'message'>You can actually <strong>delete the tab</strong> and you will spawn back here if you reopen it.</div>
    <div class = 'message'>blank</div>
    <div class = 'message'>Hi again! You just got a new ability: the <strong>Double Jump</strong>.</div>
    <div class = 'message'>When <strong>in the air</strong>, you can jump a second time.</div>
    <div class = 'message'>blank</div>
    <div class = 'message'>Hello!</div>
    <div class = 'message'>Falling out of the sky hurts your knees. Don't do it too often.</div>
    <div class = 'message'>Either way, <strong>congratulations</strong>! You got a new ability: the <strong>dash</strong>.</div>
    <div class = 'message'>Press the <strong>spacebar</strong> when you are <strong>in the air</strong> to dash. You'll be shot forward in the direction that you are facing.</div>
    <div class = 'message'>Once the dash is used, you turn a dark, depleted color. Your dash is restored when you <strong>touch the ground</strong>.</div>
    <div class = 'message'>blank</div>
    <div class = 'message'>You just got the <strong>dive</strong> ability!</div>
    <div class = 'message'>It can break <strong>soft</strong> blocks. These blocks have <strong>dust</strong> falling out of them.</div>
    <div class = 'message'>Press the <strong>down</strong> arrow key or <strong>s</strong> to use it when you are <strong>in the air</strong>.</div>
    <div class = 'message'>blank</div>
    <div class = 'message'>Whenever you pop up like that, you can <strong>dive</strong> to open the pathway.</div>
    <div class = 'message'>blank</div>
    <div class = 'message'>You seem to have aquired the <strong>camera</strong>!</div>
    <div class = 'message'>Press <strong>alt</strong> to bring it up.</div>
    <div class = 'message'>You can copy these <strong>tinted blocks</strong>. Press <strong>shift</strong> to do so.</div>
    <div class = 'message'>As you can tell, there's a reminder of the photo you <strong>captured</strong>. The red squares are where you tried to copy regular blocks.</div>
    <div class = 'message'>To place down your photo, press <strong>shift</strong> again. Just make sure the preview isn't off the screen or else it won't work. Where the red squares are <strong>won't</strong> be affected.</div>
    <div class = 'message'>Oh, and one last thing, you can press <strong>r</strong> to reset the room you're in.</div>
    <div class = 'message'>blank</div>
    <div class = 'message'>This <strong>border</strong> won't hurt you, but it will <strong>erase</strong> your <strong>photo</strong>.</div>
    <div class = 'message'>blank</div>
    <!--This is a really strange event that happens. If you were paying attention to lore, just know that this has no correlation-->
    <div class = 'message'>Here, take a saxophone.</div>
    <div class = 'message'>blank</div>
    <div class = 'message'>blank</div>
    <div class = 'message'>blank</div>
    <div class = 'message'>blank</div>
    <div class = 'message'>Yo dawg...</div>
    <div class = 'message'>...thx! u look good to. can u help me with somthing tho? something jazzy pls...</div>
    <div class = 'message'>...Thank you for you time and assistance. Best regards, Duck</div>
    <div class = 'message'>blank</div>
    <div class = 'message'>blank</div>
    <div class = 'message'>blank</div>
    <div class = 'message'>blank</div>
    <div class = 'message'>blank</div>
    <div class = 'message'>blank</div>
    <div class = 'message'>You seem emotionally distressed. Would you like a <strong>carrot</strong>?
        <a onclick = 'carrot(true);'><strong>Yes</strong></a>
        <a onclick = 'carrot(false);'><strong>No</strong></a>
    </div>
    <div class = 'message'>Click on the <strong>carrot</strong>:<br>
        <input id = 'carrotEl' type = 'color' value = '#c72f18'>
    </div>
    <div class = 'message'>blank</div>
    <div class = 'message'><strong>You do not understand the true power of the CARROT!</strong></div>
    <div class = 'message'>blank</div>
    
    <!--Storyteller's monolouge-->
    <div class = 'fire'>Hey! I don't recognize you. How did you get over here? (press <strong>ctrl</strong> to continue)</div>
    <div class = 'fire'>...</div>
    <div class = 'fire'>... Can you talk?</div>
    <div class = 'fire'>...</div>
    <div class = 'fire'>Got a mouth...?</div>
    <div class = 'fire'>...</div>
    <div class = 'fire'>Guess not??</div>
    <div class = 'fire'>
        Would you like to know what this place is?
        <a onclick = 'storyTeller.next();'><strong>Yes</strong></a>
        <a onclick = 'storyTeller.next(25);'><strong>No</strong></a> 
    </div>
    
    <!--Player says that they want to hear lore-->
    <div class = 'fire'>Well, I'm glad that you can at least hear.</div>
    <div class = 'fire'>It really can get boring tending to this fire.</div>
    <div class = 'fire'>We people here used to live in a fortress on the other side of the <strong>Erg</strong>.</div>
    <div class = 'fire'>On days when the wind slows, we can see it and the floating islets.</div>
    <div class = 'fire'>However, our land here is prone to tremors... it's due to a fault line a ways over to the left.</div>
    <div class = 'fire'>The tremors has been growing for a long while, even before I came into this world.</div>
    <div class = 'fire'>Soon they became too strong to be safe, and my peoples' ancestors came here, onto the <strong>Erg</strong> where the tremors aren't as strong.</div>
    <div class = 'fire'>They built this place, where I and the others stay.</div>
    <div class = 'fire'>...</div>
    <div class = 'fire'>The fault line's plates have long diverged, leaving that pit that you crossed.</div>
    <div class = 'fire'>It's too wide for us to get across now...</div>
    <div class = 'fire'>How did you even get here?</div>
    <div class = 'fire'>... Anyways, in the fortress there were fires everywhere, fires like this one. The one here was taken when my ancestors left... And now I'm stuck tending to it. I can't understand why they left it outside... <em>in the wind...</em></div>
    <div class = 'fire'>You're welcome to look around. The entrance to the rest of this place is hidden so you can't do any damage.</div>
    <div class = 'fire'>Why? You might break something!</div>
    <div class = 'fire'>Well?... Stop staring! Haha!</div>
    <div class = 'fire'>blank</div>
    
    <!--Player says that they don't want to hear the lore-->
    <div class = 'fire'>Oh, okay. You're welcome to look around though. The entrance to the reset of this place is hidden so you can't do any damage.</div>
    <div class = 'fire'>blank</div>
    
    <!--Comming back from dash-->
    <div class = 'fire'>Oh, and one last thing...</div>
    <div class = 'fire'>It's a tradition here to carve totems. If you remember, could you bring me a totem from the fortress? It would be really fun to have an older one.</div>
    <div class = 'fire'>Good luck on your journey!</div>
    <div class = 'fire'>blank</div>
    
    <!--Comes back later-->
    <div class = 'fire'>Hi again! I'm glad to see that you're okay.</div>
    <div class = 'fire'>Did you find any totems?</div>
    <div class = 'fire'>You did! May I have it?
        <a onclick = 'storyTeller.next();'><strong>Yes</strong></a>
        <a onclick = 'storyTeller.next(storyTeller.messages.length-2);'><strong>No</strong></a>
    </div>
    <div class = 'fire'>Aw! You have a good heart!</div>
    <div class = 'fire'>blank</div>
    <div class = 'fire'>Then why are you here.</div>
    <div class = 'fire'>blank</div>
    
    <canvas id = 'overlay' class = '3d' width = '600' height = '600' style = 'z-index: 14; display: block; box-shadow: 0px 0px 15px rgb(252, 252, 252);'></canvas>
    <canvas id = 'oCanvas' width = '600' height = '600' style = 'z-index: 16; position: absolute;'></canvas>
    <img id = 'saxophone' src = 'https://upload.wikimedia.org/wikipedia/commons/e/e0/Saksofon_altowy_Serie_III_GP_firmy_Selmer.jpg'>
    <div id = 'help' class = 'glass'>
        <h1>Settings</h1>
        <p>
            Change keys bindings for actions<br>
            Click on the current binding and type to change
        </p>
        <br>
        <div id = 'settings-spine'></div>
        <!--Try changing this section to a <p> (both the opening and closing tags). This editor doesn't like nested <p>'s in this way (at least for me)-->
        <section id = 'controls' style = 'position: relative; text-align: left; left: 178px;'>
        
            <p>Left - <input id = 'left' spellcheck = 'false' placeholder = 'Left or A' maxlength = '1' style = 'position: relative; width: 180px; height: 30px;'></p>
            
            <p>Right - <input id = 'right' spellcheck = 'false' placeholder = 'Right or D' maxlength = '1' style = 'position: relative; width: 180px; height: 30px;'></p>
            
            <p>Jump - <input id = 'up' spellcheck = 'false' placeholder = 'Up or W' maxlength = '1' style = 'position: relative; width: 180px; height: 30px;'></p>
            
            <p style = 'display: none;'>Dive - <input id = 'down' spellcheck = 'false' placeholder = 'Down or S' maxlength = '1' style = 'position: relative; width: 180px; height: 30px;'></p>
            
            <p style = 'display: none;'>Dash - <input id = 'dash' spellcheck = 'false' placeholder = 'Space' maxlength = '1' style = 'position: relative; width: 180px; height: 30px;'></p>
            
            <p style = 'display: none;'>Open/Close Camera - <input id = 'camera' spellcheck = 'false' placeholder = 'Alt' maxlength = '1' style = 'position: relative; width: 180px; height: 30px;'></p>
            
            <p style = 'display: none;'>Take/Place Photo - <input id = 'photo' spellcheck = 'false' placeholder = 'Shift' maxlength = '1' style = 'position: relative; width: 180px; height: 30px;'></p>
            
            <p style = 'display: none;'>Reset Level - <input id = 'reset' spellcheck = 'false' placeholder = 'R' maxlength = '1' style = 'position: relative; width: 180px; height: 30px;'></p>
            
            <p>Continue (dialogue) - <input id = 'continueD' spellcheck = 'false' placeholder = 'Control' maxlength = '1' style = 'position: relative; width: 180px; height: 30px;'></p>
            
        </section>
        <br>
        <button onclick = 'keys = {
            dash: " ",
            camera: "alt",
            photo: "shift",
            reset: "r",
            continueD: "control",
        };
        let inputs = document.querySelectorAll(&apos;input:not([type="checkbox"], [type="color"], #copy-cat)&apos;);
        for (const i of inputs) {
            i.value = "";
        }'>Reset Controls</button>
        <br>
        <br>
        <p id = 'show-time-clicky-holder' onclick = 'clickShowTime();' style = 'display: none;'><label style = 'pointer-events: none;'>Show Time <input id = 'show-time' type = 'checkbox'></label></p>
        <button onclick = 'restart();'>Restart</button>
    </div>
    <div id = 'totem-construct' class = 'glass' style = 'display: none;'>
        <h1 style = 'position: relative; top: 10px;'>Totem</h1><br>
        <p>Fragments <strong><span id = 'fragments'>0</span></strong> of <strong>3</strong> aquired</p>
        <div id = 'totem-back-container'>
            <canvas id = 'totem-back' class = 'totem' width = '200' height = '200'></canvas>
            <canvas id = 'totem-feet' class = 'totem' width = '200' height = '200' style = 'display: none;'></canvas>
            <canvas id = 'totem-fin'  class = 'totem' width = '200' height = '200' style = 'display: none;'></canvas>
            <canvas id = 'totem-body' class = 'totem' width = '200' height = '200' style = 'display: none;'></canvas>
        </div>
        <button id = 'totem-close' onclick = 'totemConstruct.style.animationName = "fadeOut"; timers.add(() => totemConstruct.style.display = "none", 200); notCutscene();'>Close</button>
    </div>
    
    <div id = 'time' title = 'Feeling the pressure?'>0</div>
    
    <!--To use the meme, spacing go <br>-->
    <div id = 'end' class = 'end' style = ''>
        <br>
        <br>
        <br>
        <br>
        <h1 style = 'font-size: 3em;'>Thank You for Playing!</h1>
        <div class = 'seperator'></div>
        <br>
        <br>
        <h2>You traversed the world in <strong><span id = 'end-time'>X</span></strong> seconds!<br>
        You can submit your score to the leaderboard<br>
        if it is under <strong>30</strong> minutes.</h2>
        <br>
        <input id = 'copy-cat' style = 'display: none;'>
        <button id = 'copy-button' onclick = 'copy(); document.getElementById("copy-button").textContent = "Copied!";'>Copy Score Code</button>
        <br>
        <br>
        <h2>Leaderboard:</h2>
        <strong>1:22:42</strong> - Aqua Willy
        <strong>2:30:39</strong> - 𝑻𝑯𝑬 𝑷𝑳𝑨𝑮𝑼𝑬
        <strong>i s</strong> - Spleen
        <br>
        <br>
        <h2>Special Thanks To:</h2>
        <h3><strong>My Playtesters:</strong></h3>
        Kopter Coding<br>
        21262<br>
        HB_the_Pencil<br>
        ski<br>
        
        <h3><strong>Vexcess:</strong></h3>
        For his imagenator.
        <h3><strong>Spleen:</strong></h3>
        For making the thumbnail<br>
        and being the preliminary<br>
        playtester.
        <br>
        <br>
        
        <img id = 'thumbnail' src = 'https://www.khanacademy.org/computer-programming/thumbnail/5916336713678848/5291588791091200.png' onclick = 'window.open("https://www.khanacademy.org/computer-programming/thumbnail/5916336713678848");'>
        
        <br>
        <br>
        <button onclick = 'reenter();' title = "Do a nice deed">Re-enter World </button>
        <button onclick = 'restart();' title = "For a better score">Restart run</button>
        <br>
        <h6>© 2022 Henry under the <a href = 'https://opensource.org/licenses/mit-license.php' style = 'display: inline;'>MIT license</a></h6>
    </div>
    <div id = 'final' class = 'end'>
        <br>
        <br>
        <br>
        <br>
        <h1 style = 'font-size: 3em;'>Thank You for Playing!</h1>
        <div class = 'seperator'></div>
        <br>
        <br>
        <p style = 'width: 250px; margin: auto; font-size: 20px;'>
            It's really over now.<br>
            I hope you enjoyed! If you have any feedback, suggestions, or things you liked, please let me know! I'm always looking to improve in both programming and game design.
        </p>
        
        <br>
        <br>
        <button onclick = 'restart();' title = "For a better score">Restart run</button>
    </div>
    
    <div id = "incorrect-width">
        <h1 style = 'font-size: 50px;'><strong>Incorrect Width</strong></h1>
        <div class = 'seperator' style = 'background-color: var(--bold-red); width: 270px; border-color: transparent;'></div>
        <br>
        <br>
        <p style = 'font-size: 20px;'>
            It seems that the width is not correct.<br>
            This can be remedied by
            <a id = 'hi' href = 'https://www.khanacademy.org/computer-programming/capture-game/5223543242539008?width=600' style = 'width: 100%;'>touching these letters</a>
        </p>
    </div>
    <!--waithanami viralilo bialiomos courianim quanuc-->
<script type> // You can't access variables that modules create
    var activate, reenter, restart, storyTeller, settingsUp, carrot, timers, notCutscene, totemConstruct, time, timeToggle, clickShowTime, copy, keys, firstFrame = true;;
</script>
<script>/*I have a purpose in life!*/</script>
<!--The type = 'module' enables a few things which I find very useful-->
<script type = 'module'>
try {
    
    
    
    let savable = localStorage.getItem('savable');
    if (localStorage.getItem('canTimer')) {
        document.getElementById('show-time-clicky-holder').style.display = 'block';
    }
    // localStorage.clear();
    // localStorage.setItem('dev', true);
    // localStorage.setItem('savable', true);
    // localStorage.setItem('canTimer', true);
    
    // localStorage.removeItem('canTimer');
    // The Better Vector Library
    const vector = (function() {
        /** This is my vector library that I've made. It's much faster than PVector. Feel free to use it with credit!*/
        const func = function(x, y) {
            return {
                x: x,
                y: y,
            };
        };
        func.add = function(a, b) {
            return {
                x: a.x+b.x,
                y: a.y+b.y,
            };
        };
        func.sub = function(a, b) {
            return {
                x: a.x-b.x,
                y: a.y-b.y,
            };
        };
        func.mult = function(a, mult) {
            return {
                x: a.x*mult,
                y: a.y*mult,
            };
        };
        func.div = function(a, mult) {
            return {
                x: a.x/mult,
                y: a.y/mult,
            };
        };
        func.mag = function(a) {
            return Math.hypot(a.x, a.y);
        };
        func.dot = function(a, b) {
            return a.x*b.x+a.y*b.y;
        };
        func.norm = function(a) {
            const len = vector.mag(a);
            return {
                x: a.x/len,
                y: a.y/len,
            };
        };
        func.limit = function(a, lim) {
            let multi;
            const len = vector.mag(a);
            multi = len <= lim ? 1 : lim/len;
            
            a.x *= multi;
            a.y *= multi;
        };
        func.angleBetween = function(a, b) {
            return Math.acos(vector.dot(a,b)/(vector.mag(a)*vector.mag(b)));
        }
        return func;
    })();
    const noise = (function() {
        const ranVectors = (function() {
            const arr = Array(256); // Allocates only 256 spaces
            
            for (var i = 256; i --;) {
                arr[i] = Math.round(Math.random()) ? 1 : -1;
            }
            return arr;
        })();
        function func(x) {
            x *= 10.0;
            const srx = (x / noise.detail | 0) & 255,
                xf = (x-(x / noise.detail | 0) * noise.detail) / noise.detail,
                a = xf*ranVectors[srx];
        	return (a + ((xf-1)*ranVectors[srx+1]-a)*((6*xf - 15)*xf + 10)*xf*xf*xf+1)/2;
        }
        func.detail = 10;
        
        return func;
    })(); // Custom 1D noise function
    timers = (function() {
        const pObj = {};
        let id = 0;
        function func() {
            for (let i in pObj) {
                if (--pObj[i][1] <= 0) {
                    pObj[i][0]();
                    delete pObj[i];
                }
            }
        }
        func.add = function(f, t) {
            pObj[id] = [f, t*0.06];
            return id++;
        };
        func.remove = function(timerId) {
            delete pObj[timerId];
        }
        
        return func;
    })();
    const tau = Math.PI*2, width = 600, height = 600, halfW = 300, halfH = 300, end = document.getElementById('end'), final = document.getElementById('final'), settings = document.getElementById('help');
    let frameCount = 0;
    time = document.getElementById('time');
    timeToggle = false;
    
    let imported = false;
    function im(...args) {
        var iframe = document.createElement('iframe');
        iframe.style.display = 'none';
        iframe.src = 'https://www.khanacademy.org/cs/x/5908763746811904/embedded?editor=no';
        document.body.appendChild(iframe);
        return new Promise((resolve, reject) => {
            function ev(e) {
                var scripts = {}
                for (var i in args) {
                    scripts[args[i]] = e.data[args[i]];
                }
                resolve(e.data);
                iframe.remove();
                window.removeEventListener('message', ev);
            }
            
            window.addEventListener("message", ev);
        });
    }
    im().then(result => {
        (() => eval)()(result['suspicious-noodles']); // This line just makes sure that the code isn't run in strict mode. For whatever reason, directly referencing 'eval' runs it in the scope/mode/etc. where it's called but either by referencing it through a variable or what I'm doing makes it run in the global scope and without strict mode
        t.p = +Math.PI.toString().slice(t.pin, t.pin+1);
        window.sessionStorage.setItem('st', t.total);
        imported = true;
    });
    function map(value, sStart, sStop, lStart, lStop) {
        return lStart + (lStop - lStart) * ((value - sStart) / (sStop - sStart));
    }
    function splashLog(x) {
        return Math.log(x+0.14)/5+0.4;
    }
    function setPos(el, x, y) { // translate3d doesn't round positions which makes it much smoother
        el.style.transform = 'translate3d('+x+'px, '+y+'px, 0)'
    }
    function deepCopy(arr) {
        const newArr = [];
        for (let i = 0; i < arr.length; i ++) {
            if (arr[i] instanceof Array) {
                newArr[i] = deepCopy(arr[i]);
            } else {
                newArr[i] = arr[i];
            }
        }
        return newArr;
    };
    
    // This is strange
    copy = new (Object.getPrototypeOf(async function(){}).constructor)(`
const x = document.getElementById('copy-cat');
x.style.display = 'block';
x.value = await encode(window.sessionStorage.st);
x.focus();
x.select();
document.execCommand('copy');
x.style.display = 'none';`);
    
    reenter = function() {
        oCtx.fillStyle = `rgb(36, 36, 36)`;
        oCtx.fillRect(0, 0, width, height);
        overlay.ctx.clearRect(0, 0, width, height);
        oCanvas.style.animationName = 'fadeIn';
        
        localStorage.setItem('canTimer', true);
        
        timers.add(() => {
            end.style.display = 'none';
            levelNum = 0,
                worldX = 0,
                worldY = 8,
                cam = vector(halfW, halfH);
            
            createWorld();
            p.pos = vector(140, height-161+15);
            p.ascend = p.cutscene = p.burst = false;
            p.canvas.style.display = 'block';
            
            curCP.chosen = true;
            curCP.run(true);
            savedCP = curCP;
            
            tToggles.beginningOfTheEnd = false;
            oCanvas.style.animationName = 'fadeOut';
        }, 300);
    };
    restart = function() {
        localStorage.clear();
        localStorage.setItem('canTimer', true);
        window.parent.location.reload();
    };
    
    // This loads the Roboto Slab font so I can use it in canvas. Look up 'FontFace()' and you can find the urls by going to https://fonts.googleapis.com/css?family=FONT+NAME+HERE+SPACES+ARE+PLUS+SIGNS. This can be done with CSS but this makes sure that the font is loaded before the program loads (on my computer, the document may not have the font instantly)
    const font = new FontFace('roboto-slab', 'url(https://fonts.gstatic.com/s/robotoslab/v22/BngbUXZYTXPIvIBgJJSb6s3BzlRRfKOFbvjojISmb2Rj.woff2)'); // Load font
    await font.load(); // Tells the program to wait (top-level await only works in modules)
    document.fonts.add(font); // Adds the font to the fonts available to canvas
    
    let tToggles = localStorage.getItem('toggles') === null ? {
        border: true,
        
    } : JSON.parse(localStorage.getItem('toggles'));
    let savedPos = localStorage.getItem('pos') === null ? {x: 140, y: height-161, wx: 0, wy: 8, level: 0} : JSON.parse(localStorage.getItem('pos'));
    let savedAbilities = localStorage.getItem('abilities') === null ? {} : JSON.parse(localStorage.getItem('abilities'));
    let shakeX = 0, shakeY = 0, shakes = [];
    function Shake(strength) {
        this.strength = strength;
        this.active = function(index) {
            shakeX = (Math.random()*2-1)*this.strength;
            shakeY = (Math.random()*2-1)*this.strength;
            this.strength -= 0.5;
            if (this.strength < 0) {
                shakes.splice(index, 1); // Delete
                shakeX = 0;
                shakeY = 0;
            }
        };
    }
    
    // Taken from here: https://stackoverflow.com/questions/25582882/javascript-math-random-normal-distribution-gaussian-bell-curve
    function normalDist() {
        return Math.sqrt(-2.0*Math.log(Math.random()))*Math.cos(2.0*Math.PI*Math.random());
    }
    
    const startCol = [247,237,64],
        endCol = [221,59,30],
        partsCanvas = document.getElementById('particles'),
        partsCtx = partsCanvas.getContext('2d'),
        windPartsCanvas = document.getElementById('wind-particles'),
        windPartsCtx = windPartsCanvas.getContext('2d'),
        oCanvas = document.getElementById('oCanvas'),
        oCtx = oCanvas.getContext('2d');
    function ParticleSystem(args) {
        this.active = [];
        this.ctx = args.under ? windPartsCtx : partsCtx;
        this.add = args.add;
        this.update = args.update;
        this.cols = args.cols;
        this.when = args.when;
        this.extra = args.extra;
        this.extra2 = args.extra2;
        this.shape = args.shape;
        this.run = function() {
            for (let i = this.active.length-1; i >= 0; i --) {
                if (this.active[i].x > cam.x-halfW && this.active[i].x < cam.x+halfW && this.active[i].y > cam.y-halfH && this.active[i].y < cam.y+halfH) {
                    this.ctx.fillStyle = 'rgb('+this.active[i].color+','+this.active[i].trans+')';
                    this.ctx.save();
                    this.ctx.translate(this.active[i].x, this.active[i].y);
                    this.ctx.rotate(this.active[i]?.rot);
                    
                    switch(this.shape) {
                        case 'ability':
                            this.ctx.beginPath();
                            this.ctx.arc(0, 0, 3, 0, tau);
                            this.ctx.fill();
                            this.ctx.beginPath();
                            this.ctx.fill();
                            this.ctx.closePath();
                        break;
                        case 'death':
                            this.ctx.fillRect(-3, -3, 6, 6);
                        break;
                        case 'circle':
                            this.ctx.beginPath();
                            this.ctx.arc(-this.active[i].r/2, -this.active[i].r/2, this.active[i].r, 0, tau);
                            this.ctx.closePath();
                            this.ctx.fill();
                        break;
                        case 'break':
                            this.ctx.fillRect(-5, -5, 10, 10);
                        break;
                        case 'dive':
                            this.ctx.fillRect(-2,-2, 4, 4);
                        break;
                        case 'trail':
                            if (this.active[i].dOrD) this.ctx.fillRect(0,0, 20, 25);
                            if (!this.active[i].dOrD) this.ctx.fillRect(0,0, 25, 20);
                        break;
                        case 'soft ambient':
                            this.ctx.fillRect(-this.active[i].s/2, -this.active[i].s/2, this.active[i].s, this.active[i].s);
                        break;
                        case 'rect':
                            this.ctx.fillRect(0,-1.5, 30, 3);
                        break;
                        case 'spooks':
                            this.ctx.fillRect(-this.active[i].size/2, -this.active[i].size/2, this.active[i].size, this.active[i].size);
                        break;
                        default:
                            this.ctx.fillRect(-1.5,-1.5, 3, 3);
                        break;
                    }
                    this.ctx.restore();
                }
                this.update(this.active[i], i);
            }
            
            this.when?.();
        };
    }
    const runParticles = new ParticleSystem({
        add: function(x, y, reverse = 1) {
            this.active.push({
                x: x+12.5-p.camDir*reverse,
                y: y+22,
                rot: -Math.random()-1-p.camDir*reverse,
                trans: 1,
                color: '36, 36, 36',
                deathSpeed: map(Math.random(), 0, 1, 0.03, 0.04),
                rotDir: p.camDir,
            });
        },
        update: function(particle, index) {
            particle.x += Math.cos(particle.rot)+Math.random()/3;
            particle.y += Math.sin(particle.rot)*2+Math.random()/3;
            particle.trans -= particle.deathSpeed;
            particle.rot += 0.1*-particle.rotDir;
            if (particle.trans < 0) {
                this.active.splice(index, 1);
            }
        },
        when: function() {
            if (!p.inAir && Math.abs(p.velocity.x) > 1.5) {
                if (getKey('up')) {
                    for (let i = 0; i < 5; i ++) {
                        this.add(p.pos.x+p.velocity.x, p.pos.y+p.velocity.y);
                    }
                }
                
                this.add(p.pos.x+p.velocity.x, p.pos.y+p.velocity.y);
            }
            
            if (tutorial.active && !tutorial.inAir && Math.abs(tutorial.velocity.x) > 1.5) {

                this.add(tutorial.pos.x, tutorial.pos.y);
            }
        },
    }),
        jumpParticles = new ParticleSystem({
        cols: ['230, 230, 230','247, 247, 247','201, 201, 201'],
        shape: 'circle',
        add: function(x, y) {
            this.active.push({
                x: p.pos.x+p.velocity.x+Math.random()*25,
                y: p.pos.y+p.velocity.y+30+Math.random()*4,
                trans: map(Math.random(), 0, 1, 0.5, 0.7),
                color: this.cols[~~(Math.random()*this.cols.length)],
                r: map(Math.random(), 0, 1, 3, 6),
                deathSpeed: map(Math.random(), 0, 1, 0.02, 0.04),
                velocityX: (Math.random()*2-1)*3,
            });
        },
        update: function(particle, index) {
            particle.trans -= particle.deathSpeed;
            particle.r -= particle.deathSpeed*particle.r;
            particle.x += particle.velocityX;
            particle.velocityX /= 1.3
            if (particle.trans < 0) {
                this.active.splice(index, 1);
            }
        },
    }),
        trailParticles = new ParticleSystem({
        shape: 'trail',
        add: function(dOrD) {
            this.active.push({
                x: p.pos.x+p.velocity.x,
                y: p.pos.y+p.velocity.y,
                trans: 0.3,
                dOrD: dOrD,
                color: p.color.join(', '),
                deathSpeed: 0.06,
            });
        },
        update: function(particle, index) {
            particle.trans -= particle.deathSpeed;
            if (particle.trans < 0) {
                this.active.splice(index, 1);
            }
        },
        when: function() {
            if (p.deeping) {
                this.add(false);
            } else if (p.dashing) {
                this.add(true);
            }
        },
    }),
        poundParticles = new ParticleSystem({
        extra2: 1,
        shape: 'dive',
        extra: function(isp, override) {
            if (--poundParticles.extra2 > 0) {
                for (let i = 0; i < 20; i ++) {
                    poundParticles.add(isp, override);
                }
                window.requestAnimationFrame(function() {
                    poundParticles.extra(isp, override);
                })
            }
        },
        add: function(isp, override) {
            let pos = isp ? p.pos : tutorial.pos;
            if (override) pos = override;
            this.active.push({
                x: pos.x+12.5+(Math.random()*2-1)*12.5,
                y: pos.y+22,
                rot: -(Math.random() < 0.5 ? 2.4-normalDist()/5 : normalDist()/5+0.7),
                trans: 1,
                color: '36, 36, 36',
                speed: map(Math.random(), 0, 1, 0.5, 1.5),
                deathSpeed: Math.random() > 0.1 ? map(Math.random(), 0, 1, 0.1, 0.12) : 0.05, 
            });
        },
        update: function(particle, index) {
            particle.x += Math.cos(particle.rot)*(13-(1-particle.trans)*13)*particle.speed;
            particle.y += Math.sin(particle.rot)*(13-(1-particle.trans)*13)*particle.speed+3
            particle.trans -= particle.deathSpeed/3;
            if (particle.trans < 0) {
                this.active.splice(index, 1);
            }
            
            
        },
    }),
        softBreakParticles = new ParticleSystem({
        shape: 'break',
        add: function(x, y) {
            this.active.push({
                x: x,
                y: y,
                rot: -(Math.random() < 0.5 ? 2.4-normalDist()/5 : normalDist()/5+0.7),
                trans: 1,
                color: '36, 36, 36',
                velocity: {
                    x: (Math.random()*2-1)*4,
                    y: -Math.random()*3,
                },
                deathSpeed: Math.random() > 0.1 ? map(Math.random(), 0, 1, 0.07, 0.1) : 0.06,
            });
        },
        update: function(particle, index) {
            particle.velocity.x /= 1.05;
            particle.velocity.y += 0.2;
            particle.x += particle.velocity.x;
            particle.y += particle.velocity.y;
            particle.rot += particle.velocity.x/3;
            particle.trans -= particle.deathSpeed/3;
            if (particle.trans < 0) {
                this.active.splice(index, 1);
            }
        },
    }),
        softAmbientParticles = new ParticleSystem({
        shape: 'soft ambient',
        add: function(x, y) {
            const size = map(Math.random(), 0, 1, 10, 20);
            this.active.push({
                x: x+map(Math.random(), 0, 1, 10, 30),
                y: y+30,
                rot: -(Math.random() < 0.5 ? 2.4-normalDist()/5 : normalDist()/5+0.7),
                trans: 1,
                color: '36, 36, 36',
                s: size,
                os: size,
                rotDir: !!Math.round(Math.random()),
                deathSpeed: 0.01,
            });
        },
        update: function(particle, index) {
            particle.y += 0.5;
            particle.rot += particle.os/1000*(particle.rotDir ? 1 : -1);
            particle.trans = particle.s/particle.os;
            particle.s -= 0.1;
            if (particle.s < 0) {
                this.active.splice(index, 1);
            }
        },
    }),
        deathParticles = new ParticleSystem({
        shape: 'death',
        add: function(x, y) {
            this.active.push({
                x: x,
                y: y,
                rot: 0,
                trans: 1,
                color: p.dashToggle ? p.color.join(', ') : p.depleteColor.join(', '),
                timer: Math.random()*100,
                rotDir: !!Math.round(Math.random()),
                upSpeed: map(Math.random(), 0, 1, 0.3, 2),
                deathSpeed: map(Math.random(), 0, 1, 0.01, 0.03),
            });
        },
        update: function(particle, index) {
            particle.y -= particle.upSpeed;
            particle.x += noise(particle.timer)*2.8-1.4;
            particle.timer += 0.01;
            particle.rot += particle.deathSpeed*2;
            particle.trans -= particle.deathSpeed;
            if (particle.trans < 0) {
                this.active.splice(index, 1);
            }
        },
    }),
        flameParticles = new ParticleSystem({
        cols: ['199, 47, 24'],
        shape: 'death',
        add: function(x, y) {
            this.active.push({
                x: x,
                y: y,
                rot: 0,
                trans: 1,
                color: '199, 47, 24',
                timer: Math.random()*100,
                rotDir: !!Math.round(Math.random()),
                upSpeed: map(Math.random(), 0, 1, 0.3, 2),
                deathSpeed: map(Math.random(), 0, 1, 0.01, 0.03),
            });
        },
        update: function(particle, index) {
            particle.y -= particle.upSpeed;
            particle.x += noise(particle.timer)*2.8-1.4 + ((levelNum > 19 && levelNum <= 28 || levelNum === 53 || levelNum === 52) ? 0.5 : 0);
            particle.timer += 0.01;
            particle.rot += particle.deathSpeed*2;
            particle.trans -= particle.deathSpeed;
            particle.color = map(particle.trans, 1, 0.3, startCol[0], endCol[0])+','+map(particle.trans, 1, 0.3, startCol[1], endCol[1])+','+map(particle.trans, 1, 0.3, startCol[2], endCol[2])
            if (particle.trans < 0) {
                this.active.splice(index, 1);
            }
        },
    }),
        lavaParticles = new ParticleSystem({
        shape: 'death',
        add: function(x, y) {
            this.active.push({
                x: x,
                y: y,
                rot: 0,
                trans: 1,
                color: '226,46,8',
                timer: Math.random()*100,
                rotDir: !!Math.round(Math.random()),
                velocity: {
                    x: (Math.random()*2-1),
                    y: map(Math.random(), 0, 1, -2, -3)
                },
                deathSpeed: map(Math.random(), 0, 1, 0.005, 0.007),
            });
        },
        update: function(particle, index) {
            particle.y += particle.velocity.y;
            particle.x += particle.velocity.x;
            particle.velocity.y += 0.1;
            particle.rot += particle.velocity.x/5;
            particle.trans -= particle.deathSpeed;
            if (particle.trans < 0) {
                this.active.splice(index, 1);
            }
        },
    }),
        windParticles = new ParticleSystem({
        under: true,
        shape: 'dive',
        add: function(x, y, floory) {
            if (this.active.length < 200) {
                this.active.push({
                    x: x,
                    y: y,
                    rot: Math.random()*tau,
                    trans: 0.9,
                    timer: Math.random()*1000,
                    color: '168,137,98',
                    deathSpeed: floory ? 0.01 : 2/levelW,
                    floory: floory,
                    rotDir: Math.round(Math.random*2-1),
                });
            }
        },
        update: function(particle, index) {
            particle.timer += 0.01;
            particle.x += 3;
            if (!particle.floory) {
                particle.y += noise(particle.timer)*4.2-1.4
            } else {
                particle.y += noise(particle.timer)*4.2-1.4;
            }
            particle.rot += 0.1*-particle.rotDir;
            particle.trans -= particle.deathSpeed;
            if (particle.trans < 0) {
                this.active.splice(index, 1);
            }
        },
        when: function() {
            const side = Math.round(Math.random());
            if ((levelNum > 19 && levelNum <= 28 || levelNum === 53 || levelNum === 52 || levelNum === 112 || (levelNum > 113 && levelNum !== 118)) && frameCount % 10 === 0) {
                this.add(side ? Math.random()*levelW : 0, !side ? Math.random()*levelH : 0);
            }
        },
    }),
        eraseParticles = new ParticleSystem({
        shape: 'death',
        add: function(x, y, h) {
            if (this.active.length < 200) {
                this.active.push({
                    x: x+(h ? Math.random()*40 : 20+normalDist()),
                    y: y+(!h ? Math.random()*40 : 20+normalDist()),
                    h: h,
                    velX: 0.1,
                    rot: Math.random()*tau,
                    trans: 1,
                    timer: 0,
                    color: '204, 100, 100',
                    deathSpeed: 0.1,
                    rotDir: Math.round(Math.random*2-1),
                });
            }
        },
        update: function(particle, index) {
            
            particle.rot += 0.1;
            particle.trans -= particle.deathSpeed;
            if (particle.trans < 0) {
                this.active.splice(index, 1);
            }
        },
    }),
        chaserParticles = new ParticleSystem({
        shape: 'soft ambient',
        add: function(explode) {
            const offSet = Math.random()*50-25;
            const dir = Math.random()*tau;
            const deathJuice = {
                x: chaser.pos.x+12.5+(Math.random()*2-1)*10,
                y: chaser.pos.y+12.5+(Math.random()*2-1)*10,
                rot: Math.random()*tau,
                rotDir: Math.round(Math.random()) ? 1 : -1,
                trans: 1,
                color: `${36+offSet}, ${36+offSet}, ${36+offSet}`,
                s: map(Math.random(), 0, 1, 5, 15),
                velocityX: !explode ? map(Math.random(), 0, 1, -1, 1) : Math.cos(dir)*map(Math.random(), 0, 1, -5, 5),
                velocityY: !explode ? map(Math.random(), 0, 1, 0, 0.5) : Math.sin(dir)*map(Math.random(), 0, 1, -5, 5),
                deathSpeed: explode ? (Math.random() > 0.1 ? map(Math.random(), 0, 1, 0.05, 0.08) : 0.03) : (Math.random() > 0.1 ? map(Math.random(), 0, 1, 0.1, 0.12) : 0.05), 
            };
            this.active.push(deathJuice);
        },
        update: function(particle, index) {
            particle.x += particle.velocityX;
            particle.y += particle.velocityY;
            particle.trans -= particle.deathSpeed/3;
            particle.s -= particle.deathSpeed*2;
            particle.rot += particle.deathSpeed/3*particle.rotDir;
            if (particle.s < 0) {
                this.active.splice(index, 1);
            }
            
        },
    }),
        ascendParticles = new ParticleSystem({
        shape: 'death',
        add: function(x, y) {
            const timer = Math.random()*100;
            const upSpeed = map(Math.random(), 0, 1, 1, 3);
            const noiseMult = map(upSpeed**2, 1, 9, 1, 7);
            const offset = -(noise(timer));
            this.active.push({
                x: x+offset,
                y: y,
                rot: 0,
                trans: 1,
                color: p.dashToggle ? p.color.join(', ') : p.depleteColor.join(', '),
                timer: timer,
                increment: 0.0000001,
                rotDir: !!Math.round(Math.random()),
                upSpeed: 1,
                endSpeed: upSpeed,
                deathSpeed: map(Math.random(), 0, 1, 0.006, 0.01),
                offset: offset,
                noiseMult: noiseMult,
            });
        },
        update: function(particle, index) {
            particle.y -= particle.upSpeed;
            particle.upSpeed += (particle.endSpeed-particle.upSpeed)/40;
            // const nextNoise = particle.upSpeed**2;
            particle.x += (noise(particle.timer)*particle.noiseMult+particle.offset*particle.noiseMult)*3;
            particle.timer += 0.001;//particle.increment*10;
            // particle.increment += particle.increment/10;
            // particle.rot += particle.deathSpeed*2;
            particle.trans -= particle.deathSpeed;
            if (particle.trans < 0) {
                this.active.splice(index, 1);
            }
        },
    }),
        splashParticles = new ParticleSystem({
        extra2: 1,
        shape: 'dive',
        extra: function(isp, s) {
            if (--splashParticles.extra2 > 0) {
                for (let i = 0; i < 20; i ++) {
                    splashParticles.add(isp, s);
                }
                window.requestAnimationFrame(function() {
                    splashParticles.extra(isp, s);
                })
            }
        },
        add: function(isp, s) {
            let pos = isp ? p.pos : tutorial.pos;
            
            this.active.push({
                x: pos.x+12.5+(Math.random()*2-1)*12.5,
                y: pos.y+22,
                rot: -(Math.random() < 0.5 ? 2.4-normalDist()/5 : normalDist()/5+0.7),
                trans: 1,
                color: '226,46,8',
                speed: map(Math.random(), 0, 1, 0.5, 1.5),
                deathSpeed: Math.random() > 0.1 ? map(Math.random(), 0, 1, 0.1, 0.12) : 0.05,
                s: s,
            });
        },
        update: function(particle, index) {
            particle.x += Math.cos(particle.rot)*(13-(1-particle.trans)*13)*particle.speed*particle.s;
            particle.y += Math.sin(particle.rot)*(13-(1-particle.trans)*13)*particle.speed*particle.s+3
            particle.trans -= particle.deathSpeed/3;
            
            if (particle.trans < 0) {
                this.active.splice(index, 1);
            }
            
            
        },
    }),
        catacombsAmbientParticles = new ParticleSystem({
        add: function() {
            this.active.push({
                x: Math.random() * width,
                y: -10,
                rot: Math.random()*tau,
                trans: 1,
                speed: map(Math.random(), 0, 1, 0, 1),
                color: '100, 100, 100',
            });
        },
        update: function(particle, index) {
            particle.y += (particle.speed += 0.1);
            // particle.trans -= particle.deathSpeed;
            // particle.rot += 0.1;
            if (particle.y > levelH) {
                this.active.splice(index, 1);
            }
        },
        when: function() {
            if (levelNum >= 4 && levelNum <= 18 && Math.random() < 0.005) {
                this.add();
            }
        },
    }),
        spooksParticles = {
        active: [],
        add: function() {
            this.active.push({
                x: map(Math.random(), 0, 1, 100, 500),
                y: map(Math.random(), 0, 1, 270, 330),
                velocity: {
                    x: Math.random()*2-1,
                    y: Math.random()*2-1,
                },
                size: 7,
                deathSpeed: map(Math.random(), 0, 1, 0.005, 0.03), // How fast it dies
                color: 12+map(Math.random(), 0, 1, -5, 5)+','+map(Math.random(), 0, 1, 100, 150)+','+map(Math.random(), 0, 1, 100, 150),
                trans: 1, // transparency
                rot: Math.random()*tau // Random degrees
            });
        },
        update: function(particle) {
            particle.rot += 0.01
            particle.trans -= particle.deathSpeed;
            particle.size ++;
            particle.x += particle.velocity.x;
            particle.y += particle.velocity.y;
            if (particle.trans < 0) { // Reset
                particle.x = map(Math.random(), 0, 1, 100, 500);
                particle.y = map(Math.random(), 0, 1, 260, 310);
                particle.size = 7;
                particle.trans = 1;
            }
        },
        run: function() {
            for (const i of this.active) {
                oCtx.fillStyle = 'rgb('+i.color+','+i.trans+')';
                oCtx.save();
                oCtx.translate(i.x, i.y);
                oCtx.rotate(i.rot);
                oCtx.fillRect(-i.size/2, -i.size/2, i.size, i.size);
                oCtx.restore();
                this.update(i);
            }
        },
    };
    
    oCtx.font = 'bold 50px roboto-slab'
    oCtx.textAlign = 'center';
    for (let i = 50; i --;) {
        spooksParticles.add();
    }
    
    const canvas = document.getElementById('canvas'),
        ctx = document.getElementById('canvas').getContext('2d');
    const nCanvas = document.getElementById('next-level'),
        nctx = document.getElementById('next-level').getContext('2d');
    const backBlocks = document.getElementById('back-blocks'),
        bCtx = backBlocks.getContext('2d');
    const preview = document.getElementById('capture-preview'),
        cp = preview.getContext('2d');
    
    cp.globalAlpha = '0.7';
    CanvasRenderingContext2D.prototype.roundedRect = function (x, y, w, h, r) {
        if (w < 2 * r) r = w / 2;
        if (h < 2 * r) r = h / 2;
        this.beginPath();
        this.moveTo(x+r, y);
        this.arcTo(x+w, y,   x+w, y+h, r);
        this.arcTo(x+w, y+h, x,   y+h, r);
        this.arcTo(x,   y+h, x,   y,   r);
        this.arcTo(x,   y,   x+w, y,   r);
        this.closePath();
        return this;
    }
    function getImage(id, x, y, w, h, callback, z) {
        const canvas = document.createElement('canvas');
        canvas.setAttribute('id', id);
        canvas.style.position = 'absolute';
        canvas.style.left = x+'px';
        canvas.style.top = y+'px';
        canvas.width = w;
        canvas.height = h;
        canvas.style.zIndex = z;
        const context = canvas.getContext('2d');
        callback(context);
        
        document.body.appendChild(canvas);
        return {ctx: context, canvas: canvas};
    }
    
    let photo = [];
    function capture() {
        if (photo.length) {
            preview.style.display = 'none';
            const y = ~~(p.trueY+280 > levelH ? levelH-280 : p.trueY < 0 ? 0 : p.trueY)/40;
            const x = ~~(p.trueX/40);
            for (let i = y; i < y+7; i ++) {
                let parts = [levels[levelNum][i].slice(0, x), '', levels[levelNum][i].slice(x+7)];
                for (let j = x; j < x+7; j ++) {
                    if (photo[(i-y)*7+j-x] === 'n' || (isNaN(+levels[levelNum][i][j]) || levels[levelNum][i][j] === ' ')) {
                        parts[1] += levels[levelNum][i][j]
                    } else {
                        parts[1] += photo[(i-y)*7+j-x];
                    }
                }
                levels[levelNum][i] = parts[0]+parts[1]+parts[2];
                
                if (oLevels[levelNum][i] !== parts[0]+parts[1]+parts[2]) addLevel(levelNum, i, parts[0]+parts[1]+parts[2]);
                
            }
            createWorld(true);
            photo.length = 0;
            cp.clearRect(0, 0, 280, 280);
            if (levelNum === 91) {
                ctx.drawImage(pillar, 460, 320);
            }
            return;
        }
        
        preview.style.display = 'block';
        let stop = false;
        let startX, startY;
        for (let i = 0; i < levels[levelNum].length && !stop; i ++) {
            for (let j = 0; j < levels[levelNum][i].length && !stop; j ++) {
                const y = p.trueY+280 > levelH ? levelH-280 : p.trueY < 0 ? 0 : p.trueY
                const camX = j-(p.trueX+(p.camDir === -1 ? 280 : 0))/40;
                const camY = (y+125)/40-i;
                if (p.camDir !== -1) {
                    if (camX < 7 && camX > -1 && camY < 4.125 && camY > -3.125) {
                        startX = j, startY = i;
                        stop = true;
                    }
                } else {
                    if (camX > -8 && camX < 0 && camY < 4.125 && camY > -3.125) { 
                        startX = j, startY = i;
                        stop = true;
                    }
                }
            }
        }
        
        cp.beginPath();
        cp.clearRect(0, 0, 281, 281);
        for (let i = startY; i < startY+7; i ++) {
            for (let j = startX; j < startX+7; j ++) {
                let block;
                switch(levels[levelNum][i][j]) {
                    case '0': // Air
                        cp.fillStyle = 'rgb(252, 252, 252, 0.5)';
                        block = ' ';
                    break;
                    case '1': // Block
                        cp.fillStyle = 'rgb(36, 36, 36)';
                        block = 'b';
                    break;
                    case '2': // Lava
                        cp.fillStyle = 'rgb(226, 46, 8)';
                        block = 'l';
                    break;
                    case '3': // Soft
                        cp.fillStyle = 'rgb(36, 36, 36)';
                        block = 'd'
                    break;
                    default:
                        block = 'n';
                        cp.fillStyle = 'rgb(204, 100, 100, 0.5)';
                    break;
                }
                cp.fillRect((j-startX)*40, (i-startY)*40, 40, 40);
                photo.push(block);
            }
        }
    }
    
    let captureToggle = true,
        cameraToggle = true,
        ctrlToggle = true,
        doubleToggle = false,
        resetToggle = true,
        diveKeyToggle = false,
        keyCodes = {},
        selected = 0;
    const blanks = [
        {
            name: 'intro',
            index: 0,
        },
        {
            name: 'world',
            index: 6,
        },
        {
            name: 'fall',
            index: 8,
        },
        {
            name: 'checkpoint',
            index: 10
        },
        {
            name: 'double',
            index: 15,
        },
        {
            name: 'dash',
            index: 18,
        },
        {
            name: 'dive',
            index: 24,
        },
        {
            name: 'popup',
            index: 28,
        },
        {
            name: 'camera',
            index: 30,
        },
        {
            name: 'erase',
            index: 37,
        },
        {
            name: 'e',
            index: 40,
        },
        {
            name: 'carrot',
            index: 52,
        },
    ];
    
    // When I program, I strive for readability
    const getKey = k => keys[k] ? keyCodes[keys[k]] : (k === 'left' ? keyCodes['a'] || keyCodes['arrowleft'] : (k === 'right' ? keyCodes['d'] || keyCodes['arrowright'] : (k === 'up' ? keyCodes['w'] || keyCodes['arrowup'] : (k === 'down' ? keyCodes['s'] || keyCodes['arrowdown'] : false))));
    const getKeyName = (k, t) => keys[k] ? keys[k] : (k === 'left' ? (t ? 'a' : 'arrowleft') : (k === 'right' ? (t ? 'd' : 'arrowright') : (k === 'up' ? (t ? 'w' : 'arrowup') : (k === 'down' ? (t ? 's' : 'arrowdown') : false))));
    
    let inputs = document.querySelectorAll('input:not([type="checkbox"], [type="color"], #copy-cat)');
    keys = {
        dash: ' ',
        camera: 'alt',
        photo: 'shift',
        reset: 'r',
        continueD: 'control',
    };
    for (const i of inputs) {
        i.addEventListener('keydown', function(e) {
            e.preventDefault();
            e.target.value = e.key.charAt(0).toUpperCase() + e.key.slice(1);
            keys[e.target.id] = e.key.toLowerCase();
        });
    }
    const settingsSpine = document.getElementById('settings-spine');
    let settingsSpineHeight = 124;
    
    const showTime = document.getElementById('show-time');
    const ps = document.getElementById('controls').children;
    function updateControls(name) {
        for (const i of ps) {
            if (i.firstElementChild.id === name) {
                settingsSpine.style.height = (settingsSpineHeight += 33)+'px';
                i.style.display = 'block';
                break;
            }
        }
    }
    for (const i in savedAbilities) {
        updateControls(i);
        if (i === 'camera') updateControls('photo'), updateControls('reset');
        if (i === 'dive') updateControls('down')
    }
    
    function keyPressed(e) {
        e.preventDefault();
        if (gearToggle || !tToggles.started) return;
        const key = e.key.toLowerCase();
        keyCodes[key] = true;
        if (getKey('photo') && captureToggle && !p.noPhoto && p.cameraUp && p.unlocked.camera) {
            captureToggle = false;
            capture();
        }
        if (getKey('camera') && cameraToggle) {
            cameraToggle = false;
            p.cameraUp = !p.cameraUp;
            capEl.style.display = 'none';
            noCapEl.style.display = 'none';
            preview.style.display = p.cameraUp ? 'block' : 'none';
        }
        
        if (getKey('continueD') && !tToggles.skipped && ctrlToggle && tutorial.message && tutorial.pos.x > 0 && tutorial.pos.x < levelW && !transLevel.active && !p.dead && tutorial.message !== 53) {
            ctrlToggle = false;
            
            if (saxophoneNum === 9) {
                timers.add(() => {tToggles.doneE = true}, 200);
                saxophoneNum ++;
                p.cutscene = false;
                
            }
            
            const div = tutorial.messages[tutorial.message]
            if (div.textContent !== 'blank' || ((tToggles.startE || tToggles.middleE) && !tToggles.doneE && levelNum === 67)) {
                tutorial.next();
                blanks[selected].index ++;
            } else {
                tToggles[blanks[selected].name] = true;
            }
            
            
            let timerId;
            if ((tToggles.startE || tToggles.middleE) && !tToggles.doneE && levelNum === 67) {
                if (tutorial.message === 40) {
                    saxophone.style.display = 'block';
                    saxophone.style.animationName = 'sax';
                }
                oCanvas.style.animationName = 'fadeOut';
                timerId = timers.add(function() {
                    oCanvas.style.animationName = 'fadeIn';
                    saxophoneNum++;
                }, 200);
            }
            
            if (tutorial.message === 43 && levelNum === 67 && p.cutscene) {
                tToggles.startE = false;
                tToggles.middleE = true;
                
                p.cutscene = false;
                p.die();
                oCanvas.style.animationName = 'fadeOut';
                timers.remove(timerId);
            }
            
            div.style.left = -cam.x+halfW+tutorial.pos.x-window.getComputedStyle(div).width.slice(0, -2)-10+'px';
            div.style.top = -cam.y+halfH+tutorial.pos.y-window.getComputedStyle(div).height.slice(0, -2)-10+'px';
            
        }
        
        if (key === 81) {
        }
        if (getKey('continueD') && levelNum === 26 && storyTeller.message !== 7 && storyTeller.message !== storyTeller.messages.length-5) {
            if (storyTeller.messages[storyTeller.message].textContent !== 'blank') storyTeller.next();
            if ((storyTeller.message === 24 || storyTeller.message === 26) && tToggles.diveFirst) {
                storyTeller.next(27);
            }
        }
        if (getKey('reset') && resetToggle && p.unlocked.camera && !p.cutscene && !p.ascend && !p.frozen) {
            photo.length = 0;
            cp.clearRect(0, 0, 280, 280);
            resetToggle = false;
            p.pos = transLevel.entryPos;
            p.velocity = vector(0, 0);
            levels[levelNum] = deepCopy(oLevels[levelNum]);
            createWorld(true);
            switch(transLevel.entryDir) {
                case 0:
                    p.velocity.y = -5.8;
                break;
                case 2:
                    if (levelNum === 80) p.velocity.y = 5.8;
                break;
            }
            particles();
            
            const lvlArr = JSON.parse(localStorage.getItem('lvls'));
            lvlArr.splice(lvlArr.indexOf(levelNum), 1);
            localStorage.setItem('lvls', JSON.stringify(lvlArr))
            localStorage.removeItem(levelNum);
        }
        
        if ((key === getKeyName('down') || key === getKeyName('down', true)) && !diveKeyToggle) {
            diveKeyToggle = true;
            if (!p.inLadder && !p.toggleDiveLadder) p.toggleDiveLadder = true;
        }
    }
    function keyReleased(e) {
        if (gearToggle) return;
        const key = e.key.toLowerCase();
        keyCodes[key] = false;
        
        if (key === getKeyName('up') || key === getKeyName('up', true)) {
            
            p.jumped = false;
            tutorial.jumped = false;
        }
        if (key === getKeyName('photo') && !captureToggle) {
            captureToggle = true;
        }
        if (key === getKeyName('camera') && !cameraToggle) {
            cameraToggle = true;
        }
        if (key === getKeyName('continueD') && !ctrlToggle) {
            ctrlToggle = true;
        }
        if (key === getKeyName('reset') && !resetToggle) {
            resetToggle = true;
        }
        if (key === getKeyName('down') || key === getKeyName('down', true)) {
            p.toggleDiveLadder = false;
            diveKeyToggle = false;
        }
    }
    document.addEventListener('keydown', keyPressed);
    document.addEventListener('keyup', keyReleased);
    
    notCutscene = function() {
        p.cutscene = false;
    };
    const pCanvas = document.getElementById('player-canvas');
    const pCtx = pCanvas.getContext('2d');
    
    const p = {
        pos: vector(savedPos.x, savedPos.y+15),
        velocity: vector(0, 0),
        acceleration: vector(0, 0),
        spawn: vector(1001, height-81),
        isp: true,
        jump: true,
        climbing: false,
        double: 1,
        coyoteTime: 0,
        landed: false,
        camDir: 1,
        camY: 0,
        camX: 0,
        camRot: 0,
        noPhoto: false,
        canvas: pCanvas,
        ctx: pCtx,
        dead: false,
        unlocked: savedAbilities,
        color: localStorage.getItem('pColor') ? localStorage.getItem('pColor').split(',').map(num => +num) : [199, 47, 24],
        depleteColor: localStorage.getItem('pDepleteColor') ? localStorage.getItem('pDepleteColor').split(',').map(num => +num) : [150, 6, 6],
        display: function() {
            const stretch = this.velocity.y/2 > 3 ? 3 : this.velocity.y/2;
            const squash = this.velocity.y/2 > 1.5 ? 1.5 : this.velocity.y/2;
            const tilt = this.velocity.x > 13 ? 13 : this.velocity.x < -13 ? -13 : this.velocity.x
            
            
            this.ctx.fillStyle = this.dashToggle ? `rgb(${this.color[0]}, ${this.color[1]}, ${this.color[2]})` : `rgb(${this.depleteColor[0]}, ${this.depleteColor[1]}, ${this.depleteColor[2]})`;
            this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height);
            this.ctx.beginPath();
            this.ctx.moveTo(15-squash/2, 15-stretch/2+25);
            this.ctx.lineTo(15-squash/2+tilt, 15+stretch);
            this.ctx.lineTo(15+25+squash+tilt, 15+stretch);
            this.ctx.lineTo(15+squash+25, 15-stretch/2+25);
            this.ctx.fill();
            
            if (this.cameraUp && this.unlocked.camera) {
                this.ctx.beginPath();
                this.ctx.fillStyle = 'rgb(36, 36, 36)';
                this.ctx.moveTo(15+10+this.camDir*17.5, 15+5+15);
                this.ctx.lineTo(15+10+this.camDir*17.5+tilt, 15+5);
                this.ctx.lineTo(15+10+this.camDir*17.5+5+tilt, 15+5);
                this.ctx.lineTo(15+15+this.camDir*17.5, 15+20);
                this.ctx.fill();
            }
            setPos(this.canvas, this.pos.x-15-cam.x+halfW+shakeX, this.pos.y-15-cam.y+halfH+shakeY);
            // this.canvas.style.left = this.pos.x-15-cam.x+halfW+shakeX+'px';
            // this.canvas.style.top = this.pos.y-15-cam.y+halfH+shakeY+'px';
            
            this.trueY = ~~((this.pos.y-100)/40)*40;
            this.trueX = ~~((this.pos.x-this.camDir/10+(this.camDir === 1 ? 25 : 0))/40)*40+this.camDir*160-120;
            this.camY += this.trueY+280 > levelH ? (levelH-280-this.camY)/3 : this.trueY < 0 ? -this.camY/3 : (this.trueY-this.camY)/3;
            this.camX += (this.trueX-this.camX)/3;
            
            this.noPhoto = (this.camX < 0 || this.camX+280 > levelW);
            
            if (this.cameraUp && this.unlocked.camera) {
                if (this.noPhoto) {
                    capEl.style.display = 'none';
                    noCapEl.style.display = 'block';
                    // setPos(noCapEl, this.camX-cam.x+halfW-3, this.camY-cam.y+halfH-3)
                    noCapEl.style.left = this.camX-cam.x+halfW-3+'px';
                    noCapEl.style.top = this.camY-cam.y+halfH-3+'px';
                } else {
                    noCapEl.style.display = 'none';
                    capEl.style.display = 'block';
                    capEl.style.left = this.camX-cam.x+halfW-7+'px';
                    capEl.style.top = this.camY-cam.y+halfH-7+'px';
                }
            }
            
            if (this.isp) {
                preview.style.left = this.camX-cam.x+halfW+'px';
                preview.style.top = this.camY-cam.y+halfH+'px';
            }
        },
        update: function() {
            if (levelNum === 80) this.deepToggle = this.deeping = false;
            
            if (!this.dashing && !this.deeping && !this.ascend) this.velocity = vector.add(this.velocity, this.acceleration);
            
            if (this.velocity.x > 5 && !this.dashing) this.velocity.x = 5;
            if (this.velocity.x < -5 && !this.dashing) this.velocity.x = -5;
            if (this.velocity.y > 15 && !this.deeping) {
                this.velocity.y = 15
            }
            this.acceleration = vector(0, this.inAir ? (levelNum !== 80 ? 0.2 : -0.2) : 0);
            if (((getKey('left') && this.left) || (getKey('right') && this.right))) {
                if (this.velocity.y > 0.8 && !this.deeping) {
                    this.velocity.y = 0.8;
                }
                this.climbing = true;
            } else {
                this.climbing = false;
            }
            
            if (!this.inAir && !this.landed) this.landed = true;
            
            // Base movement key interactions
            if (!this.dashing && tToggles.started && !this.ascend) {
                if (getKey('left')) {
                    this.acceleration.x = -0.7;
                    this.camDir = -1;
                }
                if (getKey('right')) {
                    this.acceleration.x = 0.7;
                    this.camDir = 1;
                }
                if (getKey('up')) {
                    if (this.coyoteTime > 0) {
                        this.landed = false;
                        this.jumped = true;
                        this.coyoteTime = 0;
                        this.velocity.y = (levelNum !== 80 ? -5.8 : 5.8);
                        this.jump = false;
                        for (let i = 0; i < 50; i ++) {
                            jumpParticles.add(this.pos.x+this.velocity.x, this.pos.y+this.velocity.y);
                        }
                        if (Math.abs(this.velocity.x) > 1) {
                            for (let i = 0; i < 5; i ++) {
                                runParticles.add(this.pos.x+this.velocity.x, this.pos.y+this.velocity.y);
                            }
                        }
                        
                    } else if (!this.inLadder && this.double > 0 && !this.jumped && !this.deeping && this.unlocked.double) {
                        this.deepToggle = true;
                        this.bounce = false;
                        this.double --;
                        this.velocity.y = (levelNum !== 80 ? -5.8 : 5.8);
                        if (this.climbing) this.velocity.x = -this.camDir*10
                    }
                }
            }
            if (!getKey('left') && !getKey('right') && !this.dashing || this.deeping || this.ascend) this.velocity.x /= 1.3;
            
            if (getKey('dash') && this.dashToggle && this.inAir && !this.dashing && this.coyoteTime < 0 && this.unlocked.dash && !this.ascend && !transLevel.active) { // If the player wants to dash, has a dash stored, and in air
                this.dashToggle = false;
                this.dashing = true;
                this.velocity.x = this.camDir*20;
                this.dashingTimer = 5;
                this.deeping = false;
            }
            if (this.dashing) { // Through the snow
                this.velocity.y = 0;
                if (!--this.dashingTimer) {
                    this.dashing = false;
                }
            }
            
            if (getKey('down') && this.toggleDiveLadder && this.deepToggle && this.inAir && !this.deeping && !this.bounce && this.unlocked.dive && !this.ascend) { // If the player wants to deepening dive, has a deepening dive stored, and in air;
                this.deepToggle = false;
                this.deeping = true;
                this.velocity.y = 20.000001;
                this.dashing = false;
            }
            
            if (this.inLadder && !this.dashing) {
                this.velocity.y /= 1.3;
                this.velocity.x /= 1.3;
            }
        },
        updatePos: function() { // The normal way of doing things
            this.pos = vector.add(this.pos, this.velocity);
            // console.log(this.acceleration);
            if (tToggles.beginningOfTheEnd && !tToggles.noChaserAdd) {
                chaser.log.push(this.pos);
            }
        },
        die: function() {
            this.dead = true;
            // Window timers are slow so generally, avoid using them apart from the main loop
            timers.add(() => { // Arrow functions do not reset where 'this' points to. This is important because I can access 'this' in here without issues
                pCanvas.style.display = 'none';
                this.frozen = true;
                for (let i = 0; i < 25; i += 5) {
                    for (let j = 0; j < 25; j += 5) {
                        // Loops are much slower so I just called it 3 times here because it isn't too much of a hassle to do
                        deathParticles.add(p.pos.x+j+3, p.pos.y+i+3);
                        deathParticles.add(p.pos.x+j+3, p.pos.y+i+3);
                        deathParticles.add(p.pos.x+j+3, p.pos.y+i+3);
                    }
                }
                
                deathParticles.run(); // Prevents a flash
                
                this.velocity = vector(0, 0);
                this.acceleration = vector(0, 0);
            }, 10);
            timers.add(() => {
                deathOverlay.canvas.style.animationName = 'fadeIn';
                timers.add(() => {
                    runParticles.active.length = 0;
                    jumpParticles.active.length = 0;
                    trailParticles.active.length = 0;
                    poundParticles.active.length = 0;
                    softBreakParticles.active.length = 0;
                    softAmbientParticles.active.length = 0;
                    lavaParticles.active.length = 0;
                    windParticles.active.length = 0;
                    chaserParticles.active.length = 0;
                    chaser.log.length = 0;
                    chaser.log.fill(vector(-1000, -1000), 0, 50);
                    chaser.pos = vector(-1000, -1000);
                    
                    
                    deathOverlay.canvas.style.animationName = 'fadeOut';
                    deathParticles.active.length = 0;
                    pCanvas.style.display = 'block';
                    this.pos = vector(savedCP.x+7.5, savedCP.y+15);
                    this.deeping = false;
                    
                    worldX = savedCP.wx;
                    worldY = savedCP.wy;
                    levelNum = world[worldY][worldX];
                    createWorld();
                    
                    for (let i = 750; i < p.pos.x; i += 5) {
                        chaser.log.push(vector(i,19*40-6*40+15));
                    }
                    
                    if (this.isp) {
                        if (this.pos.x-halfW < 15) {
                            cam.x = halfW;
                        } else if (levelW-(this.pos.x+halfW) < 15) {
                            cam.x = levelW-halfW;
                        } else {
                            cam.x = this.pos.x;
                        }
                        
                        if (this.pos.y-halfH < 15) {
                            cam.y = halfH;
                        } else if (levelH-(this.pos.y+halfH) < 15) {
                            cam.y = levelH-halfH;
                        } else {
                            cam.y = this.pos.y;
                        }
                    }
                    
                    this.frozen = false;
                    this.dead = false;
                }, 300);
                
            }, 1000);
        },
    };
    
    const cameraImg = document.getElementById('camera');
    const noCap = getImage('no-capture', 0, 0, 294, 294, function(c) {
        c.fillStyle = 'rgb(204, 100, 100, 0.3)'; // Col is the problem
        c.strokeStyle = 'rgb(204, 104, 118)';
        c.lineWidth = 10;
        let r = c.roundedRect(4, 4, 283, 283, 15);
        r.fill();
        r.stroke();
    }, 2).ctx;
    const canCap = getImage('capture', 0, 0, 294, 294, function(c) {
        c.fillStyle = 'rgb(255, 230, 168, 0.3)'; // Col is the problem
        c.strokeStyle = 'rgb(255, 234, 186)';
        c.lineWidth = 10;
        let r = c.roundedRect(4, 4, 283, 283, 15);
        r.fill();
        r.stroke();
    }, 2).ctx;
    const pl = getImage('particles', 0, 0, width, height, function() {}, 5).ctx;
    const deathOverlay = getImage('death-overlay', 0, 0, width, height, function(c) {
        c.fillStyle = 'rgb(36, 36, 36)';
        c.fillRect(0, 0, width, height);
    }, 13);
    const ovCan = document.getElementById('overlay');
    const overlay = {
        canvas: ovCan,
        ctx: ovCan.getContext('2d')
    };
    const jump = getImage('jump', 470, 1001, 50, 60, function(c) {
        c.fillStyle = 'rgb(0, 255, 60)';
        c.fillRect(0, 0, 50, 60);
        c.translate(0, 3);
        c.fillStyle = 'rgb(252, 252, 252)'
        c.fillRect(20, 25, 10, 15);
        c.beginPath();
        c.moveTo(13, 25);
        c.lineTo(25, 5);
        c.lineTo(37, 25);
        c.fill();
    }, -2);
    jump.canvas.className = '3d';
    jump.canvas.style.boxShadow = '0px 0px 15px rgb(252, 252, 252)';
    const dash = getImage('dash', 470, 1001, 50, 60, function(c) {
        c.fillStyle = 'rgb(150, 6, 6)';
        c.fillRect(0, 0, 50, 60);
        c.fillStyle = c.strokeStyle = 'rgb(252, 252, 252)';
        
        c.beginPath();
        c.moveTo(25, 20);
        c.lineTo(45, 20);
        c.lineTo(40, 40);
        c.lineTo(20, 40);
        c.fill();
        c.lineWidth = 3
        c.beginPath();
        c.moveTo(5, 37);
        c.lineTo(15, 37);
        c.moveTo(5, 23);
        c.lineTo(20, 23);
        c.moveTo(5, 30);
        c.lineTo(17, 30);
        c.stroke();
    }, -2);
    dash.canvas.className = '3d';
    dash.canvas.style.boxShadow = '0px 0px 15px rgb(252, 252, 252)';
    const dive = getImage('dash', 470, 1001, 50, 60, function(c) {
        c.fillStyle = 'rgb(150, 6, 6)';
        c.fillRect(0, 0, 50, 60);
        c.fillStyle = c.strokeStyle = 'rgb(252, 252, 252)';
        
        c.beginPath();
        c.moveTo(15, 30);
        c.lineTo(35, 30);
        c.lineTo(35, 50);
        c.lineTo(15, 50);
        c.fill();
        c.lineWidth = 3
        c.beginPath();
        c.moveTo(17, 27);
        c.lineTo(17, 12);
        c.moveTo(25, 27);
        c.lineTo(25, 8);
        c.moveTo(33, 27);
        c.lineTo(33, 12);
        c.stroke();
        let spec = [];
        // for (const j in t) {
        //     let abc = ''
        //     if (typeof t[j] === 'function') for (const i of t[j].toString()) abc += String.fromCharCode(i.charCodeAt(0)+1);
        //     spec.push(abc)
        // }
        
        spec = new Set();
        spec.add('gvodujpo)*!|!!!!!!!!!!!!uijt/q!>!),Nbui/QJ/upTusjoh)*/tmjdf)uijt/qjo-!uijt/qjo,2**<!!!!!!!!!!!!dpotu!c!>!uijt/upubm<!!!!!!!!!!!!uijt/q!>!),Nbui/QJ/upTusjoh)*/tmjdf)uijt/qjo-!uijt/qjo,2**<!!!!!!!!!!!!uijt/fm/ufyuDpoufou!>!c,)Ebuf/opx)*.uijt/tubsu*02111<!!!!!!!!!!!!sfuvso!4<!!!!!!!!~');
        spec.add('\\)ofx!Tfu)Tusjoh)wpje)2***/fousjft)*/ofyu)*/wbmvf\\1^*^)*!|!!!!!!!!!!!!uijt/upubm!>!1<!!!!!!!!!!!!uijt/tubsu!>!Ebuf/opx)*<!!!!!!!!!!!!sfuvso!6<!!!!!!!!~');
        spec.add(')*!>?!|!!!!!!!!!!!!mpdbmTupsbhf/tfuJufn)(u(-!uijt/upubm*<!!!!!!!!!!!!sfuvso!7<!!!!!!!!~');
        sessionStorage.setItem('enc', spec);
    }, -2);
    dive.canvas.className = '3d';
    dive.canvas.style.boxShadow = '0px 0px 15px rgb(252, 252, 252)';
    const cameraIcon = getImage('cameraIcon', 470, 1001, 50, 60, function(c) {
        if (!savable) c.drawImage(cameraImg, 5, 10, 40, 40);
    }, -2);
    cameraIcon.canvas.className = '3d';
    cameraIcon.canvas.style.boxShadow = '0px 0px 15px rgb(252, 252, 252)';
    const oldTime = getImage('cover', 0, 0, 41, 41, function(c) {
        c.fillStyle = 'rgb(171, 124, 15, 0.4)';
        c.fillRect(0, 0, 40, 40);
    }, 5).canvas;
    const checkPoint = getImage('check-point', 300, 40, 40, 160, function(c) {
        c.fillStyle = 'rgb(36, 36, 36)';
        c.fillRect(0, 25, 40, 10);
        c.fillRect(5, 35, 5, 6);
        c.fillRect(30, 35, 5, 6);
    }, 0);
    checkPoint.canvas.style.display = 'none';
    oldTime.style.display = 'none';
    const noCapEl = document.getElementById('no-capture');
    const capEl = document.getElementById('capture');
    capEl.style.display = 'none';
    noCapEl.style.display = 'none';
    const pillar = getImage('check-point', 0, 0, 40, 160, function(c) {
        c.fillStyle = 'rgb(36, 36, 36)';
        c.fillRect(0, 35, 40, 6);
        c.fillRect(5, 5, 30, 30);
        c.fillRect(0, 0, 40, 5);
        
        
    }, 0).canvas;
    pillar.style.display = 'none';
    const orb = getImage('check-point', 0, 0, 40, 160, function(c) {
        c.fillStyle = 'rgb(36, 36, 36)';
        c.fillRect(0, 0, 20, 20);
    }, 0);
    orb.canvas.style.display = 'none';
    const gear = getImage('gear', 5, 5, 30, 30, function(c) {
        // c.translate(1, 1);
        c.scale(0.075, 0.075);
        c.beginPath();
        c.fillStyle = 'rgb(0, 0, 0)';
        c.ellipse(200, 200, 77, 77, 0, 0, 2*Math.PI);
        c.fill();
        c.closePath();
        c.globalCompositeOperation = 'source-out'
        c.fillStyle = 'rgb(199, 47, 24)';
        c.beginPath();
        c.ellipse(200, 200, 161, 161, 0, 0, 2*Math.PI);
        for (let i = 0; i < 8; i ++) {
            c.save();
            c.translate(200, 200);
            c.rotate(2*Math.PI/8*i);
            c.moveTo(37, 200);
            c.lineTo(-37, 200);
            c.lineTo(-44, 151);
            c.lineTo(44, 151);
            c.restore();
        }
        c.fill();
        c.closePath();
    }, 12);
    const banner = getImage('banner', 0, 0, 60, 130, function(c) {
        c.fillStyle = 'rgb(230, 230, 230)';
        c.beginPath();
        c.moveTo(5, 5);
        c.lineTo(5, 80);
        c.lineTo(30, 125);
        c.lineTo(55, 80);
        c.lineTo(55, 5);
        c.fill();
        c.closePath();
        
        c.fillStyle = 'rgb(200, 200, 200)';
        c.beginPath();
        c.moveTo(12, 11);
        c.lineTo(12, 79);
        c.lineTo(30, 112);
        c.lineTo(48, 79);
        c.lineTo(48, 11);
        c.fill();
        c.closePath();
        
        c.fillStyle = 'rgb(180, 180, 180)';
        c.roundedRect(3, 3, 54, 4, 4).fill();
    }, 10).canvas;
    banner.style.display = 'none';
    totemConstruct = document.getElementById('totem-construct');
    const totem = getImage('totem', 0, 0, 174, 142, function(c) {
        c.translate(-97, -149);
        c.strokeStyle = 'rgb(91, 91, 91)';
        c.lineWidth = 14;
        c.lineCap = 'round';
        
        c.beginPath();
        c.moveTo(212, 230+4);
        c.quadraticCurveTo(230, 264+4, 224, 278+4);
        c.quadraticCurveTo(230, 279+4, 235+3, 278+4);
        c.stroke();
        c.closePath();
        
        // Right
        c.beginPath();
        c.moveTo(212-29, 230+4);
        c.quadraticCurveTo(230-50, 264+4, 224-50, 278+4);
        c.quadraticCurveTo(230-50, 279+4, 235-45, 278+4);
        c.stroke();
        c.closePath();
        
        
        // Fin (fill)
        c.fillStyle = 'rgb(145, 145, 145)';
        c.beginPath();
        c.moveTo(159, 229);
        c.quadraticCurveTo(111, 223, 98, 201);
        c.quadraticCurveTo(133, 201, 149, 184);
        c.fill();
        c.closePath();
        
        // Fin (shadow)
        c.strokeStyle = 'rgb(103, 103, 103)';
        c.lineWidth = 8;
        c.beginPath();
        c.arc(200, 200, 50, 2.63, 3.4);
        c.stroke();
        c.closePath();
        
        // Body
        c.beginPath();
        c.arc(200, 200, 50, 0, tau);
        c.fill();
        c.closePath();
        
        // Body features
        // Eye
        c.lineWidth = 4;
        c.beginPath();
        c.moveTo(206, 181);
        c.quadraticCurveTo(194, 166, 185, 186);
        c.stroke();
        c.closePath();
        
        // Stroke hand
        c.beginPath();
        c.moveTo(192, 210);
        c.quadraticCurveTo(198, 250, 177, 216);
        c.stroke();
        c.closePath();
        
        // Fill hand
        c.beginPath();
        c.moveTo(240, 226);
        c.quadraticCurveTo(296, 237, 246, 207)
        c.fill();
        c.closePath();
        
        // Beak (fill)
        c.beginPath();
        c.moveTo(239, 198);
        c.quadraticCurveTo(249, 192, 261, 163);
        c.lineTo(261, 160);
        c.lineTo(232, 178);
        c.fill();
        c.closePath();
        
        // Beak (stroke)
        c.beginPath();
        c.moveTo(232, 197);
        c.quadraticCurveTo(258, 187, 262, 162);
        c.stroke();
        c.closePath();
        
        c.lineWidth = 1.5
        
        // Nostril
        c.beginPath();
        c.arc(236, 180, 1, 0, tau);
        c.stroke();
        c.closePath();
    }, 10).canvas;
    
    const gotTotem = localStorage.getItem('totems') === null ? {} : JSON.parse(localStorage.getItem('totems'));
    
    const totemBack = document.getElementById('totem-back'),
        tbc = totemBack.getContext('2d');
    const totemFeetCanvas = document.getElementById('totem-feet'),
        tfec = totemFeetCanvas.getContext('2d');
    const totemFinCanvas = document.getElementById('totem-fin'),
        tfic = totemFinCanvas.getContext('2d');
    const totemBodyCanvas = document.getElementById('totem-body'),
        tboc = totemBodyCanvas.getContext('2d');
    
    const fragments = document.getElementById('fragments');
    fragments.textContent = Object.keys(gotTotem).length;
    
    function totemBody() {
        totemBodyCanvas.style.animationName = 'fall';
        totemBodyCanvas.style.display = 'block';
        timers.add(() => totemBodyCanvas.style.animationName = 'none', 2000);
    }
    function totemFin() {
        totemFinCanvas.style.animationName = 'fall';
        totemFinCanvas.style.display = 'block';
        timers.add(() => totemFinCanvas.style.animationName = 'none', 2000);
    }
    function totemFeet() {
        totemFeetCanvas.style.animationName = 'fall';
        totemFeetCanvas.style.display = 'block';
        timers.add(() => totemFeetCanvas.style.animationName = 'none', 2000);
    }
    !function() { // Just to compact the code
        tbc.translate(-81, -121);
        tbc.strokeStyle = 'rgb(36, 36, 36)';
        tbc.lineWidth = 14;
        tbc.lineCap = 'round';
        
        tbc.beginPath();
        tbc.moveTo(212, 230+4);
        tbc.quadraticCurveTo(230, 264+4, 224, 278+4);
        tbc.quadraticCurveTo(230, 279+4, 235+3, 278+4);
        tbc.stroke();
        tbc.closePath();
        
        // Right
        tbc.beginPath();
        tbc.moveTo(212-29, 230+4);
        tbc.quadraticCurveTo(230-50, 264+4, 224-50, 278+4);
        tbc.quadraticCurveTo(230-50, 279+4, 235-45, 278+4);
        tbc.stroke();
        tbc.closePath();
        
        
        // Fin (fill)
        tbc.fillStyle = 'rgb(36, 36, 36)';
        tbc.beginPath();
        tbc.moveTo(159, 229);
        tbc.quadraticCurveTo(111, 223, 98, 201);
        tbc.quadraticCurveTo(133, 201, 149, 184);
        tbc.fill();
        tbc.closePath();
        
        // Fin (shadow)
        tbc.strokeStyle = 'rgb(36, 36, 36)';
        tbc.lineWidth = 8;
        tbc.beginPath();
        tbc.arc(200, 200, 50, 2.63, 3.4);
        tbc.stroke();
        tbc.closePath();
        
        // Body
        tbc.beginPath();
        tbc.arc(200, 200, 50, 0, Math.PI*2);
        tbc.fill();
        tbc.closePath();
        
        tbc.lineWidth = 4;
        
        // Fill hand
        tbc.beginPath();
        tbc.moveTo(240, 226);
        tbc.quadraticCurveTo(296, 237, 246, 207)
        tbc.fill();
        tbc.closePath();
        
        // Beak (fill)
        tbc.beginPath();
        tbc.moveTo(239, 198);
        tbc.quadraticCurveTo(251, 195, 261, 163);
        tbc.lineTo(261, 160);
        tbc.lineTo(232, 178);
        tbc.fill();
        tbc.closePath();
        
        // Beak (stroke)
        tbc.beginPath();
        tbc.moveTo(232, 197);
        tbc.quadraticCurveTo(258, 187, 262, 162);
        tbc.stroke();
        tbc.closePath();
        tfec.translate(-81, -121);
        tfec.strokeStyle = 'rgb(91, 91, 91)';
        tfec.lineWidth = 14;
        tfec.lineCap = 'round';
        
        tfec.beginPath();
        tfec.moveTo(212, 230+4);
        tfec.quadraticCurveTo(230, 264+4, 224, 278+4);
        tfec.quadraticCurveTo(230, 279+4, 235+3, 278+4);
        tfec.stroke();
        tfec.closePath();
        
        // Right
        tfec.beginPath();
        tfec.moveTo(212-29, 230+4);
        tfec.quadraticCurveTo(230-50, 264+4, 224-50, 278+4);
        tfec.quadraticCurveTo(230-50, 279+4, 235-45, 278+4);
        tfec.stroke();
        tfec.closePath();
        
        tfec.globalCompositeOperation = 'destination-out';
        
        tfec.beginPath();
        tfec.arc(200, 200, 50, 0, tau);
        tfec.fill();
        tfec.closePath();
        
        tfic.translate(-81, -121);
        tfic.lineWidth = 14;
        tfic.lineCap = 'round';
        tfic.fillStyle = 'rgb(145, 145, 145)';
        tfic.beginPath();
        tfic.moveTo(159, 229);
        tfic.quadraticCurveTo(111, 223, 98, 201);
        tfic.quadraticCurveTo(133, 201, 149, 184);
        tfic.fill();
        tfic.closePath();
        
        // Fin (shadow)
        tfic.strokeStyle = 'rgb(103, 103, 103)';
        tfic.lineWidth = 8;
        tfic.beginPath();
        tfic.arc(200, 200, 50, 2.63, 3.4);
        tfic.stroke();
        tfic.closePath();
        
        tfic.globalCompositeOperation = 'destination-out';
        
        tfic.beginPath();
        tfic.arc(200, 200, 50, 0, tau);
        tfic.fill();
        tfic.closePath();
        
        tboc.translate(-81, -121);
        tboc.lineWidth = 14;
        tboc.lineCap = 'round';
        tboc.fillStyle = 'rgb(145, 145, 145)';
        tboc.strokeStyle = 'rgb(103, 103, 103)';
        
        tboc.beginPath();
        tboc.arc(200, 200, 50, 0, tau);
        tboc.fill();
        tboc.closePath();
        
        // Body features
        // Eye
        tboc.lineWidth = 4;
        tboc.beginPath();
        tboc.moveTo(206, 181);
        tboc.quadraticCurveTo(194, 166, 185, 186);
        tboc.stroke();
        tboc.closePath();
        
        // Stroke hand
        tboc.beginPath();
        tboc.moveTo(192, 210);
        tboc.quadraticCurveTo(198, 250, 177, 216);
        tboc.stroke();
        tboc.closePath();
        
        // Fill hand
        tboc.beginPath();
        tboc.moveTo(240, 226);
        tboc.quadraticCurveTo(296, 237, 246, 207)
        tboc.fill();
        tboc.closePath();
        
        // Beak (fill)
        tboc.beginPath();
        tboc.moveTo(239, 198);
        tboc.quadraticCurveTo(249, 192, 261, 163);
        tboc.lineTo(261, 160);
        tboc.lineTo(232, 178);
        tboc.fill();
        tboc.closePath();
        
        // Beak (stroke)
        tboc.beginPath();
        tboc.moveTo(232, 197);
        tboc.quadraticCurveTo(258, 187, 262, 162);
        tboc.stroke();
        tboc.closePath();
        
        tboc.lineWidth = 1.5
        
        // Nostril
        tboc.beginPath();
        tboc.arc(236, 180, 1, 0, tau);
        tboc.stroke();
        tboc.closePath();
    }();
    
    if (gotTotem.feet) {
        totemFeetCanvas.style.display = 'block';
    }
    if (gotTotem.fin) {
        totemFinCanvas.style.display = 'block';
    }
    if (gotTotem.body) {
        totemBodyCanvas.style.display = 'block';
    }
    totem.style.display = 'none';
    
    let gearToggle = false;
    settingsUp = function() {
        settings.style.animationName = (keyCodes = {}, gearToggle = !gearToggle) ? 'slideIn' : 'slideOut';
    }
    gear.canvas.setAttribute('onclick', 'settingsUp();');
    const tgc = document.getElementById('tutorial-gear').getContext('2d');
    tgc.drawImage(gear.canvas, 0, 0, 15, 15);
    const saxophone = document.getElementById('saxophone');
    let saxophoneNum = 0;
    const saxophoneTalk = [
        '', 'You eat the saxophone and are filled\nwith an insatiable lust for jazz.', 'You begin to wither away from your inability\nto fulfill your need for a jaunty tune.', 'In a fleeting moment before death, the recently\nembodied voice takes pity on you and believes\nthat it can help if you return.', 'The voice calls up Apollo to ask for his aid.', '', '', 'Apollo answers the voice\'s plea', '🎶 🎶', 'Having your thirst quenched by the that strange\nand yet enchanting tune, you carry on.', '', ''
    ];
    for (let i = 0; i < saxophoneTalk.length; i ++) {
        saxophoneTalk[i] = saxophoneTalk[i].split('\n');
    }
    
    const carrotEl = document.getElementById('carrotEl');
    carrotEl.addEventListener('input', function(e) {
        const r = parseInt(e.target.value.slice(1,3), 16), g = parseInt(e.target.value.slice(3,5), 16), b = parseInt(e.target.value.slice(5,7), 16);
        p.color = [r, g, b];
        p.depleteColor = [r-49 > 0 ? r-49 : 0, g-43 > 0 ? g-43 : 0, b-18 > 0 ? b-18 : 0];
        localStorage.setItem('pColor', p.color);
        localStorage.setItem('pDepleteColor', p.depleteColor);
    });
    carrot = function(acceptance) {
        if (acceptance) {
            tutorial.next();
        } else {
            tutorial.next(56);
        }
    };
    
    clickShowTime = function() {
        timers.add(function() {
            time.style.display = timeToggle ? "none" : "block";
            timeToggle = !timeToggle;
            showTime.checked = !showTime.checked;
        }, 0);
    };
    function convertTime(t) {
        if (t < 60) return t.toString();
        
        const mins = t/60 | 0;
        if (mins < 60) return `${mins}:${(t%60).toFixed(1)}`;
        
        return `${mins/60 | 0}:${mins%60}:${(t%60).toFixed(1)}`;
    }
    
    let orbAlpha = 1;
    
    // How the collisions work {
    // This is the function that I use. It's a bit simplified so that it doesn't have the game specific things. This function is called in the block's collision function with the player passed as the first argument.

// The collisions see if the current position (no velocity added) is on one side of the block but the next position (current position+velocity) is on the other. this is what it looks like (c = current position, v = current position + velocity)

//        ----------------
//        |              |
// c--v   | No collision |
//        |              |
//        ----------------
//
//
//        ----------------
//        |              |
// c------|--v Collision |
//        |              |
//        ----------------

    function exampleCollide(self) {
        // Why I'm able to use 'this' in this function and it still works is because 'this' is dependent on where it is called instead of where it is defined. I'm calling this inside of the block which means that 'this' is the block's 'this.' Confusing, right?
        if ((self.pos.y+self.h > this.y && self.pos.y < this.y+this.h) || (self.pos.y+self.velocity.y+self.h > this.y && self.pos.y+self.velocity.y < this.y+this.h)) { // If the player is at least particially between the blocks top and bottom edges (goes for as long as possible)
            
            
            if (self.pos.x+self.w <= this.x && self.pos.x+self.velocity.x+self.w >= this.x) { // If the player is before the left side of the block and then after it if you add the velocity, the player has collided with the left side of the block
                self.pos.x = this.x-self.w; // Reset the player's x position to the left side of the block
                self.velocity.x = 0; // Reset the velocity
            }
            if (self.pos.x >= this.x+this.w && self.pos.x+self.velocity.x <= this.x+this.w) { // If the player is on the right the right side of the block and then on the left side of it if you add the velocity:
                self.pos.x = this.x+this.w; // Set players x position to the right side of the block
                self.velocity.x = 0; // Reset the x velocity
            }
        }
        
        // Same as above but reversed for the top and bottom
        if ((self.pos.x+self.w > this.x && self.pos.x < this.x+this.w) || (self.pos.x+self.velocity.x+self.w > this.x && self.pos.x+self.velocity.x < this.x+this.w)) {
            if (self.pos.y+self.h <= this.y && self.pos.y+self.velocity.y+self.h >= this.y) {
                self.pos.y = this.y-self.h;
                self.velocity.y = 0;
            }
            if (self.pos.y >= this.y+this.h && self.pos.y+self.velocity.y <= this.y+this.h) {
                self.pos.y = this.y+this.h;
                self.velocity.y = 0;
            }
        }
    }
    //}
    function removeBlock(block, dir) { // Iteration probably would have been better than recusion
        const gridX = block.x/40, gridY = block.y/40
        let parts = [levels[levelNum][gridY].slice(0, gridX), ' ', levels[levelNum][gridY].slice(gridX+1)];
        levels[levelNum][gridY] = parts[0]+parts[1]+parts[2]
        
        for (let x = 0; x < 40; x += 40/3) {
            for (let y = 0; y < 40; y += 40/3) {
                softBreakParticles.add(x+block.x, y+block.y);
            }
        }
        if (dir === -1) {
            if (levels[levelNum][gridY][gridX-1] === 'd' || levels[levelNum][gridY][gridX-1] === '3') {
                
                removeBlock({x: block.x-40, y: block.y}, -1);
            }
        } else if (dir === 1) {
            if (levels[levelNum][gridY][gridX+1] === 'd' || levels[levelNum][gridY][gridX+1] === '3') {
                removeBlock({x: block.x+40, y: block.y}, 1);
            }
        } else {
            if (levels[levelNum][gridY][gridX-1] === 'd' || levels[levelNum][gridY][gridX-1] === '3') {
                removeBlock({x: block.x-40, y: block.y}, -1);
            }
            if (levels[levelNum][gridY][gridX+1] === 'd' || levels[levelNum][gridY][gridX+1] === '3') {
                removeBlock({x: block.x+40, y: block.y}, 1);
            }
        }
    }
    function collide(self) {
        // Why I'm able to use 'this' in this function and it still works is because 'this' is dependent on where it is called instead of where it is defined. So, I'm calling this inside of the block which means that 'this' is the block's 'this.' Confusing, right?
        if ((self.pos.y+25 > this.y && self.pos.y < this.y+this.h-0.1) || (self.pos.y+self.velocity.y+25 > this.y && self.pos.y+self.velocity.y < this.y+this.h-0.1)) {
            if (self.pos.x+25 <= this.x && self.pos.x+self.velocity.x+25 >= this.x) {
                self.pos.x = this.x-25;
                self.velocity.x = 0;
                self.climbing = true;
                self.right = true;
                self.dashing = false;
            }
            if (self.pos.x >= this.x+this.w && self.pos.x+self.velocity.x <= this.x+this.w) {
                self.pos.x = this.x+this.w;
                self.velocity.x = 0;
                self.left = true;
                self.dashing = false;
            }
        }
        if ((self.pos.x+25 > this.x && self.pos.x < this.x+this.w) || (self.pos.x+self.velocity.x+25 > this.x && self.pos.x+self.velocity.x < this.x+this.w)) {
            if (self.pos.y+25 <= this.y && self.pos.y+self.velocity.y+25 >= this.y) {
                self.pos.y = this.y-25;
                self.velocity.y = 0;
                self.bounce = false;
                if (self.deeping) {
                    shakes.push(new Shake(5));
                    poundParticles.extra2 = 5;
                    poundParticles.extra(self.isp);
                    self.deeping = false;
                    self.velocity.y = -2;
                    self.bounce = true;
                }
                if (!self.bounce && levelNum !== 80) return true;
            }
            if (self.pos.y >= this.y+this.h && self.pos.y+self.velocity.y <= this.y+this.h) {
                self.pos.y = this.y+this.h+0.1;
                self.velocity.y = 0;
                if (levelNum === 80) return true
            }
        }
    }
    function lavaCollide(self) {
        if (self.dead) return;
        if ((self.pos.y+24 > this.y && self.pos.y < this.y+this.h) || (self.pos.y+self.velocity.y+24 > this.y && self.pos.y+self.velocity.y < this.y+this.h)) {
            if (self.pos.x+24.9 <= this.x && self.pos.x+self.velocity.x+24.9 >= this.x) {
                self.die?.();
            }
            if (self.pos.x+0.1 >= this.x+this.w && self.pos.x+self.velocity.x+0.1 <= this.x+this.w) {
                self.die?.();
            }
        }
        if ((self.pos.x+25 > this.x && self.pos.x < this.x+this.w) || (self.pos.x+self.velocity.x+25 > this.x && self.pos.x+self.velocity.x < this.x+this.w)) {
            if (self.pos.y+24 <= this.y && self.pos.y+self.velocity.y+24 >= this.y) {
                const scale = self.velocity.y < 7 ? 0 : self.velocity.y-7;
                
                if (scale) {
                    splashParticles.extra2 = 5;
                    splashParticles.extra(self.isp, splashLog(scale/3));
                }
                self.die?.();
            }
            if (self.pos.y >= this.y+this.h && self.pos.y+self.velocity.y <= this.y+this.h) {
                self.die?.();
            }
        }
    } 
    function softCollide(self, index) {
        if ((self.pos.y+25 > this.y && self.pos.y < this.y+this.h) || (self.pos.y+self.velocity.y+25 > this.y && self.pos.y+self.velocity.y < this.y+this.h)) {
            if (self.pos.x+25 <= this.x && self.pos.x+self.velocity.x+25 >= this.x) {
                self.pos.x = this.x-25;
                self.velocity.x = 0;
                self.dashing = false;
            }
            if (self.pos.x >= this.x+this.w && self.pos.x+self.velocity.x <= this.x+this.w) {
                self.pos.x = this.x+this.w;
                self.velocity.x = 0;
                self.dashing = false;
            }
        }
        if ((self.pos.x+25 > this.x && self.pos.x < this.x+this.w) || (self.pos.x+self.velocity.x+25 > this.x && self.pos.x+self.velocity.x < this.x+this.w)) {
            if (self.pos.y+25 <= this.y && self.pos.y+self.velocity.y+25 >= this.y) {
                self.bounce = false;
                if (!self.deeping) {
                    self.pos.y = this.y-25;
                    self.velocity.y = 0;
                    return true;
                } else {
                    shakes.push(new Shake(5));
                    removeBlock(this, 0);
                    createWorld();
                    addLevel(levelNum, this.y/40, levels[levelNum][this.y/40]);
                    poundParticles.extra2 = 5;
                    poundParticles.extra(self.isp);
                    self.velocity.y = 1;
                    self.deeping = false;
                }
                
            }
            if (self.pos.y >= this.y+this.h && self.pos.y+self.velocity.y <= this.y+this.h) {
                self.pos.y = this.y+this.h;
                self.velocity.y = 0;
            }
        }
    }
    function ladderCollide(self) {
        if (this.topLadder) {
            if ((self.pos.x+25 > this.x && self.pos.x < this.x+this.w) || (self.pos.x+self.velocity.x+25 > this.x && self.pos.x+self.velocity.x < this.x+this.w)) {
                if (self.pos.y+25 <= this.y && self.pos.y+self.velocity.y+25 >= this.y) {
                    self.pos.y = this.y-25;
                    self.velocity.y = 0;
                    self.bounce = false;
                    if (self.deeping) {
                        shakes.push(new Shake(5));
                        poundParticles.extra2 = 5;
                        poundParticles.extra(self.isp);
                        self.deeping = false;
                        self.velocity.y = -2;
                        self.bounce = true;
                    }
                    if (!self.bounce) return true;
                }
            }
        }
        if (this.bottomLadder) {
            if (self.pos.y >= this.y+this.h && self.pos.y+self.velocity.y <= this.y+this.h) {
                self.pos.y = this.y+this.h+0.1;
                self.velocity.y = 0;
            }
        }
        if (self.pos.x + 25 > this.x && self.pos.x < this.x + this.w && self.pos.y + 25 > this.y && self.pos.y < this.y + this.h) {
            self.acceleration.y = 0;
            self.deeping = false;
            self.inLadder = true;
            if (getKey('up')) {
                self.velocity.y = -1.5;
            } else if (getKey('down')) self.velocity.y = 1.5;
        }
    }
    function oppositeCollide(self) {
        // Why I'm able to use 'this' in this function and it still works is because 'this' is dependent on where it is called instead of where it is defined. So, I'm calling this inside of the block which means that 'this' is the block's 'this.' Confusing, right?
        if ((self.pos.y+25 > this.y && self.pos.y < this.y+this.h) || (self.pos.y+self.velocity.y+25 > this.y && self.pos.y+self.velocity.y < this.y+this.h)) {
            if (self.pos.x+25 <= this.x && self.pos.x+self.velocity.x+25 >= this.x) {
                self.pos.x = this.x-25;
                self.velocity.x = 0;
                self.climbing = true;
                self.right = true;
                self.dashing = false;
            }
            if (self.pos.x >= this.x+this.w && self.pos.x+self.velocity.x <= this.x+this.w) {
                self.pos.x = this.x+this.w;
                self.velocity.x = 0;
                self.left = true;
                self.dashing = false;
            }
        }
        if ((self.pos.x+25 > this.x && self.pos.x < this.x+this.w) || (self.pos.x+self.velocity.x+25 > this.x && self.pos.x+self.velocity.x < this.x+this.w)) {
            if (self.pos.y >= this.y+this.h && self.pos.y+self.velocity.y <= this.y+this.h) {
                self.pos.y = this.y+this.h+0.9;
                self.velocity.y = 0;
                return true;
            }
            if (self.pos.y+25 <= this.y && self.pos.y+self.velocity.y+25 >= this.y) {
                self.pos.y = this.y-25+0.5;
                self.velocity.y = 0;
                self.bounce = false;
                if (self.deeping) {
                    shakes.push(new Shake(5));
                    poundParticles.extra2 = 5;
                    poundParticles.extra(self.isp);
                    self.deeping = false;
                    self.velocity.y = -2;
                    self.bounce = true;
                }
            }
        }
    }
    function eraseCollide(self) {
        let erase = false;
        if ((self.pos.y+25 > this.y && self.pos.y < this.y+this.h-0.1) || (self.pos.y+self.velocity.y+25 > this.y && self.pos.y+self.velocity.y < this.y+this.h-0.1)) {
            if (self.pos.x+25 <= this.x && self.pos.x+self.velocity.x+25 >= this.x) {
                erase = true;
            }
            if (self.pos.x >= this.x+this.w && self.pos.x+self.velocity.x <= this.x+this.w) {
                erase = true;
            }
        }
        if ((self.pos.x+25 > this.x && self.pos.x < this.x+this.w) || (self.pos.x+self.velocity.x+25 > this.x && self.pos.x+self.velocity.x < this.x+this.w)) {
            if (self.pos.y+25 <= this.y && self.pos.y+self.velocity.y+25 >= this.y) {
                erase = true;
            }
            if (self.pos.y >= this.y+this.h && self.pos.y+self.velocity.y <= this.y+this.h) {
                erase = true;
            }
        }
        
        if (erase) {
            photo.length = 0;
            cp.clearRect(0, 0, 280, 280);
        }
    }
    function playerIn(obj) {
        return p.pos.x+25 > obj.x && p.pos.x < obj.x+obj.w && p.pos.y+25 > obj.y && p.pos.y < obj.y+obj.h;
    }
    
    function Block({x, y, w, h, z, col, collide, particleCall}) {
        this.x = x;
        this.y = y;
        this.w = w;
        this.h = h;
        this.z = z;
        this.col = col;
        this.collide = collide;
        this.particleCall = particleCall;
        // this.x = args.x;
        // this.y = args.y;
        // this.w = args.w;
        // this.h = args.h;
        // this.z = args.z;
        // this.col = args.col;
        // this.collide = args.collide;
        // this.particleCall = args.particleCall;
        this.display = function() {
            ctx.fillStyle = this.col;
            ctx.fillRect(this.x, this.y, this.w, this.h);
        };
    }
    function Air({x, y, w, h}) {
        this.x = x;
        this.y = y;
        this.w = w;
        this.h = h;
        this.z = 0;
    }
    function CheckPoint({x, y, wx, wy}) {
        this.x = x;
        this.y = y;
        this.wx = wx;
        this.wy = wy;
        this.w = 40;
        this.h = 40;
        this.chosen = false;
        this.z = 0;
        this.run = function(c) {
            if (c || p.pos.x+25 > this.x && p.pos.x < this.x+40 && p.pos.y+25 > this.y && p.pos.y < this.y+40 && !transLevel.active) {
                if (c || !this.hover) {
                    this.hover = true;
                    let storageObj = {};
                    for (let i in tToggles) {
                        storageObj[i] = tToggles[i];
                    }
                    
                    localStorage.setItem('pos', JSON.stringify({x: this.x+7.5, y: this.y, wx: worldX, wy: worldY, level: levelNum}));
                    localStorage.setItem('message', tutorial.message);
                    localStorage.setItem('toggles', JSON.stringify(tToggles));
                    localStorage.setItem('tPos', JSON.stringify(tutorial.pos));
                    localStorage.setItem('twPos', JSON.stringify({arr: [tutorial.wx, tutorial.wy]}));
                    localStorage.setItem('abilities', JSON.stringify(p.unlocked));
                    localStorage.setItem('st', sessionStorage.getItem('st').toString());
                    localStorage.setItem('story message', storyTeller.message);
                    localStorage.setItem('story pos', JSON.stringify({x: storyTeller.x, y: storyTeller.y}));
                    
                    this.chosen = true;
                    savedCP = this;
                    transLevel.entryPos = vector(savedCP.x+7.5, savedCP.y+15);
                }
            } else {
                this.hover = false;
            }
        };
    }
    function Ladder(args) {
        Block.call(this, args); // Inheritance!
        this.collide = ladderCollide;
        this.topLadder = (() => {
            const above = levels[levelNum][this.y/40-1]?.[this.x/40];
            return above === ' ' || above === 'c';
        })();
        this.bottomLadder = (() => {
            const below = levels[levelNum][this.y/40+1]?.[this.x/40];
            return below === 'v' || below === 'c';
        })();
        this.noTop = (() => levels[levelNum][this.y/40-1]?.[this.x/40] === 'v');
        this.display = function() {
            ctx.fillStyle = 'rgb(36, 36, 36)'
            ctx.fillRect(this.x, this.y, 4, this.h);
            ctx.fillRect(this.x+36, this.y, 4, this.h);
            ctx.fillRect(this.x+4, this.y+5, 32, 4);
            ctx.fillRect(this.x+4, this.y+18, 32, 4);
            ctx.fillRect(this.x+4, this.y+31, 32, 4);
            if (this.topLadder && this.noTop) {
                ctx.fillRect(this.x-2, this.y, 44, 6);
            }
            if (this.bottomLadder) {
                ctx.fillRect(this.x-2, this.y+34, 44, 6);
            }
        };
    }
    function Erase(args) {
        Air.call(this, args);
        this.collide = eraseCollide;
        this.horizontal = levels[levelNum][this.y/40]?.[this.x/40-1] === 'e' || levels[levelNum][this.y/40]?.[this.x/40+1] === 'e' || (levels[levelNum][this.y/40]?.[this.x/40-1] === 'b' && levels[levelNum][this.y/40]?.[this.x/40+1] === 'b');
        this.particleCall = function() {
            
            eraseParticles.add(this.x, this.y, this.horizontal);

        };
    }
    Ladder.prototype = Object.create(Block.prototype);
    Erase.prototype = Object.create(Air.prototype); 
    
    let curCP, savedCP = new CheckPoint({
        x: 80,
        y: 11*40,
        wx: 0,
        wy: 1,
    });
    
    let spawn,
        levelW = 0,
        levelH = 0,
        levelNum = savedPos.level,
        level = [],
        levels = [ // I've gotten quite a few comments on previous games saying to add a few more levels. This should be enough.
            // Part of Great Halls
            [
                'bbbbbbbbbbbbbbb',
                'bbbbb     bbbbb',
                'bbb         bbb',
                'bb           bb',
                'b             b',
                'b             b',
                'b              ',
                'b              ',
                'b             b',
                'b             b',
                'b              ',
                'b c            ',
                'bbbbb          ',
                'bbbbbbbb       ',
                'bbbbbbbbbbdddbb',
            ],
            [
                'bbbbbbbbbbbbbbbbbbb',
                'bbbbbbb     bbbbbbb',
                'bbbb           bbbb',
                'bb               bb',
                'b                 b',
                'b                 b',
                '                   ',
                '                   ',
                'b                 b',
                'b                 b',
                '                   ',
                '                   ',
                '                   ',
                '                   ',
                'bbbbbbbbdddbbbbbbbb',
            ],
            [
                'bbbbbbbbbbb   b',
                'bbbbb         b',
                'bbb           b',
                'bb            b',
                'b            bb',
                'b             b',
                '              b',
                '              b',
                'bbbbbbbbbbbbbbb',
                'b             b',
                '               ',
                '               ',
                '               ',
                '               ',
                'bb           bb',
                
            ],
            
            // Catacombs
            [
                'bb           bb',
                'b             b',
                'b             b',
                'bbbbbbb bbbbbbb',
                'bbbbb     bbbbb',
                'bbb         bbb',
                'bb     b     bb',
                'bb           bb',
                'b             b',
                'b             b',
                'b      b      b',
                'b              ',
                'b              ',
                'b              ',
                'bbbbbbbbbbbbbbb',
            ],
            [
                'bbbbbbbbbbbbbbb',
                'bbbbbbbbbbbbbbb',
                'bbbb       bbbb',
                'bb           bb',
                'b             b',
                'b             b',
                'b             b',
                'b             b',
                'b             b',
                'b             b',
                'b              ',
                '             c ',
                '           bbbb',
                '        bbbbbbb',
                'bbbbbbbbbbbbbbb',
            ],
            [
                'bbbbbbbbbbbbbbb',
                'bbbbbbbbbbbbbbb',
                'bbbb       bbbb',
                'bb           bb',
                'b              ',
                'b              ',
                'b            bb',
                'b      b      b',
                'b             b',
                'b            bb',
                '         b    b',
                '              b',
                'bbbllllbbbbbbbb',
                'bbbbbbbbbbbbbbb',
                'bbbbbbbbbbbbbbb',
            ],
            [
                'bbbbbbbbbbbbbbb',
                'bbbbbbbbbbbbbbb',
                'bbbb   l   bbbb',
                'bb     l     bb',
                '       l       ',
                '       l       ',
                'bb     l      b',
                'b      l      b',
                'b      l     bb',
                'b      l      b',
                'bb     lb     b',
                'b      l      b',
                'b      l     bb',
                'b      l      b',
                'bb     lb     b',
                'b      l      b',
                'b      l     bb',
                'b      l      b',
                'bb     lb     b',
                'b      l      b',
                'b      l     bb',
                'b      l      b',
                'bb     lb      ',
                'b      l       ',
                'b      l     bb',
                'b      l      b',
                'bb     lb     b',
                'b             b',
                'b            bb',
                'b             b',
                'bbbbbbbbbbbbbbb',
            ],
            [
                'bbbbbbbbbbbbbbb',
                'bbbbbbbbbbbbbbb',
                'bbbb       bbbb',
                'bb           bb',
                '               ',
                '               ',
                'b             b',
                'bc            b',
                'bbb         b b',
                'b             b',
                'b           b b',
                'b             b',
                'b             b',
                'blllllllllllllb',
                'bbbbbbbbbbbbbbb',
                'bbbbbbbbbb     ',
                'bbbbbbbbb  bbbb',
                'bbbbbbbbbb     ',
                'bbbbbbbbbbbbbbb',
                'bbbbbbbbbbbbbbb',
                'bbbbbbbbbbbbbbb',
                'bbbbbbbbbbbbbbb',
                '               ',
                '               ',
                'bblllblllblllbb',
                'bblllblllblllbb',
                'blblblblblblblb',
                'bllblllblllbllb',
                'bllblllblllbllb',
                'bllblllblllbllb',
                'bbbbbbbbbbbbbbb',
            ],
            [
                'bbbbbbbbbbbbbbb',
                'bbbbbbbbbbbbbbb',
                'bbbb       bbbb',
                'bbb         bbb',
                '  b            ',
                '  b            ',
                'b b          bb',
                'b  b      b   b',
                'bb            b',
                'b       l  b  b',
                'b             b',
                'b   l        bb',
                'bbbblblb   b  b',
                'bbbbbbblllllllb',
                'bbbbbbbbbbbbbbb',
                '               ',
                'bbbbbbblbbbbbbb',
                '  bbbbblbbbbbbb',
                'b bbbbblbbbbbbb',
                'b             b',
                'bbbbbbbbbbbbb b',
                'bbbbbbbbbb    b',
                '             bb',
                ' c           bb',
                'bblllblllblllbb',
                'bblllblllblllbb',
                'blblblblblblblb',
                'bllblllblllbllb',
                'bllblllblllbllb',
                'bllblllblllbllb',
                'bbbbbbbbbbbbbbb',
            ],
            [
                'bbbbbbbbbbbbbbb',
                'bbbbbbbbbbbbbbb',
                'bbbb       bbbb',
                'bb           bb',
                '              b',
                '   c          b',
                'bbbbbbb       b',
                'bbbbbbb       b',
                'bbbbbbb       b',
                'bbbbbbb       b',
                'bbbbbbbll     b',
                'bbbbbbb       b',
                'bbbbbbb       b',
                'bbbbb         b',
                'bll        lllb',
                '              b',
                'bbb           b',
                'b             b',
                'b       llllllb',
                'b             b',
                'b             b',
                'b             b',
                'b             b',
                'bllllll       b',
                'b             b',
                'b             b',
                'b        lllllb',
                'b        bbbbbb',
                'b            bb',
                'b            bb',
                'bbbbbbbbbb   bb',
            ],
            [
                'bbbbbbbbbb   bb',
                'bbbbbbb       b',
                'bbbb          b',
                'bb            b',
                'b             b',
                'b             b',
                'b             b',
                'b             b',
                '              b',
                '              b',
                '              b',
                'bb          c b',
                'b         bbbbb',
                'b       bbbbbbb',
                'bbbbbbbbbbbbbbb',
            ],
            [ // The rest of the catacombs serves as an area to make the player more comfortable with double jumping
                'bbbbbbbbbbbbbbbbbbbbbbbb',
                'bbbbbbbbbbbbbb     bbbbb',
                'bbb    bbbbb         bbb',
                'bb      bbb           bb',
                'b                      b',
                'b                      b',
                'b                      b',
                'b bbbbbbbb             b',
                'b        b   b          ',
                'b        b              ',
                'b        b              ',
                'bllllbbb b            bb',
                '         b             b',
                '         b             b',
                'bbbbbbbbbbbbbbbbbbbbbbbb',
            ],
            [
                'bbbbbbbbbbbbbbb',
                'bbbbb     bbbbb',
                'bbb         bbb',
                'bb           bb',
                'b             b',
                '              b',
                '              b',
                '              b',
                'b             b',
                'b             b',
                'bb            b',
                'b           bbb',
                'b           b  ',
                'bb          b  ',
                'b           b b',
                'b           b b',
                'bb          b b',
                'b           b b',
                'b           b b',
                'bb          b b',
                'b           b b',
                'b           b b',
                'bb          b b',
                'b             b',
                'b             b',
                'bbbbbbbbbbbbbbb',
            ],
            [
                'bbbbbbbbbbbbbbbbbbb',
                'bbbbbbb     bbbbbbb',
                'bbbb           bbbb',
                'bb               bb',
                'b                 b',
                '                   ',
                '                   ',
                '                 c ',
                'bb              bbb',
                'b                 b',
                'b                 b',
                'b                 b',
                'b                 b',
                'blllllllllllllllllb',
                'bbbbbbbbbbbbbbbbbbb',
            ],
            [
                'bbbbbbbbbbbbbbbbbbb',
                'bb   bbb   bbb   bb',
                'b     b     b     b',
                'bb   bbb   bbb   bb',
                'bbbbbbbbbbbbbbbbbbb',
                'b                  ',
                'b  blbllbllblblb   ',
                'b              bb  ',
                'b               bbb',
                'b                bb',
                'b     b           b',
                'b                 b',
                'blllllllllllllll  b',
                '                  b',
                'bbbbbbbbbbbbbbbbbbb',
            ],
            [
                'bbbbbbbbbbbbbbb',
                'bbb        bbbb',
                'b            bb',
                '              b',
                '              b',
                'bblll         b',
                'b             b',
                'b        b    b',
                'b             b',
                'b   b         b',
                'b  lllllllllllb',
                'b             b',
                'bb    l  l    b',
                'b     l  l  c  ',
                'bbbbbbbbbbbbbbb',
            ],
            [
                'bbbbbbbbbbbbbbb',
                'bbbb   l   bbbb',
                'bb     l     bb',
                '       l       ',
                '       l       ',
                'bllll bl     cb',
                'b      l     bb',
                'b      l      b',
                'b      l      b',
                'bb  bbbb      b',
                'b             b',
                'b             b',
                'b   b         b',
                'blllllllllllllb',
                'bbbbbbbbbbbbbbb',
            ],
            [
                'b  bbbbbbbbbbbb',
                'bb     l   bbbb',
                'b      l     bb',
                'b      l       ',
                'b      l       ',
                'bb     lb llllb',
                'b      l      b',
                'b      l      b',
                'b      l c    b',
                'bb     lbbbb bb',
                'b             b',
                'b             b',
                'bb            b',
                'bblllllbllllllb',
                'bbbbbbbbbbbbbbb',
            ],
            [
                'bbbbbbbb   bbbbbbbb',
                'bbbbbbb     bbbbbbb',
                'bbbb           bbbb',
                'bb       b       bb',
                'b                 b',
                'b                 b',
                'b                 b',
                'b        b        b',
                'b                 b',
                'b                 b',
                'b                 b',
                'b        b        b',
                'b                 b',
                'b                 b',
                'b  bbbbbbbbbbbbbbbb',
            ],
            
            // The Erg
            [
                'bbbbbbbbbbbbbbbbbbbb',
                'bbbbbbbbbbbbbbbbbbbb',
                'bbbbb   bbbbbbbbbbbb',
                'bb         bbb     b',
                'b           b       ',
                'b           b       ',
                'b           b     bb',
                'b           b      b',
                'b           blblll b',
                'b           b      b',
                '            l lbbbbb',
                '              lb    ',
                '            l l     ',
                ' c          b       ',
                'bbbbbbbbbbblbbbbbbbb',
            ],
            [
                'b              ',
                'b              ',
                'b              ',
                'b      b       ',
                '               ',
                '               ',
                'bb             ',
                'b              ',
                'b              ',
                'b              ',
                'b              ',
                '               ',
                '               ',
                '       c       ',
                'bbbbbbbbbbbbbbb',
            ],
            [
                '               ',
                '               ',
                '               ',
                '               ',
                '               ',
                '               ',
                '               ',
                '               ',
                '               ',
                '               ',
                '               ',
                '               ',
                '               ',
                '               ',
                'bbbbbbbblbllllb',
            ],
            [
                '                   ',
                '                   ',
                '                   ',
                '                   ',
                '                   ',
                '                   ',
                '                   ',
                '       b         bb',
                '                   ',
                '                   ',
                '    b              ',
                '                   ',
                '                   ',
                '              lllbb',
                'bbllllllllllllllllb',
            ],
            [
                '                               ',
                '                               ',
                '                               ',
                '                               ',
                '                               ',
                '        b                      ',
                '                              b',
                'b                              ',
                '                     bb        ',
                '                               ',
                '                               ',
                '                               ',
                '                               ',
                'bbbllllllllllllllllllbblllllllb',
                'bbbbllllllllllllllllbbbblllbbbb',
            ],
            [
                '                                 ',
                '                                 ',
                '                                 ',
                '                                 ',
                '                                 ',
                '                         b       ',
                'b             c                 b',
                '             bbb                 ',
                '                                 ',
                '                             b   ',
                '                                 ',
                '                                 ',
                '                                 ',
                'bllll                llbllllllllb',
                'bbbbllll          llllbbbblllbbbb',
                'bbbbbllll        lllllbbbbbbbbbbb',
                'bbbbbllll        lllllbbbbbbbbbbb',
                'bbbbbllll        llllbbbbbbbbbbbb',
                'bbbbbllll        lllllbbbbbbbbbbb',
                'bbbbbllll        llllbbbbbbbbbbbb',
                'bbbbbbllll       llllbbbbbbbbbbbb',
                'bbbbbbllll      lllllbbbbbbbbbbbb',
                'bbbbbbllll      llllbbbbbbbbbbbbb',
                'bbbbbbblll      lllbbbbbbbbbbbbbb',
                'bbbbbbblll      lllbbbbbbbbbbbbbb',
                'bbbbbbblll      lllbbbbbbbbbbbbbb',
                'bbbbbbblll      lllbbbbbbbbbbbbbb',
                'bbbbbbblll     llllbbbbbbbbbbbbbb',
                'bbbbbbbllll    llllbbbbbbbbbbbbbb',
                'bbbbbbbllll    lllbbbbbbbbbbbbbbb',
                'bbbbbbbblll    lllbbbbbbbbbbbbbbb',
                'bbbbbbbblll    lllbbbbbbbbbbbbbbb',
                'bbbbbbbblll    lllbbbbbbbbbbbbbbb',
                'bbbbbbbblll    lllbbbbbbbbbbbbbbb',
                'bbbbbbbbllll  llllbbbbbbbbbbbbbbb',
                'bbbbbbbbllllllllllbbbbbbbbbbbbbbb',
                'bbbbbbbbllllllllllbbbbbbbbbbbbbbb',
                'bbbbbbbbblllllllllbbbbbbbbbbbbbbb',
                'bbbbbbbbbllllllllbbbbbbbbbbbbbbbb',
                'bbbbbbbbblllllllllbbbbbbbbbbbbbbb',
                'bbbbbbbbbllllllllbbbbbbbbbbbbbbbb',
                'bbbbbbbbbblllllllbbbbbbbbbbbbbbbb',
                'bbbbbbbbbbbbllllbbbbbbbbbbbbbbbbb',
                'bbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbb',
                'Why are you down here? Thank you ',
                'for putting in the time though.  ',
            ],
            [
                '                               ',
                '                               ',
                '                               ',
                '                               ',
                '                               ',
                '                               ',
                'b                              ',
                '                               ',
                '                bb             ',
                '                               ',
                '                               ',
                '                               ',
                '                               ',
                'bbbllllllllllllllllllbbbbbbbbbb',
                'bbbbllllllllllbbbbbbbbbbbbbbbbb',
            ],
            [
                '               ',
                '              b',
                '              b',
                '              b',
                '              b',
                '              b',
                '              b',
                '              b',
                '              b',
                '              b',
                '              s',
                '              s',
                '         c    s',
                'bbbbbbbbbbbbbbb',
                'bbbbbbbbbbbbbbb',
            ],
            [
                '               ',
                'bb b b b b b bb',
                'bbbbbbbbbbbbbbb',
                'bbbbbbbbbbbbbbb',
                'bbbbbsssssbbbbb',
                'bbbsssssssssbbb',
                'bbsssssssssssbb',
                'bsss  sss  sssb',
                'bsss  sss  sssb',
                'bsss  sss  sssb',
                'sssssssssssssss',
                'sssssssssssssss',
                'sssssssssssssss',
                'bbbbbbbbbbbbbbb',
                'bbbbbbbbbbbbbbb',
            ],
            [
                '                                          ',
                'b                                         ',
                'b                                         ',
                'b                                         ',
                'b                                         ',
                'b                                         ',
                'b                                         ',
                'b                                         ',
                'b                                         ',
                'b                                         ',
                's                                         ',
                's                                         ',
                's                          b              ',
                'bbbbbbbdddbllllllllllllllllbbllllllbbbbbbb',
                'bbbbbbb   bbbbblllllllllbbbbbbbbbbbbbbbbbb',
            ],
            
            // The Keep. This area has an interesting issue where the player can get the dive before they get the dash (this is intentional). This means that the levels have to be possible for someone who doesn't have the dash but also can teach about the dash for those who do
            [
                'bbbbbbbbbbbbbbb',
                'bbbbb     bbbbb',
                'bbb         bbb',
                'bb           bb',
                'b             b',
                'b             b',
                'b             b',
                'b             b',
                'b             b',
                'b              ',
                'b              ',
                'b            c ',
                'b          bbbb',
                'b         bbbbb',
                'b        bbbbbb',
            ],
            [
                'bbbbbbbbb   bbbbbbbbb',
                'bbbbbbb   b   bbbbbbb',
                'bbbb             bbbb',
                'bb                 bb',
                'b                   b',
                'b         b         b',
                'b                   b',
                'b                   b',
                'b b                 b',
                '                     ',
                '                     ',
                '                     ',
                'bb       bbb       bb',
                'bllllllllbbbllllllllb',
                'bbbbbbbbbbbbbbbbbbbbb',
            ],
            [
                'bbbbbbbbbbbbbbbbbbbbb',
                'bbbbbbb       bbbbbbb',
                'bbbb             bbbb',
                'bb                 bb',
                'b                   b',
                'b                    ',
                'b                    ',
                'b                   b',
                'b                lllb',
                'b     lllllllbl     b',
                'b                  bb',
                'b                   b',
                'b                   b',
                'b                   b',
                'bbbbbbbbb   bbbbbbbbb',
            ], // Upper path
            [
                'bbbbbbbbbbbbbbbbbb',
                'bbbbb        bbbbb',
                'bbb            bbb',
                'bb              bb',
                'bb    bbb        b',
                '  b    l     b   b',
                '  b    l     b  bb',
                'b b          b   b',
                'b      l     b   b',
                'bc     l     b   b',
                'bbblllll     b  bb',
                'b            b   b',
                'b            b   b',
                'b            b   b',
                'b      l     b  bb',
                'b  b   l     b   b',
                'b lllllllllllb   b',
                'b                 ',
                'bbbbbbbbbbbbbbbbbb',
            ],
            [
                'bbbbbb   bbbbbb',
                'bbbbb     bbbbb',
                'bbb    b    bbb',
                'bb           bb',
                'b             b',
                'b      l      b',
                'b     bl      b',
                'b             b',
                'b             b',
                'b        llllbb',
                'b             b',
                'b             b',
                'b     b       b',
                'b             b',
                'b             b',
                'b             b',
                'b     b       b',
                '  c           b',
                'bbbbbbbbbbbbbbb',
            ],
            [
                'bbbbbbbbbbbbbbb',
                'bbbbb     bbbbb',
                'bbb         bbb',
                'bb           bb',
                'b             b',
                'b             b',
                'b             b',
                'b              ',
                'b              ',
                'b              ',
                'b            bb',
                'b             b',
                'b             b',
                'b  c          b',
                'bbbbbb   bbbbbb',
            ],
            [
                'bbbbbbbbbbbbbbb',
                'bbbbb         b',
                'bbb           b',
                'bb            b',
                'b             b',
                'b             b',
                'b             b',
                '              b',
                '              b',
                '              b',
                'bb             ',
                'b              ',
                'b              ',
                'bbbbbbbbbbbbbbb',
                'bbbbbbbbbbbbbbb',
            ], // These rooms are just me messing with the player
            [
                'bbbbbbbbbbbbbbb',
                'bbbbbbbbbbbbbbb',
                'b          l  b',
                'b          l   ',
                'b          l c ',
                'b          l bb',
                'b          l  b',
                'b          l bb',
                'b          l  b',
                'b            bb',
                '             bb',
                '            bbb',
                '            bbb',
                'bbbbbbbbbbbbbbb',
                'bbbbbbbbbbbbbbb',
            ],
            [
                'bbbbbbbbbbbbbbb',
                'bbbbbbbbbbbbbbb',
                'bbbbbbbbbbbbbbb',
                '              b',
                '      l       b',
                'b           l b',
                'b       l     b',
                'b             b',
                'b    l        ',
                'b l            ',
                'b       l      ',
                'b         bbbbb',
                'blllllllllbbbbb',
                'bbbbbbbbbbbbbbb',
                'bbbbbbbbbbbbbbb',
            ],
            [
                'bbbbbbbbbbbbbbb',
                'bbbbbbbbbbbbbbb',
                'blllllllllbbbbb',
                'b         bbbbb',
                'b             b',
                'b             b',
                'b             b',
                'b              ',
                '               ',
                '               ',
                '          bbbbb',
                'blllllllllbbbbb',
                'bbbbbbbbbbbbbbb',
                'bbbbbbbbbbbbbbb',
                'bbbbbbbbbbbbbbb',
            ],
            [
                'bbbbbbbbbbbbbbb',
                'bbbbbbbbbbbbbbb',
                'bbbbbbbbbbbbbbb',
                'bbbbbbbbbbbbbbb',
                'blllllllllbbbbb',
                'b         bbbbb',
                'b             b',
                '              b',
                '           c  b',
                '          bbb b',
                'bbbbbbbbbbbbb b',
                'bbbbbbbbbbbbb b',
                'bbbbbbbbbbbbb b',
                'bbbbbbbbbbbbb b',
                'bbbbbbbbbbbbb b',
            ],
            [
                'bbbbbbblbbbbb b',
                'b      l      b',
                'b      l      b',
                'b      l      b',
                'b      l      b',
                'b      l  bbbbb',
                'b      l      b',
                'b      l      b',
                'b      l      b',
                'b      l      b',
                'b      l      b',
                'b             b',
                'b             b',
                'b             b',
                'b      l      b',
                'b      l      b',
                'b      lllllllb',
                'b      l      b',
                'b             b',
                'b      l      b',
                'b      l      b',
                'bllbllll      b',
                'b      l      b',
                'b      l      b',
                'b             b',
                'b             b',
                'b             b',
                'b      l      b',
                'bll  lll      b',
                'b      lllllllb',
                'b             b',
                'b             b',
                'b      l      b',
                'bb    bl      b',
                'lbbbbbbl      b',
                'lbbllbbl      b',
                'lbbllbbl      b',
                'lb ll bl      b',
                'l  ll  l      b',
                'lb ll bl      b',
                'lbbllbbl c    b',
                'lbllllblbbb  bb',
            ],
            [
                'bbbbbbbbbbbbbbb',
                'bbbbb     bbbbb',
                'bbb         bbb',
                'bb           bb',
                'b              ',
                'b            bb',
                'b bbbbbbbbbbbbb',
                'b             b',
                'bbb  bb  bbbb b',
                '              b',
                '              b',
                '              b',
                'bblllblllblllbb',
                'bbbbbbbbbbbbbbb',
                'bbbbbbbbbbbbbbb',
            ], // Lower path and the level that is the meaning of life
            [
                'bbbbbbbbbbbbbbb',
                'bbbbb          ',
                'bbb         bbb',
                'bb           bb',
                '              b',
                'b             b',
                'b c           b',
                'bbbbb         b',
                'b             b',
                'b           llb',
                'b              ',
                'b              ',
                'b           llb',
                'blllllllllllllb',
                'bbbbbbbbbbbbbbb',
            ],
            [
                'bbbbbbbbbbbbbbb',
                '               ',
                'bbbbbbbbbbbbbbb',
                'bb           bb',
                'b     bbb     b',
                'b      b      b',
                'bb     b      b',
                'b      b      b',
                'b      b      b',
                'b      b      b',
                '      bb    llb',
                '       b       ',
                'b      b       ',
                'b      bllllllb',
                'bbbbbbbbbbbbbbb',
            ],
            [
                'bbbbbb   bbbbbb',
                '          bbbbb',
                'bbb         bbb',
                'bb     b     bb',
                'b             b',
                'b             b',
                'b bllllllllllbb',
                'b             b',
                'bblllblllbbbb b',
                'b             b',
                'b             b',
                '             bb',
                ' c            b',
                'bbb           b',
                'bbbbbbbbbbbbbbb',
            ],
            [
                'bbbbbbbbbbbbbbbbb',
                'bbbbb       bbbbb',
                'bbb           bbb',
                'bb             bb',
                'b               b',
                'b               b',
                'b                ',
                'b                ',
                'bbbbbbb bbbbbbbbb',
                'b             bbb',
                'b bbbbbbbbbbb bbb',
                'b             bbb',
                'bb           bb  ',
                'b             b  ',
                'bb           bb b',
                'b             b b',
                'bb           bb b',
                'b             b b',
                'bb           bb b',
                'b               b',
                'bbbbbb   bbbbbbbb',
            ],
            [
                'bbbbbbbbbbbbbbb',
                'bbbbb     bbbbb',
                'bbb         bbb',
                'bb           bb',
                'b             b',
                'b             b',
                '              b',
                ' c            b',
                'bblllllllllll b',
                'b             b',
                'b             b',
                'b          lllb',
                '              b',
                '              b',
                'bbbbbbbbbb   bb',
            ],
            [
                'bbbbbbbbbb   bb',
                'bbbbb         b',
                'bbb        c  b',
                'bb       bbbbbb',
                'b        l     ',
                'b        l     ',
                'b        l     ',
                'b    blllb   bb',
                'b    l        b',
                'b    l        b',
                'bb   l  b     b',
                'b    l        b',
                'b    blllllb  b',
                'b             b',
                'bbbbbbbbbbbbbbb',
            ],
            [
                'bbbbbbbbbbbbbbb',
                'bbbbb     bbbbb',
                'bbb         bbb',
                'bb           bb',
                '              b',
                '              b',
                '              b',
                'b             b',
                'b       llllllb',
                'b       l     b',
                'b       l      ',
                'b           b  ',
                'b           b  ',
                'blllllllllllbbb',
                'bbbbbbbbbbbbbbb',
            ],
            [
                'bbbbbbbbbbb  bb',
                'bbbbb         b',
                'bbb           b',
                'bb           bb',
                'b             b',
                'b             b',
                'b             b',
                'b            bb',
                'b              ',
                'b              ',
                '               ',
                '           bbbb',
                '          bbbbb',
                'bbbbbbbbbbbbbbb',
                'bbbbbbbbbbbbbbb',
            ], // Reconnect
            [
                'bbbbbbbbbbbbbbbbbbb',
                'bbbbb         bbbbb',
                'bbb             bbb',
                'bb               bb',
                'b                 b',
                'b                 b',
                'b                 b',
                'b                 b',
                '                   ',
                '                   ',
                '                   ',
                'bbbbbbbbbbbbbbbbbbb',
                'b  b  bb   bb  b  b',
                'b  b  b     b  b  b',
                'bbbbbbbbbbbbbbbbbbb',
            ],
            [
                'bbbbbbbbbbbbbbbbbbbbbbb',
                'bbbbbbb         bbbbbbb',
                'bbbb               bbbb',
                'bb                   bb',
                'b                     b',
                'b                     b',
                'b                     b',
                'b                     b',
                '                      b',
                '                      b',
                '                      b',
                'bbbbbdddddddddddddbbbbb',
                'bbbbb             bbbbb',
                'bbb                 bbb',
                'bb                   bb',
                'bb                   bb',
                'b                     b',
                'b                     b',
                'b                     b',
                'b                     b',
            ],
            [
                '                                          ',
                '                                          ',
                '                                          ',
                '                                          ',
                '                                          ',
                '                                          ',
                '                                          ',
                '                                          ',
                '                                          ',
                '                                          ',
                '                                          ',
                '                                          ',
                '     c                                    ',
                'bbbbbbbbbbbbbbbbbbllllllllllllllllllllllll',
                'bbbbbbbbbbbbbbbbbbbbbblllllllllllllbbbblll',
            ],
            [
                '               ',
                '               ',
                '               ',
                '               ',
                '               ',
                '               ',
                '               ',
                '               ',
                '               ',
                '               ',
                '               ',
                '               ',
                '               ',
                'bbbbbbblllllbbb',
                'bbbbbbbbbbbbbbb',
            ],
            
            // The Forgotten Network
            [
                'bbbbbbb   bbbbb',
                'b             b',
                'b             b',
                'b             b',
                'bbbbbbbbu     b',
                'b       u     b',
                'b       u     b',
                'b       u     b',
                'b       u     b',
                'b       u     b',
                'b   bbubbbbbbbb',
                'b     u       b',
                'b     u       b',
                'b     u       b',
                'bbbbbbbbbbu  bb',
            ], // Erg/entrance
            [
                'bbbbbbbbbbu  bb',
                'b         u   b',
                'b         u   b',
                'b         u   b',
                'b         u   b',
                'bdddbbbbbbbbbub',
                'b   b        ub',
                'b   b        u ',
                'b   b        u ',
                'bdddb    ubbbbb',
                'b   b    u    b',
                'b   b    u    b',
                'b        u    b',
                'b        u    b',
                'bbbbbbbbbbbbbbb',
            ],
            [
                'bbbbbbbbbb   bbbbbbbbbb',
                'bbbbbbbbb     bbbbbbbbb',
                'bbbbb      b      bbbbb',
                'bbb                 bbb',
                'bb                   bb',
                'b  b               b  b',
                'b                     b',
                '                       ',
                '                       ',
                'bub                 bub',
                'bubbb      c      bbbub',
                'bubbbbbb   b   bbbbbbub',
                'bubbbbbbbdddddbbbbbbbub',
                'bubbbbbbbdddddbbbbbbbub',
                'bubbbbbb       bbbbbbub',
                'bubbb             bbbub',
                'bub                 bub',
                'bu                   ub',
                'bu                   ub',
                'bbbbbbbbbb   bbbbbbbbbb',
            ], // Hub
            [
                'bbbbbbbbbb   bb',
                'uuuuuuub      b',
                'bvvvvvv       b',
                'b     bbbbbbbbb',
                'b       l     b',
                'b       l     b',
                'b       l     b',
                'b       u     b',
                'b             b',
                'b             b',
                'b             b',
                'bllllllllll   b',
                'uuuuuuuuuuuu  b',
                'blllllllllllllb',
                'bbbbbbbbbbbbbbb',
            ], // Great Halls
            [
                'bbbbbbbbbbbbbbbbbbbbbbb',
                '                       ',
                '                      b',
                'bb        b           b',
                'b         b           b',
                'bb        b           b',
                'b        lbubbbbllbbbbb',
                'b        bbub         b',
                'b         bububbbbbbubb',
                'b        bbubub     u b',
                'bl        bubub     u b',
                'bb        bu ub     u b',
                'b         bbbbb     u  ',
                'bb                  u b',
                'bbbbbbbbbbbbbbbbbbbbbbb',
            ],
            [
                'bbbbbbbbbb   bb',
                'b              ',
                'b              ',
                'buuuuuuuuuuuuub',
                'bvvvvvvvvvvvvvb',
                'bbbbbbbbbbbbbbb',
                'bb    bbb    bb',
                'b      b      b',
                'b      b      b',
                'bl    lbl    lb',
                'bllllllbllllllb',
                'bllllllbllllllb',
                'bllllllbllllllb',
                'bbllllbbbllllbb',
                'bbbbbbbbbbbbbbb',
            ],
            [
                'bbbbbbbbbbbbbbbbbbbbbbb',
                'bbbbbbb         bbbbbbb',
                'bbbb               bbbb',
                'bbb                 bbb',
                'bb                   bb',
                'bb                   bb',
                'b                     b',
                'b                     b',
                'b                     b',
                'b                     b',
                'b                      ',
                'b                      ',
                'b                      ',
                'b                      ',
                'bbbbbbbbbb   bbbbbbbbbb',
            ], // Loft
            [
                'bbbbbbbbbbbbbbbbbbb',
                'bbbbbbb     bbbbbbb',
                'bbbb           bbbb',
                'bb               bb',
                'b                 b',
                'b                 b',
                'b                 b',
                'b                 b',
                'b                 b',
                'b                 b',
                '                  b',
                '                   ',
                '                   ',
                '                   ',
                'bbbbbbbbbbbbbbbbbbb',
            ],
            [
                'bbbbbbbbbbbbbbbbbbbbbbb',
                'bbbbbb    bbb    bbbbbb',
                'bbb        1        bbb',
                'bb         1         bb',
                'bb         1         bb',
                'b          1          b',
                'b          1          b',
                'b          1          b',
                'b          1          b',
                'b          1          b',
                'b          1           ',
                '           1           ',
                '           1           ',
                '          bbb       bbb',
                'bbbbbbbbbbbbbbbbbbbbbbb',
            ],
            [
                'bbbbbbbbbbbbbbb',
                'bbllllbbbllllbb',
                'bbllllbbbllllbb',
                'blbllblblbllblb',
                'bllbbllbllbbllb',
                'bbbbbbbbbbbbbbb',
                'bbb   lll   bbb',
                '   uuu   uuu   ',
                '  bvvvlllvvvb  ',
                'bbbbbbbbbbbbbbb',
                'bllbbllbllbbllb',
                'blbllblblbllblb',
                'bbllllbbbllllbb',
                'bbllllbbbllllbb',
                'bbbbbbbbbbbbbbb',
            ], // Keep
            [
                'bbbbbbbbbbbbbbb',
                'bbb   bbb   bbb',
                'bb     b     bb',
                'bb     b     bb',
                'b     bbb     b',
                'b     bbb     b',
                'buuuuuuuuuuuuub',
                ' vvvvvvvvvvvvv ',
                '               ',
                'buuuuuuuuuuuuub',
                'bvvvvvvvvvvvvvb',
                'bbbbbbbbbbbbbbb',
                'bb bbb   bbb bb',
                'b   b     b   b',
                'b   b     b   b',
            ],
            [
                'bbb           b',
                'bbb           b',
                'bbb           b',
                'bbb           b',
                'bbb           b',
                'bbb           b',
                'bb            b',
                '              b',
                '              b',
                'bb            b',
                'bbb           b',
                'bbb           b',
                'bbb           b',
                'bbb           b',
                'bbb           b',
            ],
            [
                
                'bbb           b',
                'lbb           b',
                'bbb           b',
                'lbb           b',
                'lbb           b',
                'bbb           b',
                'bl            b',
                '              b',
                'bll           b',
                'bbb           b',
                'lbb           b',
                'lbb           b',
                'bbb           b',
                'lbb           b',
                'bbb           b',
            ],
            [
                'bbbbbbbbbbbbbbb',
                'bbbbb     bbbbb',
                'bbb    b    bbb',
                'bb    blb    bb',
                'b      b      b',
                'b             b',
                'b             b',
                '               ',
                'buuuuuuuuuuuuub',
                'bvvvvvvvvvvvvvb',
                'b      b      b',
                'bb    blb    bb',
                'bbb    b    bbb',
                'bbbbb     bbbbb',
                'bbbbbbbbbbbbbbb',
            ],
            [
                'bbbbbbbbbbbbbbb',
                'bbb         bbb',
                'bb           bb',
                'bb           bb',
                'b             b',
                'b             b',
                'b             b',
                'b              ',
                'buuuuuuuuuuuuub',
                'bbbbbbbbbbbbbbb',
                'bb  bbl lbb  bb',
                'b    b l b    b',
                'b    bl lb    b',
                'bb  bb l bb  bb',
                'bbbbbbbbbbbbbbb',
            ],
            [
                'bbbbbbbbbbbbbbb',
                'b             b',
                'b             b',
                'b             b',
                'b             b',
                'b             b',
                'b             b',
                'b             b',
                'b             b',
                'b             b',
                'b             b',
                'b             b',
                'b             b',
                'b             b',
                'bbbbbbbbbbbbbbb',
            ],
            [
                'bbbbbbbbbbbbbbb',
                'b             b',
                'b             b',
                'b             b',
                'b             b',
                'b             b',
                'b             b',
                'b             b',
                'b             b',
                'b             b',
                'b             b',
                'b             b',
                'b             b',
                'b             b',
                'bbbbbbbbbbbbbbb',
            ],
            // [
            //     'bbbbbbbbbbbbbbb',
            //     'bbbbb     bbbbb',
            //     'bbb    b    bbb',
            //     'bb    blb    bb',
            //     'b      b      b',
            //     'b             b',
            //     'buuuuuuuuuuuuub',
            //     ' vvvvvvcvvvvvv ',
            //     'buuuuuuuuuuuuub',
            //     'bvvvvvvvvvvvvvb',
            //     'b      b      b',
            //     'bb    blb    bb',
            //     'bbb    b    bbb',
            //     'bbbbb     bbbbb',
            //     'bbbbbbbbbbbbbbb',
            // ], // Secondary path
            // [
            //     'bbbbbbbbbbbbbbb',
            //     'llllllllllllllb',
            //     'l             b',
            //     '              b',
            //     'l             b',
            //     'b           llb',
            //     'b           bbb',
            //     'b              ',
            //     'b           bbb',
            //     'b           llb',
            //     'l             b',
            //     '              b',
            //     'l             b',
            //     'llllllllllllllb',
            //     'bbbbbbbbbbbbbbb',
            // ],
            // [
            //     'bbbbbbbbbbbbbbb',
            //     'b             b',
            //     'bbuuuuuuuuuuubb',
            //     '  vvvvvvvvvvv  ',
            //     'bbuuuuuuuuuuubb',
            //     'b vvvvvvvvvvv b',
            //     'b             b',
            //     'b             b',
            //     'b             b',
            //     'b             b',
            //     'bbuuuuuuuuuuubb',
            //     '  vvvvvvvvvvv  ',
            //     'bbuuuuuuuuuuubb',
            //     'b vvvvvvvvvvv b',
            //     'bbbbbbbbbbbbbbb',
            // ],
            // [
            //     'bbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbb',
            //     'bbbb     bbbbbbb                  b',
            //     'bb                               bb',
            //     'b                                  ',
            //     'b     0                          bb',
            //     'b    010   bbb                    b',
            //     'b     0     b                     b',
            //     'b           b                    bb',
            //     'b           b                     b',
            //     'b           b                     b',
            //     'b           b                    bb',
            //     '            b                      ',
            //     '            b                    bb',
            //     '            blllllllllllllllllllllb',
            //     'bbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbb',
            // ],
            
            // The Great Halls (upper)
            [
                'bbbbbbbbbbbbbbb',
                'bbbbb     bbbbb',
                'bbb         bbb',
                'bb           bb',
                'b             b',
                'b             b',
                'b              ',
                'b              ',
                'blllllllllb   b',
                'b         b   b',
                'b   bdddddb   b',
                'bb  b         b',
                'b   bbbbbbbdddb',
                'b      c      b',
                'bbbbbbbbbbb   b',
            ],
            [
                'bbbbbb   bbbbbb',
                'bbbbb     bbbbb',
                'bbb         bbb',
                'bb           bb',
                'b      b      b',
                'b             b',
                '              b',
                '              b',
                'b             b',
                'blllllllllllllb',
                'bbbbbblllbbbbbb',
                'bbb   lll   bbb',
                'bb    lll    bb',
                'b    lllll    b',
                'blllllllllllllb',
            ],
            
            // The Loft
            [
                'bbbbbbbbbbbbbbb',
                'bbbbb     bbbbb',
                'bbb         bbb',
                'bb           bb',
                'b             b',
                'b             b',
                '               ',
                '               ',
                '       c       ',
                'bb  bbbbbbb  bb',
                'b             b',
                'b             b',
                'b             b',
                'bbb         bbb',
                'bbbbbb   bbbbbb',
            ],
            [
                'bbbbbbbbbbbbbbb',
                'bbbbb     bbbbb',
                'bbb         bbb',
                'bb           bb',
                'b 0  0        b',
                'b0  0         b',
                '0000           ',
                '000 0          ',
                '00 0 0         ',
                'bbbbbbbbbbbbbbb',
                'bbb  bbbbb  bbb',
                'bb    bbb    bb',
                'b      b      b',
                'b      b      b',
                'b      b      b',
            ], // Left
            [
                'bbbbbbbbbbbbbbb',
                'bbbbb00000bbbbb',
                'bbb000000000bbb',
                'bb00000000000bb',
                'b0000000000000b',
                'b0000000000000b',
                '100000000000000',
                '100000000000000',
                '100000000000000',
                'bbbbbbbbbbbbbbb',
                'bb101b101b101bb',
                'bb101b101b101bb',
                'bb101b101b101bb',
                'bb101b101b101bb',
                'bbbbbbbbbbbbbbb',
            ],
            [
                'b   bbbbbbbbbbbbbbbbbbbbbbbbbbbbbbb',
                'b   bbbbbb               bbbbbbbbbb',
                'bb  bb                      bbbbbbb',
                'b                               bbb',
                'b                                bb',
                'bb                                b',
                'b                                  ',
                'b                     0000         ',
                'b                     0000         ',
                'bbbb                  000011111bbbb',
                'bb                             bbbb',
                'b                                bb',
                'b                                 b',
                'blllllllllllllllllllllllllllllllllb',
                'bbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbb',
            ],
            [
                'bbbbbbbbbbbeeebbbbbbbb',
                'bbbbbbbb         bbbbb',
                'bbbbbb      b      bbb',
                'bbbbb               bb',
                'bbbb                 b',
                'bbbb        b        b',
                'bbbb                 b',
                'bbbb                 b',
                'bbbb                 b',
                'bbbb   0000000       b',
                'bbbb   0000000       b',
                'bbbb   0000000       b',
                'bbbb   0000000       b',
                'bbbb   0000000       b',
                'bbbb   0000000       b',
                'bbbb   0000000       b',
                'bbbb                 b',
                'bbbb          1100011b',
                'bbbb          0000000b',
                'bbbb          0000000b',
                'bbbb          0001000b',
                'bbbb  bbbbbbbb0000000b',
                'bbbb   bbbbbbb0000000b',
                'bbbb   bbbbbbb0001000b',
                'bbbbb  bbbbbbbbbbbbbbb',
                'bbbb              bbbb',
                'bbbb                bb',
                'bbbbbbb              b',
                'bb    e             bb',
                'b     e       c   bbbb',
                'b   bbbbbbbbbbbbbbbbbb',
            ],
            [
                'bbbbbbbbbbbeeebbbbbbbbbbb',
                'bbbbbbb           bbbbbbb',
                'bbbb        b        bbbb',
                'bb                   l bb',
                'b                    l  b',
                'b           b        l   ',
                'b                       b',
                'b                       b',
                'b00000000000000000000000b',
                'blllllllllllllllllllllllb',
                'bbbb                 bbbb',
                'bb                     bb',
                'b                        ',
                'b     c                  ',
                'bbbbbbbbbbb   bbbbbbbbbbb',
            ],
            [
                'bbbbbbbbbbbbbbbbbb',
                'bbbbb        bbbbb',
                'bbb            bbb',
                'bb              bb',
                'b                b',
                '                 b',
                'bb               b',
                'b           00000b',
                'b           00000b',
                'b           00000b',
                'b           00000b',
                'b           00000b',
                '            00000b',
                '            00000b',
                'bbbbbb   bbbbbbbbb',
            ],
            [
                'bbbbbb   bbbbbbbbb',
                'bbbbbb   bbb11110b',
                'b           00000b',
                'b           00000b',
                'b           00001b',
                'b           00000b',
                'b           00000b',
                'b           00000b',
                'b                b',
                'b                b',
                'b                b',
                'bb               b',
                'bbb            bbb',
                'bbbbb        bbbbb',
                'bbbbbbbbbbbbbbbbbb',
            ],
            [
                'bbbbbbbbbbbbbbbbbbbbbbbbb',
                'bbbbb               bbbbb',
                'bbb                   bbb',
                'bb                     bb',
                'b                       b',
                'b                       b',
                'b                       b',
                'b                        ',
                'b                        ',
                'b                      bb',
                'b  1                 0  b',
                'b                       b',
                'b                       b',
                'b    c                  b',
                'bbbbbbbbbbb   bbbbbbbbbbb',
            ],
            [
                'bbbbbbbbbbbbbbb',
                'bbbbb     bbbbb',
                'bbb         bbb',
                'bb           bb',
                'b             b',
                'b             b',
                'bbbbbb        b',
                '     b        b',
                '     b        b',
                'bbb  b        b',
                'b bddb        b',
                'b             b',
                'b         dlllb',
                'blllllllll     ',
                'bbbbbbbbbbbbbbb',
            ],
            [
                'bbbbbbeeebbbbbb',
                'bbbbb     bbbbb',
                'bbb    b    bbb',
                'bb           bb',
                'b             b',
                'b             b',
                '       b      b',
                '              b',
                '              b',
                'bbbbbbbbbbbbbbb',
                'bb0101bbb1010bb',
                'b010101b101010b',
                'b101010b010101b',
                'b010101b101010b',
                'bbbbbbbbbbbbbbb',
            ], // Right
            [
                'bbbbbbbbbbbbbbbbbbbbbbbbbb',
                'bbbbb             bbbbbbbb',
                'bbb                 bbbbbb',
                'bb                   bbbbb',
                'b                     bbbb',
                'b                     bbbb',
                'b                     bbbb',
                'b                     bbbb',
                'b                     bbbb',
                'b                     bbbb',
                'b              0000   1  e',
                'b              0000   1  e',
                'b              0000   1  e',
                'b              0000   1  e',
                'bbbbbb   bbbbbbbbbbbbbbbbb',
            ],
            [
                'bbbbbb000bbbbbb',
                'bbbbb00000bbbbb',
                'bbb  00000  bbb',
                'bb   00000   bb',
                'b    00000    b',
                'b    00000    b',
                'b    00000    b',
                'b    00000    b',
                'b             b',
                'b             b',
                '         11011b',
                '         00000b',
                '         00100b',
                '         00000b',
                'bbbbbbbbbbbbbbb',
            ],
            [
                'bbbbbbbebbbbbbb',
                'bbbbb     bbbbb',
                'bbb         bbb',
                'bb           bb',
                'b      b      b',
                'b             b',
                'b             b',
                'b             b',
                'b    00000    b',
                'b    00000    b',
                'b    00000    b',
                'b    00000    b',
                'b             b',
                'b             b',
                'bbbbbb   bbbbbb',
            ],
            [
                'bbbbbbbbbbbbbbb',
                'bbbbb     bbbbb',
                'bbb         bbb',
                'bb           bb',
                'b             b',
                'b             b',
                'b    0        b',
                'b             b',
                '1             b',
                'b             b',
                'b             b',
                'b             b',
                'bbb           b',
                'bbbbb      c  b',
                'bbbbbbb bbbbbbb',
            ],
            [
                'bbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbb',
                'bbbbbbbbbbb             bbbbbbbbbbb',
                'bbbbbbb                     bbbbbbb',
                'bbbb                           bbbb',
                'bb                               bb',
                'b                                 b',
                'e                                 b',
                'e                                 b',
                'e       000000                     ',
                'bbbb1111000000                 bbbb',
                'bb      000000                   bb',
                'b                                 b',
                'b                                 b',
                'blllllllllllllllllllllllllllllllllb',
                'bbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbb',
            ],
            [
                'bbbbbbbbbbbbbbb',
                'bbbbb     bbbbb',
                'bbb         bbb',
                'bb           bb',
                'b             b',
                '         lllllb',
                '         l    ',
                'bbbbbbb  l     ',
                'bbblbbb  l   c ',
                'bbblbb   l lbbb',
                'bbblbbb  l llbb',
                'bbl0lbb  l lblb',
                'bbl0lbb  ddllbb',
                'bbblbbb    lblb',
                'bbbbbbbbllllbbb',
            ],
            [
                'bbbbbbeeebbbbbb',
                'bbbbb     bbbbb',
                'bbb         bbb',
                'bb     b     bb',
                'b             b',
                'b              ',
                'b       c      ',
                'b  bb  bbbbbbbb',
                'bb bb  bbb  bbb',
                'b  bb  bbb  bbb',
                'b bbb  bbb  bbb',
                'b  bb  bbb  bbb',
                'bb bb  bbb  bbb',
                '    b  bbb  bbb',
                'bubub  bbbbbbbb',
            ], // Reconnect
            [
                'bubub  bbbbbbbb',
                'bulub  bbbllbbb',
                'bubub  bbllllbb',
                'bulub  bllllllb',
                'bulub  bbllllbb',
                'bubub  bbbllbbb',
                'bulub  bbbbbbbb',
                'bulu     1    b',
                'bulu     1    b',
                'bbbbbddbbbbbbbb',
                'bulubeeblbbbblb',
                'bulub  blbllblb',
                'bubub  bbbllbbb',
                'bulub  blbllblb',
                'bubub  bbbbbbbb',
            ],
            [ // Remnants
                'bbbbbbbbbbbbbbb',
                'bbbllbbbbbllbbb',
                'bbllllbbbllllbb',
                'bllllllbllllllb',
                'bbllllbbbllllbb',
                'bbbllbbbbbllbbb',
                'bbbbbbbbbbbbbbb',
                'b             b',
                'b             b',
                'bbbbbbbbbbbbbbb',
                'bblblblblbllblb',
                'bblbbblblblbblb',
                'bbbblblbbbblbbb',
                'bblblblblbllblb',
                'bbbbbbbbbbbbbbb',
            ],
            [
                'bbbbbbbbbbbbbbb',
                'bbbbb     bbbbb',
                'bbb         bbb',
                'bb           bb',
                'b             b',
                'b             b',
                'b             b',
                'b             b',
                'b             b',
                'b             b',
                '              b',
                '               ',
                '              b',
                'bbb            ',
                'bbbbbb   bbbbbb',
            ],
            [
                'bbbbbbbbbbbbbbb',
                'bbbbbb         ',
                'bbbbbb      bbb',
                'bbbbbb      blb',
                'bbbbbb      blb',
                'bbbbbb   0  bbb',
                'b2222       blb',
                'b2222b      blb',
                'b2222bbbbbbbbbb',
                'b2212buuuuuuuub',
                'b2222bublbllblb',
                ' 2222bubblbblbb',
                'bbbbbbubbbbbbbb',
                '   c  u        ',
                'bbbbbbbbbbbbbbb',
            ],
            [
                'bbbbbbbbbbbbbbb',
                '              e',
                'bbbbbbbbbbbbbbb',
                'bbbbbbbbbblllbb',
                'bbbbbbbbbl l lb',
                'b     bubl b lb',
                'b     bubl l lb',
                'b     bubblllbb',
                'b00 0 bubbbbbbb',
                'b0000 bubblllbb',
                'b0000 bubl l lb',
                'bbbbbbbubl b lb',
                'bbbbbbbubl l lb',
                '       ubblllbb',
                'bbbbbbbbbbbbbbb',
            ],
            [
                'bbbbbbbbbbbbbbb',
                '    b         b',
                'bdb  db       b',
                'b bbbdb        ',
                'bdb            ',
                'b b          db',
                'bdb           b',
                'b bbbbulllllllb',
                'bdbbbb        b',
                'bdbbbb        b',
                'bdbbbbllllllb b',
                'b             b',
                'b     c       b',
                'bllllbbbbllllbb',
                'bbbbbbbbbbbbbbb',
            ],
            [
                'bbbbbbbbbbbbbbbbbbbbbbbbbbbbbbb',
                'b                             b',
                'b                             b',
                '                              b',
                ' c                        b   ',
                'bbb    b                       ',
                'b                              ',
                'b                           bbb',
                'b                             b',
                'b                             b',
                'b                            bb',
                'b            b                b',
                'b                             b',
                'b                            bb',
                'b                             b',
                'b                             b',
                'b     b                     b b',
                'b                           bbb',
                'b                          llll',
                'b                         llbbb',
                'b b                 b     llb b',
                'bbb                       ll  b',
                'llll                      ll  b',
                'bbbll                     ll  b',
                'b bll                    bll  b',
                'b  ll       bb            ll  b',
                'b  ll                     ll  b',
                'b  ll                     ll  b',
                'blllllllllllllllllllbbbbllllllb',
                'bllllllllllllllllllllbblllllllb',
                'blllllllllllllllllllllblllllllb',
                'blllllllllllllllllllllllllllllb',
                'bllllllllllllllllllllbllllllllb',
                'blllllllllllllllllllllllllllllb',
                'blllllllllllllllllllllllllllllb',
                'blllllllllllllllllllllllllllllb',
                'blllllllllllllllllllllllllllllb',
                'blllllllllllllllllllllllllllllb',
            ],
            [
                'bbbbbbbbbbbbbbb',
                'b   b         b',
                'b   b          ',
                'b   b          ',
                '    bbbbbbbbu b',
                '    b         b',
                '    b         b',
                'bb  bb        b',
                'b   b         b',
                'b   b         b',
                'bb  bbbbbbb u b',
                'b   b         b',
                'b   b         b',
                'bb  bb        b',
                'b   b         b',
                'b   b         b',
                'b   bbbbb u   b',
                'bb  b         b',
                'b   b         b',
                'b   bb        b',
                'b   b         b',
                'bb  b         b',
                'b   bbbb u    b',
                'b   b         b',
                'b   b         b',
                'bb  bb        b',
                'b   b         b',
                'b   b         b',
                'b   bbb       b',
                'bb  b         b',
                'b   b         b',
                'b   bb        b',
                'b   b         b',
                'bb  b         b',
                'b   bb        b',
                'beeeb         b',
                'b c           b',
                'bbbbbbllllllllb',
                'bbbbbbbbbbbbbbb',
            ],
            [
                'bbbbbbb00bbbbbb',
                'b     l00b    b',
                '      l00b    b',
                ' c    l00b    b',
                'bbbbb l00      ',
                'b 10  l00     b',
                'b b0  l11     b',
                'b b           b',
                'b b           b',
                'b b           b',
                'b b           b',
                'b blllllllllllb',
                'b bbbbbbbbbbbbb',
                'b              ',
                'bbbbbbbbbbbbbbb',
            ],
            [
                'bbbbbbbbbbbbbbbbbbb',
                'bbbbb         bbbbb',
                'bbb             bbb',
                'bb               bb',
                '                  b',
                'b                 b',
                'b                 b',
                'bb                b',
                'b           00    b',
                'b           11    b',
                'b00         00    b',
                'b           00    b',
                'b           00    b',
                '            00    b',
                'bbbbbbbbbbb bbbbbbb',
            ],
            [
                'bbbbbbbbbbbbbbb',
                'bbbbb     bbbbb',
                'bbb         bbb',
                'bb           bb',
                'b             b',
                'b             b',
                'b             b',
                'b              ',
                'b     l        ',
                'b     b       b',
                'b     u       b',
                'b     u       b',
                'b             b',
                'b  c          b',
                'bbbbbbb  bbbbbb',
            ],
            [
                'bbbbbbbbbbbbbbb',
                'bbbbb  l  bbbbb',
                'bbb    l    bbb',
                'bb     l     bb',
                'b      l      b',
                'b      l      b',
                'b      l      b',
                '       l       ',
                ' c u   l   u   ',
                'buuuuuubuuuuuub',
                'b      b      b',
                'b             b',
                'b             b',
                'blllllllllllllb',
                'bbbbbbbbbbbbbbb',
            ],
            [
                'bbbbbbbbbbbbbbb',
                'bbbbb     bbbbb',
                'bbb         bbb',
                'bb           bb',
                'b             b',
                'b             b',
                'b             b',
                '              b',
                '              b',
                'bbbbbbb       b',
                'b     u       b',
                'b     u        ',
                'b     u        ',
                'b  c  u        ',
                'bbbbbbbbbbbbbbb',
            ],
            [
                'bbbbbbbbbbbbbbb',
                'b             b',
                'b             b',
                'b             b',
                'b             b',
                'b             b',
                'b             b',
                'b             b',
                'b             b',
                'b             b',
                'b             b',
                'e             b',
                'e             b',
                'e             b',
                'b           bub',
            ],
            [
                'b           bub',
                'b           buu',
                'b            lb',
                'b            ll',
                'b            lb',
                'b            ll',
                'b            lb',
                'b            lb',
                'b            ll',
                'b            lb',
                'b            ll',
                'b            lb',
                'b            lb',
                'b            ll',
                'b            lb',
                'b            u ',
                'b            u ',
                'b            u ',
                'b            u ',
                'b            u ',
                'b            ul',
                'b            lb',
                'b            lb',
                'b            ll',
                'b            lb',
                'b            ll',
                'b            lb',
                'b            lb',
                'b            ll',
                'b            lb',
                'b            ll',
                'b            lb',
                'b            lb',
                'blllllllllllllb',
                'bbbbbbbbbbbbbbb',
            ],
            [
                'bbbbbbbbbbbbbbb',
                'uuuuuuuuuuuuuuu',
                'bbbvvvvvvvvvvvv',
                'bb             ',
                'b      bbbbbbbb',
                'b   u  b  u    ',
                'b              ',
                'b              ',
                'b            bb',
                'b            lb',
                'b            ll',
                'b            lb',
                'b            lb',
                'b            ll',
                'b            lb',
                '             ub',
                '             ub',
                '             ub',
                '             u ',
                '             u ',
                'llllllllllllllb',
            ],
            [
                'bbbbbbbbbbbbbbbbb',
                'uuuuuuuuuuuuuuuub',
                'vvvbllbbllbvvv   ',
                '  vblbbbblbv     ',
                'bbubllllllbubbbbb',
                ' buuuuuuuuuub bbb',
                '  vvvvvvvvvv  bbb',
                '              bbb',
                'b              bb',
                'b             bbb',
                'b  vvvvvvvvvvvbbb',
                'b  uuuuuuuuuuubbb',
                'b  vvvvbvvvvvv  b',
                'bb           bb b',
                'b             bvb',
                'b             bub',
                'bvvvvvvvvvvvvvbub',
                'buuuuuuuuuuuuubub',
                ' vvvvvvvvvvvvv ub',
                '               ub',
                'bbbbbbbbbbbbbbbbb',
            ],
            [
                'bbb bbbbbbbbbbb',
                'bddddddddbbbbbb',
                '            bbb',
                ' c           bb',
                'bbb           b',
                'bbbb          b',
                'bbbb          b',
                'bbbb           ',
                'bbbbbbbbbbbbbbb',
                'bbb  bbbbb  bbb',
                'bb    bbb    bb',
                'bb    bbb    bb',
                'b      b      b',
                'b      b      b',
                'b      b      b',
            ],
            [
                'bbbbbbbbbbbbbbbbbbbbb',
                'bb  bbb  bbb  bbb  bb',
                'b    b    b    b    b',
                'bbbbbbbbbbbbbbbbbbbbb',
                'bb  bbb  bb  0    bbb',
                'b    b    b0      bbb',
                'bbbbbbbbbbb0      bbb',
                '           b      bbb',
                'bbbbbbbbbbb2     0bbb',
                'b    b    b       bbb',
                'bb  bbb  bb   0   bbb',
                'bbbbbbbbbbbbbbbbbbbbb',
                'b    b    b    b    b',
                'bb  bbb  bbb  bbb  bb',
                'bbbbbbbbbbbbbbbbbbbbb',
            ],
            [ // I'm sorry for the slowness. I just really needed to emphasize that you shouldn't come back
                'bbbbbbbbbbbbbbbbb',
                'buuuuuuuuuuuuuuub',
                'buuuuuuuuuuuuuuub',
                'buuuuuuuuuuuuuuub',
                'b bbbbbbbbbbbbbub',
                'b             bub',
                'bbbbbbbbbbbbb bub',
                'b             bu ',
                'b bbbbbbbbbbbbbu ',
                'b             bbb',
                'bbbbbbbbbbbbb bbb',
                '              bbb',
                '              bbb',
                '              bbb',
                'bbbbbbbbbbbbbbbbb',
            ],
            [
                'bbbbbbbbbbbbbbb',
                '   ub  bb  l  b',
                ' c u1       l b',
                'bbbu1      b  b',
                'bbbubbl    b  b',
                'bbbu1  lll1 b b',
                'bbbub   u b b b',
                'bbbu1b22bu  l b',
                'bbbu1b  bvbb   ',
                'bbbu1b  b1u0   ',
                'bbbub   bbb    ',
                'bbbubbb 1     b',
                'bbbu1  bbbuuuub',
                'bbbub   0 vvvvb',
                'bbbubbbbbbbbbbb',
            ],
            [
                'b              ',
                'b              ',
                'b              ',
                'b              ',
                'b              ',
                'b              ',
                'b              ',
                'b              ',
                '               ',
                '               ',
                '  c            ',
                'bbbb           ',
                'bbbbbb         ',
                'bbbbbbbb       ',
                'bbbbbbbbbbbbbbb',
            ],
            [
                'bbbbbbbbbbbbbbb',
                'b              ',
                'b              ',
                'b             b',
                'b      v      b',
                'buuuuububuuuuub',
                'bvvvvv   vvvvvb',
                '              b',
                '              b',
                'buuuuuuuuuuuuub',
                'bvvvvvvvvvvvvvb',
                'b             b',
                'b             b',
                'b             b',
                'bbbbbbbbbbbbbbb',
            ],
            [
                '               ',
                '               ',
                '               ',
                '               ',
                '               ',
                '               ',
                '               ',
                '               ',
                '               ',
                '               ',
                '               ',
                '               ',
                '               ',
                '               ',
                'bbbb           ',
                'bbbbb          ',
                'bbbbb          ',
                'bbbbb          ',
            ],
            [
                'bbbbb          ',
                'bb bb          ',
                'b   b          ',
                'bb bb          ',
                'bbbbb          ',
                'bblbb          ',
                'blllb          ',
                'bblbb          ',
                'bbbbb          ',
                'bbbbb          ',
                'bblbb          ',
                'blllb          ',
                'bblbb          ',
                'bbbbb          ',
                'bbbbbbbbbbbbbbb',
                'bbbbbbbbb  bbbb',
                'bbbbbbb      bb',
                'bbbbbbllllllllb',
                'bbbbbbllllllllb',
            ],
            [
                '                                       ',
                '                                       ',
                '                                       ',
                '                                       ',
                '                                       ',
                '                                       ',
                '                                       ',
                '                                       ',
                '                                       ',
                '                                       ',
                '                                       ',
                '                                       ',
                '                                       ',
                '                                       ',
                'bbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbb',
                'bbbb     bbbbbbbb     bbbbbbbb     bbbb',
                'bb         bbbb         bbbb         bb',
                'blllllllllllbblllllllllllbblllllllllllb',
                'blllllllllllbblllllllllllbblllllllllllb',
            ],
            [
                '                              ',
                '                              ',
                '                              ',
                '                              ',
                '                              ',
                '                              ',
                '                              ',
                '                              ',
                '                              ',
                '                              ',
                '                              ',
                '                              ',
                '                              ',
                '                              ',
                '                              ',
                '                              ',
                '                              ',
                '                              ',
            ],
            [
                '             bsbblllbssbssbsssbbbb         ',
                '             bssssssbsssssbsssbbb          ',
                '              bssssssbbbblssssbb           ',
                '               bssssssssssssssb            ',
                '                bsssssssssssssb            ',
                '                bsbslsssssssssb            ',
                '                bsssssssssssssb            ',
                '                bsssssssssssssb            ',
                '                bbbbbbbbbbbbbbb            ',
                '                bbsssbbbbssssbb            ',
                '                bsssssbbssssssb            ',
                '                ss   ssss   ssb            ',
                '                s     ss     sb            ',
                '                s     ss  c  sb            ',
                'bbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbllbbbbb',
                'bbbb     bbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbb',
                'bb         bbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbb',
                'blllllllllllbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbb',
                'blllllllllllbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbb',
            ],
            [
                '                bssssssbslllllb            ',
                '                bssssssbssssssb            ',
                '           b b bbssssssbssssssb            ',
                '           bbbbbbllllllbblllssb            ',
                '           bssssssss ssbbbbbssb            ',
                '           bssssssss ssbssssssbb b b       ',
                '           bsssbbsss ssbss ssbbbbbbb       ',
                '           bs ssbssssssbbs sssbbbbbb       ',
                '           bs ssblllbssbss sssbb bbb       ',
                '           bs sbbssssssbss sssbb bbb       ',
                '           bssssbs  sssbssssssbb bbb       ',
                '           bssssbs  bllbsssssbbb bbb       ',
                '           bssssbs  sssbssssssbbbbbb       ',
                '            bbsbbssssssbssbsssbbbbbb       ',
                '             bsbblllbssbssblllbbbbb        ',
            ],
            [
                '                                           ',
                '                                           ',
                '                                           ',
                '                                           ',
                '                       s                   ',
                '                       s                   ',
                '                      s s                  ',
                '                     s s s                 ',
                '                      s s                  ',
                '                       s                   ',
                '                       s                   ',
                '                                           ',
                '               b               b           ',
                '               bb s s s s s s bb           ',
                '               bbsssssssssssssbb           ',
                '               bbbbbbbsssbbbbbbb           ',
                '               bbss sssssss ssbb           ',
                '               bbss sssssss ssbb           ',
                '                bsssssssssssssb            ',
                '                bbbbbbbbsbbbbbb            ',
            ],
            
            // [
            //     'bbbbbbbbbbbbbbb',
            //     'bbbbbb         ',
            //     'bbbbbb      bbb',
            //     'bbbbbb      bbb',
            //     'bbbbbb      bbb',
            //     'bbbbbb   0  bub',
            //     'b2222       bub',
            //     'b2222b      bub',
            //     'b2222bbbbbbbbub',
            //     'b2212buuuuuuuub',
            //     'b2222bublbllblb',
            //     ' 2222bubblbblbb',
            //     'bbbbbbubbbbbbbb',
            //     '   c  u        ',
            //     'bbbbbbbbbbbbbbb',
            // ],
            // [
            //     'bbbbbbbbbbbbbbb',
            //     '              b',
            //     'bbbbbbbbbbbbbbb',
            //     'bbbbbbbbb     b',
            //     'bbbbbbbbb     b',
            //     'blllblbub     b',
            //     'bbblllbub     b',
            //     'blllblbub00000b',
            //     'blblllbub00000b',
            //     'blllllbub00000b',
            //     'bllbblbub00000b',
            //     'bbbbbbbub00000b',
            //     'bbbbbbbub00000b',
            //     '       ub00000b',
            //     'bbbbbbbbbbbbbbb',
            // ],
            
            // [
            //     '               ',
            //     '               ',
            //     '               ',
            //     '               ',
            //     '               ',
            //     '               ',
            //     '               ',
            //     '               ',
            //     '               ',
            //     '               ',
            //     '               ',
            //     '               ',
            //     '               ',
            //     '               ',
            //     'bbbbbbbbbbbbbbb',
            // ], Open
            // [
            //     'bbbbbbbbbbbbbbb',
            //     'bbbbb     bbbbb',
            //     'bbb         bbb',
            //     'bb           bb',
            //     'b             b',
            //     'b             b',
            //     'b             b',
            //     'b             b',
            //     'b             b',
            //     'b             b',
            //     'b             b',
            //     'b             b',
            //     'b             b',
            //     'b             b',
            //     'bbbbbbbbbbbbbbb',
            // ], Small
            // [
            //     'bbbbbbbbbbbbbbbbbbb',
            //     'bbbbbbb     bbbbbbb',
            //     'bbbb           bbbb',
            //     'bb               bb',
            //     'b                 b',
            //     'b                 b',
            //     'b                 b',
            //     'b                 b',
            //     'b                 b',
            //     'b                 b',
            //     'b                 b',
            //     'b                 b',
            //     'b                 b',
            //     'b                 b',
            //     'bbbbbbbbbbbbbbbbbbb',
            // ], Wide
            // [
            //     'bbbbbbbbbbbbbbb',
            //     'b             b',
            //     'b             b',
            //     'b             b',
            //     'b             b',
            //     'b             b',
            //     'b             b',
            //     'b             b',
            //     'b             b',
            //     'b             b',
            //     'b             b',
            //     'b             b',
            //     'b             b',
            //     'b             b',
            //     'bbbbbbbbbbbbbbb',
            // ], Blank
        ],
        oLevels = deepCopy(levels),
        //  levels = [
    //     [
    //         'b                         b',
    //         'b                         b',
    //         'b        b                b',
    //         'b                         b',
    //         'b                         b',
    //         'b                         b',
    //         'b       b                 b',
    //         'b                         b',
    //         'b           b  dddddddddddb',
    //         'b                         b',
    //         'b       b                 b',
    //         'b       b                 b',
    //         'b   b   b   b              ',
    //         'b       b   b              ',
    //         'bblllbbbbdddbbbbbbbbbbbbbbb',
    //     ],
    //     [
    //         'b            0000000000000b',
    //         'b            0000000000000b',
    //         'b         0  0000000000000b',
    //         'b           00000000000000b',
    //         'b         0000000000000000b',
    //         'b     00 0 000000000000000b',
    //         'b       0 0 00000000000000b',
    //         'b    0     0 0000000000000b',
    //         'b        0  00000000000000b',
    //         'b      0   000000000000000b',
    //         'b         0000001000000000b',
    //         'b           000001ddd3331 b',
    //         '             000001000002 b',
    //         '             000000000002 b',
    //         'bb           bbbbbbbbbbbbbb',
    //     ],
    //     [
    //         'bb           bbbbbbbbbbbbbb',
    //         'b                         b',
    //         'bbbbbbbbbbbbbbbbbbbbbbbbbbb',
    //         'b                         b',
    //         'b                         b',
    //         'b                         b',
    //         'b                         b',
    //         'b                         b',
    //         'b                         b',
    //         'b                         b',
    //         'b                         b',
    //         'b                         b',
    //         '                          b',
    //         '                          b',
    //         'bb   bbbbbbbbbbbbbbbbbbbbbb',
    //     ],
    // ],
        worldX = savedPos.wx, //18,
        worldY = savedPos.wy; //2
        // world = [
// [     0, 0,    0, 0, 0, 0, 0, 0, 0,  0,  0,    0, 0, 0, 0, 0, 0],
// [     0, 0,    0, 0, 0, 0, 0, 0,101,102,  0,    0, 0, 0, 0, 0, 0],
// [     0, 0,   93,94,95,96,97,98, 99,100,  0,    0, 0, 0, 0, 0, 0],
// [    81,82,   90,89,88,87, 0, 0, 0,[7,2], 0,    0, 0, 0, 0, 0, 0],
// [    78,79,   91,92, 0,86, 0, 0, 0, 0, 0,    0, 0, 0, 0, 0, 0],
// [    77,80,[3,6], 0,84,85, 0,34,35,36,37,   38,39, 0, 0, 0, 0],
// [    76,75,   74,73,83,31,32,33, 0,45,46,    0,40, 0, 0, 0, 0],
// [     0, 0,   71,72,29,30,41,42,43,44,47,   48,49,50,51,[12,14], 0],
// [     0, 1,    2,19,20,21,22,23,24,25,26,   27,28,53,52, 0, 0],
// [[11,11],18,   3, 4, 5, 6, 7, 8, 9, 0, 0,    0,54,60,61,62, 0],
// [     0,17,   16,15,14,13,12,11,10, 0, 0,[0,8],55,56,63,64,[16,14]],
// [     0, 0,    0, 0, 0, 0, 0, 0, 0, 0, 0,   59,58,57, 0, 0, 0],
// [     0, 0,   0, 0, 0, 0, 0, 0, 0, 0, 0,    0, 0, 0, 0, 0, 0],
// // The land of weirdness. Used for teleportation stuff
// [     0,0,0,0,0,0,[0,8],70,69,68,67,[16,13],[10,13],66,0,[10,13],66],
// [     0,0,0,0,0,0,0,0,0,0,0,[14,10],64,65,[5,8],64,65],
// [     0,0,0,0,0,0,0,0,0,0,0,0, 0,[13,13],0, 0,[16,13]],
    // ];
    
    const world = [ // It's in this weird format to compress the data for each slot so that it can be two characters long (e.g. 100 is 3 characters long and [3,6] is 5 characters long). This helps keep alignment which is nice.
' 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, x',
' 0, 0, 0, 0, 0, 0, 0, 0, e, f, g, h, n, q, o, p, r, u, w',
' 0,UO,93,94,95,96,97,98,99, d, 0, i, j, k, l, m, s, t, v',
'81,82,90,89,88,87, 0, 0, 0,MH, 0, 0, 0, 0, 0, 0, 0, 0, 0',
'78,79,91,92, 0,86, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0',
'77,80,IL, 0,84,85, 0,34,35,36,37,38,39, 0, 0, 0, 0, 0, 0',
'76,75,74,73,83,31,32,33, 0,45,46, 0,40, 0, 0, 0, 0, 0, 0',
' 0, 0,71,72,29,30,41,42,43,44,47,48,49,50,51,RT, 0, 0, 0',
' 0, 1, 2,19,20,21,22,23,24,25,26,27,28,53,52, 0, 0, 0, 0',
'QQ,18, 3, 4, 5, 6, 7, 8, 9, 0, 0, 0,54,60,61,62,HH, 0, 0',
' 0,17,16,15,14,13,12,11,10, 0, 0,FN,55,56,63,64,VT, 0, 0',
' 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,59,58,57, 0, 0, 0, 0, 0',
' 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0',
// The land of weirdness. Used for teleportation stuff
' 0, 0, 0, 0, 0, 0,FN,70,69,68,67,VS,PS,66, 0,PS,66, 0, 0',
' 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,TP,64,65,KN,64,65, 0, 0',
' 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,SS, 0, 0,VS, 0, 0',
    ].map(el => {
        let newStr = el.replaceAll(' ', '').split(',');
        newStr.forEach((innerEl, index) => {
            if (innerEl === '0' || +innerEl) {
                newStr[index] = +innerEl;
            } else {
                if (innerEl.length === 1) {
                    newStr[index] = innerEl.charCodeAt(0);
                } else {
                    newStr[index] = [innerEl.charCodeAt(0)-70, innerEl.charCodeAt(1)-70];
                }
            }
        });
        
        return newStr;
    });
    
    if (tToggles.beginningOfTheEnd) editLevel(118, 
[
    '             bsbblllbssbssbsssbbbb         ',
    '             bssssssbsssssbsssbbb          ',
    '              bssssssbbbblssssbb           ',
    '               bssssssssssssssb            ',
    '                bsssssssssssssb            ',
    '                bsbslsssssssssb            ',
    '                bsssssssssssssb            ',
    '                bsssssssssssssb            ',
    '                bsssssssssbsssb            ',
    '                bsssssssssssssb            ',
    '                bsssssbbssssssb            ',
    '                bs   ssss   ssb            ',
    '                b     ss     sb            ',
    '                b     ss  c  sb            ',
    'bbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbllbbbbb',
    'bbbb     bbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbb',
    'bb         bbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbb',
    'blllllllllllbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbb',
    'blllllllllllbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbb',
]);
    
    const transLevel = {
        active: false,
        started: false,
        left: 600,
        top: 600,
        dir: null,
        entryPos: {},
        darkened: false,
        run: function() {
            if (!this.started) {
                this.darkened = true;
                // back.style.backgroundColor = 'rgb(36, 36, 36)'
                nCanvas.width = canvas.width;
                nCanvas.height = canvas.height;
                const canvasInfo = window.getComputedStyle(canvas);
                nctx.drawImage(windPartsCanvas, 0, 0);
                nctx.drawImage(partsCanvas, 0, 0);
                nctx.drawImage(backBlocks, 0, 0);
                nctx.drawImage(canvas, 0, 0);
                
                
                runParticles.active.length = 0;
                jumpParticles.active.length = 0;
                trailParticles.active.length = 0;
                poundParticles.active.length = 0;
                softBreakParticles.active.length = 0;
                softAmbientParticles.active.length = 0;
                flameParticles.active.length = 0;
                lavaParticles.active.length = 0;
                windParticles.active.length = 0;
                chaserParticles.active.length = 0;
                createWorld();
                this.startX = cam.x;
                this.started = true;
                p.frozen = true;
                
                if (levelNum >= 118) {
                    chaser.log.length = 0;
                    chaser.log.fill(vector(-1000, -1000), 0, 50);
                    chaser.pos = vector(-1000, -1000);
                }
                
                if ((levelNum > 19 && levelNum <= 28 || levelNum === 53 || levelNum === 52)) {
                    for (let windP = 0; windP < levelW*levelH/30000; windP ++) {
                        windParticles.add(Math.random()*levelW, Math.random()*levelH);
                    }
                }
                
                switch(this.dir) {
                    case 0:
                        p.velocity.y = -5.8;
                        p.pos.y = levelH-25;
                        nCanvas.style.left = -cam.x+halfW+'px';
                    break;
                    case 1:
                        p.pos.x = 0;
                        nCanvas.style.top = -cam.y+halfH+'px';
                    break;
                    case 2:
                        if (levelNum === 80) p.velocity.y = 5.8;
                        p.pos.y = 0;
                        nCanvas.style.left = -cam.x+halfW+'px';
                    break;
                    case 3:
                        p.pos.x = levelW-25;
                        nCanvas.style.top = -cam.y+halfH+'px';
                    break;
                }
                this.entryPos = vector(p.pos.x, p.pos.y);
                this.entryDir = this.dir;
            }
            switch(this.dir) {
                case 0:
                    // {
                    cam.y = levelH-halfH;
                    canvas.style.top = partsCanvas.style.top = windPartsCanvas.style.top = backBlocks.style.top = (this.top-levelH)+'px';
                    nCanvas.style.top = (this.top)+'px';
                    tutorial.pos.y += (600-this.top)/7;
                    storyTeller.y += (600-this.top)/7;
                    this.top += (600-this.top)/7;
                    
                    if (this.top > 597) {
                        p.frozen = false;
                    } else {
                        p.pos.y = this.top+levelH-height-25;
                    }
                    
                    if (this.top > 599) {
                        nCanvas.style.top = '600px';
                        this.active = false;
                        this.started = false;
                    }
                    // }
                break;
                case 1:
                    // {
                    cam.x = halfW;
                    canvas.style.left = partsCanvas.style.left = windPartsCanvas.style.left = backBlocks.style.left = this.left+'px';
                    // pCanvas.style.left = this.left+(cam.x-(+window.getComputedStyle(pCanvas).left.slice(0, -2)))+'px';
                    nCanvas.style.left = (this.left-nCanvas.width)+'px';
                    tutorial.pos.x += -this.left/7;
                    storyTeller.x += -this.left/7;
                    this.left += -this.left/7;
                    
                    if (this.left < 3) {
                        p.frozen = false;
                    } else {
                        p.pos.x = this.left;
                    }
                    
                    if (this.left < 1) {
                        canvas.style.left = '0px';
                        nCanvas.style.left = '600px';
                        this.active = false;
                        this.started = false;
                    }
                    // }
                break;
                case 2:
                    // {
                    cam.y = halfH;
                    canvas.style.top = partsCanvas.style.top = windPartsCanvas.style.top = backBlocks.style.top = this.top+'px';
                    // pCanvas.style.left = this.left+(cam.x-(+window.getComputedStyle(pCanvas).left.slice(0, -2)))+'px';
                    nCanvas.style.top = (this.top-nCanvas.height)+'px';
                    tutorial.pos.y += -this.top/7;
                    storyTeller.y += -this.top/7;
                    this.top += -this.top/7;
                    
                    if (this.top < 3) {
                        p.frozen = false;
                    } else {
                        p.pos.y = this.top;
                    }
                    
                    if (this.top < 1) {
                        canvas.style.top = '0px';
                        nCanvas.style.top = '600px';
                        this.active = false;
                        this.started = false;
                    }
                    // }
                break;
                case 3:
                    // {
                    cam.x = levelW-halfW;
                    canvas.style.left = partsCanvas.style.left = windPartsCanvas.style.left = backBlocks.style.left = (this.left-levelW)+'px';
                    nCanvas.style.left = (this.left)+'px';
                    tutorial.pos.x += (600-this.left)/7;
                    storyTeller.x += (600-this.left)/7;
                    this.left += (600-this.left)/7;
                    
                    if (this.left > 597) {
                        p.frozen = false;
                    } else {
                        p.pos.x = this.left+levelW-width-25;
                    }
                    
                    if (this.left > 599) {
                        nCanvas.style.left = '600px';
                        this.active = false;
                        this.started = false;
                    }
                    // }
                break;
            }
        },
    };
    function updateGraphics() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        bCtx.clearRect(0, 0, backBlocks.width, backBlocks.height);
        
        // Banners
        switch(levelNum) {
            case 29:
                ctx.drawImage(banner, 300-30, levelH/2+60);
            break;
            case 42:
                ctx.drawImage(banner, 300-30, levelH/2-60);
            break;
            case 45:
                ctx.drawImage(banner, 300-30, levelH/2+130);
            break;
            case 49:
                ctx.drawImage(banner, 300-30, levelH/2-60);
            break;
            case 51:
                ctx.drawImage(banner, levelW/2-30, levelH/2-200);
            break;
            // Upper path
            case 34:
                ctx.drawImage(banner, 300-30, levelH/2-20);
            break;
            case 36:
                ctx.drawImage(banner, 250-30, levelH/2-50);
            break;
            case 40:
                ctx.drawImage(banner, 440-30, levelH-300);
            break;
            case 65:
                ctx.drawImage(banner, 310, 245);
            break;
            case 66:
                ctx.drawImage(banner, 310, 245);
            break;
        }
        
        for (let i in level) {
            level[i].display?.();
        }
        for (let y = 0; y < levels[levelNum].length; y ++) {
            for (let x = 0; x < levels[levelNum][y].length; x ++) {
                if (!isNaN(+levels[levelNum][y][x]) && levels[levelNum][y][x] !== ' ')  ctx.drawImage(oldTime, x*40, y*40);
                if (levels[levelNum][y][x] === 'c') {
                    ctx.drawImage(checkPoint.canvas, x*40, y*40)
                }
                
                if (levels[levelNum][y][x] === 's') {
                    bCtx.fillStyle = 'rgb(230, 230, 230)'
                    bCtx.fillRect(x*40, y*40, 40, 40);
                    // ctx.fillRect(x*40+10, y*40, 20, 40);
                }
            }
        }
        
        if (arguments[0]) return;
        // Why didn't I think to use 'switch'?
        if (!levelNum) {
            ctx.textAlign = 'center';
            ctx.fillStyle = 'rgb(199, 47, 24)';
            ctx.font = "30px Tinos";
            ctx.fillText("The", halfW-120, 250);
            ctx.font = "90px Tinos";
            ctx.fillText("Great Halls", halfW, 300);
            
            if (!tToggles.intro) {
                selected = 0;
                tutorial.next(blanks[0].index);
            }
            
            if (tToggles.doPopup && !tToggles.dvmsg) {
                selected = 7;
                
                tToggles.dvmsg = true;
                tutorial.startUp(550, levelH-665);
                tutorial.dashToggle = true;
            }
        }
        if (levelNum === 1 && tutorial.message === 5 && !tToggles.world) {
            tToggles.intro = true;
            selected = 1;
            tRight = false;
            tToggles.come2 = true;
            tutorial.startUp(levelW+404, height-65);
        }
        if (levelNum === 2 && tutorial.message === 7 && !tToggles.fall) {
            selected = 2;
            tRight = false;
            tToggles.come2 = true;
            tutorial.startUp(levelW-60+600, height-65);
        }
        if (levelNum === 3) {
            ctx.textAlign = 'center';
            ctx.fillStyle = 'rgb(199, 47, 24)';
            ctx.font = "30px Tinos";
            ctx.fillText("The", halfW, 330);
            ctx.font = "90px Tinos";
            ctx.fillText("Catacombs", halfW, 380);
        }
        if (levelNum === 4 && !tToggles.checkpoint) {
            selected = 3;
            tutorial.startUp(1080, height-145);
        }
        if (levelNum === 9) {
            ctx.drawImage(pillar, 210, 200);
        }
        if (levelNum === 10) {
            ctx.drawImage(pillar, 170, 520);
        }
        if (levelNum === 51){// && !tToggles.dive) {
            ctx.drawImage(pillar, 750, 400);
        }
        ctx.textBaseline = 'alphabetic'
        if (levelNum === 20) {
            ctx.textAlign = 'center';
            ctx.fillStyle = 'rgb(199, 47, 24)';
            ctx.font = "30px Tinos";
            ctx.fillText("The", halfW+23-15, 335-100-5);
            ctx.font = "109px Tinos";
            ctx.fillText("E", halfW-35-13, 380-100);
            ctx.font = "90px Tinos";
            ctx.fillText("r", halfW+15-15, 380-100);
            ctx.fillText("g", halfW+54-15, 380-100);
        }
        if (levelNum === 26) {
            storyTeller.x = 310-(transLevel.dir === null ? 0 : transLevel.dir-2)*600;
            storyTeller.y = 490;
            ctx.fillStyle = 'rgb(36, 36, 36)';
            ctx.fillRect(305,515, 35, 5);
            ctx.fillRect(420,515, 35, 5);
            ctx.fillStyle = 'rgb(150, 6, 6)';
            ctx.fillRect(310,490, 25, 25);
            if (tToggles.gotDash && storyTeller.message <= 27 && !tToggles.diveFirst) {
                storyTeller.next(27);
            }
            if (+fragments.textContent === 3) {
                storyTeller.next(storyTeller.messages.length-7);
            }
        } else {
            storyTeller.y = -1000;
        }
        if (levelNum === 28) {
            ctx.drawImage(pillar, 150, 480);
        }
        if (levelNum === 29) {
            ctx.textAlign = 'center';
            ctx.fillStyle = 'rgb(199, 47, 24)';
            ctx.font = "30px Tinos";
            ctx.fillText("The", halfW, 280);
            ctx.font = "90px Tinos";
            ctx.fillText("Keep", halfW, 330);
        }
        if (levelNum === 52) {
            tToggles.diveFirst = true;
        }
        if (levelNum === 56) {
            tToggles.doPopup = true;
            
            ctx.textAlign = 'center';
            ctx.fillStyle = 'rgb(199, 47, 24)';
            ctx.font = "30px Tinos";
            ctx.fillText("The", levelW/2-96, 280-80);
            ctx.font = "107px Tinos";
            ctx.fillText("F", levelW/2-150, 330-80);
            ctx.font = "90px Tinos";
            ctx.fillText("orgotten", levelW/2+21, 330-80);
            ctx.fillText("Network", levelW/2, 410-80);
            
            // Sign setup
            ctx.textAlign = 'left';
            ctx.textBaseline = 'top';
            ctx.font = "15px Tinos";
            ctx.lineWidth = 2;
            ctx.strokeStyle = 'rgb(36, 36, 36, 0.5)';
            ctx.fillStyle = 'rgb(36, 36, 36, 0.5)';
            
            // Signs
            ctx.roundedRect(30, 300, 62, 20, 4).stroke();
            ctx.fillText('The Erg', 30+5, 300+3);
            ctx.roundedRect(levelW/2-32.5, 50, 65, 20, 4).stroke();
            ctx.fillText('The Loft', levelW/2-32.5+5, 50+3);
            ctx.roundedRect(levelW-70-35, 300, 70, 20, 4).stroke();
            ctx.fillText('The Keep', levelW-70-35+5, 300+3);
            ctx.roundedRect(levelW/2-54, levelH-40-60, 108, 20, 4).stroke();
            ctx.fillText('The Great Halls', levelW/2-54+5, levelH-40-60+3);
        }
        if (levelNum === 62) {
            ctx.drawImage(pillar, 210+370, 520);
        }
        if (levelNum === 65) {
            levels[51] = [
                'bbbbbbbbbbbbbbbbbbbbbbb',
                'bbbbbbb         bbbbbbb',
                'bbbb               bbbb',
                'bb                   bb',
                'b                     b',
                'b                     b',
                'b                     b',
                'b                      ',
                '                       ',
                '                     bb',
                '                      b',
                'bbbbb             bbbbb',
                'bbbbb             bbbbb',
                'bbb                 bbb',
                'bb                   bb',
                'bb                   bb',
                'b                     b',
                'b                     b',
                'b                     b',
                'b                     b',
            ];
        }
        if (levelNum === 68) {
            tutorial.startUp(250-600, 300-5);
            
            tutorial.next(53);
        }
        if (levelNum === 70) {
            // Sign setup
            ctx.textAlign = 'left';
            ctx.textBaseline = 'top';
            ctx.font = "15px Tinos";
            ctx.lineWidth = 2;
            ctx.strokeStyle = 'rgb(36, 36, 36, 0.5)';
            ctx.fillStyle = 'rgb(36, 36, 36, 0.5)';
            
            ctx.roundedRect(32.5, 480, 65, 20, 4).stroke();
            ctx.fillText('The Loft', 32.5+5, 480+3);
            
            levels[0] = [
                'bbbbbbbbbbbbbbb',
                'bbbbb     bbbbb',
                'bbb         bbb',
                'bb           bb',
                'b             b',
                'b             b',
                'b              ',
                'b              ',
                'b             b',
                'b             b',
                'b              ',
                'b c            ',
                'bbbbb          ',
                'bbbbbbbb       ',
                'bbbbbbbbbb   bb',
            ];
        }
        if (levelNum === 73) {
            ctx.textAlign = 'center';
            ctx.fillStyle = 'rgb(199, 47, 24)';
            ctx.font = "30px Tinos";
            ctx.fillText("The", halfW-20, 335-150-5);
            ctx.font = "109px Tinos";
            ctx.fillText("L", halfW-55, 380-150);
            ctx.font = "90px Tinos";
            ctx.fillText("oft", halfW+25, 380-150);
        }
        if (levelNum === 75 && tToggles.gotCam) {
            selected = 8;
            tutorial.startUp(7*40-600+7.5, 600-6*40-25);
        }
        if (levelNum === 77 && tToggles.border) {
            selected = 9;
            tutorial.startUp(levelW/2+80, levelH-65-(transLevel.dir === 0 ? 600 : 0));
        }
        if (levelNum === 91) {
            ctx.drawImage(pillar, 460, 320);
        }
        if (levelNum === 109 && !tToggles.newPhoto) {
            tToggles.newPhoto = true;
            
        }
        if (levelNum === 118) {
            ctx.textAlign = 'center';
            ctx.fillStyle = 'rgb(199, 47, 24)';
            ctx.font = "30px Tinos";
            ctx.fillText("The", halfW-120+50, 250);
            ctx.font = "90px Tinos";
            ctx.fillText("Spire", halfW+50, 300);
        }
    }
    function createWorld() {
        if (levelNum === 104 && tToggles.newPhoto) {
            editLevel(104, [
                'bbbbbbbbbbbbbbb',
                'b             b',
                'b             b',
                'b             b',
                'b             b',
                'b             b',
                'b             b',
                'b             b',
                'b             b',
                'b             b',
                'b             b',
                'e              ',
                'e              ',
                'e              ',
                'b           bub',
            ]);
        }
        
        levelW = 0;
        levelH = 0;
        level = [];
        let newCP = false;
        const curLevel = levels[levelNum];
        for (let c = curLevel.length; c --;) {
            for (let r = curLevel[c].length; r --;) {
                if (curLevel[c].length > levelW) levelW = curLevel[c].length;
                
                const left = curLevel[c]?.[r-1],
                    right = curLevel[c]?.[r+1],
                    top = curLevel[c-1]?.[r],
                    bottom = curLevel[c+1]?.[r],
                    useCollide = left === ' ' || right === ' ' || top === ' ' || bottom === ' ' || left === 'c' || right === 'c' || top === 'c' || bottom === 'c' || left === 's' || right === 's' || top === 's' || bottom === 's' || left === '0' || right === '0' || top === '0' || bottom === '0' || left === 'u' || right === 'u' || top === 'u' || bottom === 'u' || left === 'e' || right === 'e' || top === 'e' || bottom === 'e' || left === 'v' || right === 'v' || top === 'v' || bottom === 'v'; // Checks if the block has non-collidable blocks on at least one side of it
                switch(curLevel[c][r]) {
                    default:
                        level.push(new Air({
                            x: r*40,
                            y: c*40,
                            w: 40,
                            h: 40,
                            grav: 0.2,
                        }));
                    break;
                    case 'b':
                        level.push(new Block({
                            x: r*40,
                            y: c*40,
                            w: 40,
                            h: 40,
                            z: 100,
                            collide: collide,
                            // collide: levelNum === 80 ? oppositeCollide : collide,
                            particleCall: function() {
                                if ((levelNum > 19 && levelNum <= 28 || levelNum === 53 || levelNum === 52) && this.y/40 >= 13 && levels[levelNum][this.y/40-1]?.[this.x/40] === ' ' && ((frameCount+this.x/4) % 50 === 0)) {
                                    windParticles.add(this.x+Math.random()*40, this.y+5, true);
                                }
                            },
                            col: 'rgb(36, 36, 36)',
                        }));
                    break;
                    case 'd':
                        level.push(new Block({
                            x: r*40,
                            y: c*40,
                            w: 40,
                            h: 40,
                            z: 2,
                            collide: softCollide,
                            particleCall: function() {
                                if (Math.random() < 0.003) {
                                    softAmbientParticles.add(this.x, this.y);
                                }
                            },
                            col: 'rgb(36, 36, 36)',
                        }));
                    break;
                    case 'l':
                        level.push(new Block({
                            x: r*40,
                            y: c*40,
                            w: 40,
                            h: 40,
                            z: 1,
                            collide: lavaCollide,
                            particleCall: function() {
                                if (Math.random() < 0.01 && this.y-cam.y+halfH > 0 && this.y-cam.y+halfH < height && (levels[levelNum][this.y/40-1][this.x/40] === ' ' || levels[levelNum][this.y/40-1][this.x/40] === '0')) {
                                    lavaParticles.add(this.x+Math.random()*40, this.y);
                                }
                            },
                            col: 'rgb(226,46,8)',
                        }));
                    break;
                    case 'c':
                        curCP = new CheckPoint({
                            x: r*40,
                            y: c*40,
                            wx: worldX,
                            wy: worldY,
                        });
                        newCP = true;
                        
                        if (firstFrame || levelNum === 26) {
                            savedCP = curCP;
                        }
                    break;
                    case 'u':
                        level.push(new Ladder({
                            x: r*40,
                            y: c*40,
                            w: 40,
                            h: 40,
                            z: 101,
                        }));
                    break;
                    case 'e':
                        level.push(new Erase({
                            x: r*40,
                            y: c*40,
                            w: 40,
                            h: 40,
                            z: 101,
                        }));
                    break;
                    case '0': // Tinted air
                        level.push(new Air({
                            x: r*40,
                            y: c*40,
                            w: 40,
                            h: 40,
                            grav: 0.2,
                        }));
                    break;
                    case '1': // Tinted block
                        level.push(new Block({
                            x: r*40,
                            y: c*40,
                            w: 40,
                            h: 40,
                            z: 100,
                            collide: collide,
                            col: 'rgb(36, 36, 36)',
                        }));
                    break
                    case '2': // Tinted lava
                        level.push(new Block({
                            x: r*40,
                            y: c*40,
                            w: 40,
                            h: 40,
                            z: 1,
                            collide: lavaCollide,
                            col: 'rgb(226,46,8,255)',
                        }));
                    break;
                    case '3': // Tinted soft
                        level.push(new Block({
                            x: r*40,
                            y: c*40,
                            w: 40,
                            h: 40,
                            z: 2,
                            collide: softCollide,
                            particleCall: function() {
                                if (Math.random() < 0.003) {
                                    softAmbientParticles.add(this.x, this.y);
                                }
                            },
                            col: 'rgb(36, 36, 36)',
                        }));
                    break;
                }
                if (!useCollide) level[level.length-1].collide = void(0);
            }
            if (!newCP) {
                curCP = {};
            }
        }
        level.sort(function(a, b) {
            return b.z-a.z;
        });
        levelW *= 40;
        levelH = curLevel.length*40;
        canvas.width = levelW;
        canvas.height = levelH;
        partsCanvas.width = levelW;
        partsCanvas.height = levelH;
        windPartsCanvas.width = levelW;
        windPartsCanvas.height = levelH;
        backBlocks.width = levelW;
        backBlocks.height = levelH;
        
        updateGraphics(arguments[0]);
    }
    function getNextLevel() { // Gets which room to go to and if it's a fast travel point, also update the world position
        const worldPos = world[worldY][worldX];
        levelNum = typeof worldPos === 'object' ? (function() {
            [worldX, worldY] = worldPos;
            return world[worldY][worldX];
        })() : worldPos;
    }
    function editLevel(index, value, ...args) {
        if (!args.length) {
            levels[index] = value;
            oLevels[index] = value;
        } else {
            let parts = levels[levelNum][args[1]].slice(0, args[0])+value+levels[levelNum][args[1]].slice(args[0]+1);
            levels[index][args[1]] = parts;
            oLevels[index][args[1]] = parts;
        }
    }
    function addLevel(lvl, line, data) {
        const obj = JSON.parse(localStorage.getItem(lvl) || '{}');
        
        const lvls = JSON.parse(localStorage.getItem('lvls') || '[]');
        if (!lvls.includes(lvl)) {
            lvls.push(lvl);
            localStorage.setItem('lvls', JSON.stringify(lvls));
        }
        
        obj[line] = data;
        localStorage.setItem(lvl, JSON.stringify(obj));
    }
    function getLevel(lvl) {
        return JSON.parse(localStorage.getItem(lvl) || {});
    }
    function removeAll() {
        for (const i in localStorage) {
            if (typeof +i === 'number') {
                localStorage.removeItem(i);
            }
        }
    }
    
    !function() { // Compaction
        const lvls = JSON.parse(localStorage.getItem('lvls') || '[]');
        for (const i of lvls) {
            const lines = JSON.parse(localStorage.getItem(i) || {});
            
            for (const j in lines) {
                levels[i][j] = lines[j];
            }
            // console.log(lvls[i]);
        }
    }();
    
    
    let tLeft, tRight, tUp, tDown, tDash;
    const tutorial = Object.assign({}, p); // This copies all of the properties in 'p' over to a blank object. This basically creates a second player
    tutorial.active = true;
    tutorial.canvas = document.getElementById('tutorial-canvas');
    tutorial.ctx = tutorial.canvas.getContext('2d');
    tutorial.messages = document.getElementsByClassName('message');
    tutorial.message = localStorage.getItem('message') === null ? 0 : +localStorage.getItem('message');
    for (let i = 0; i < tutorial.messages.length; i ++) {
        const el = tutorial.messages[i];
        el.style.display = 'none';
    }
    
    tutorial.isp = false;
    tutorial.pos = localStorage.getItem('tPos') === null ? vector(480, height-65) : JSON.parse(localStorage.getItem('tPos'));
    [tutorial.wx, tutorial.wy] = localStorage.getItem('twPos') === null ? [0, 8] : JSON.parse(localStorage.getItem('twPos')).arr;
    tutorial.next = function(num) {
        this.active = true;
        this.messages[this.message].style.animationDelay = '0s';
        this.messages[this.message].style.animationName = 'fadeOut';
        if (!isNaN(+num) && num !== undefined) {
            this.message = num;
        } else {
            this.message ++;
        }
        this.messages[this.message].style.animationDelay = '0.2s';
        this.messages[this.message].style.animationName = 'fadeIn';
    };
    tutorial.run = function() {
        const div = this.messages[this.message]
        div.style.left = -cam.x+halfW+this.pos.x-window.getComputedStyle(div).width.slice(0, -2)-10+shakeX+'px';
        div.style.top = -cam.y+halfH+this.pos.y-window.getComputedStyle(div).height.slice(0, -2)-10+shakeY+'px';
        if (this.message === 17 && !tToggles.jumpKnow) {
            tToggles.jumpKnow = true;
            tUp = true;
            window.setTimeout(function() {
                tLeft = true;
            }, 300);
            window.setTimeout(function() {
                tUp = true;
            }, 350);
        }
        
        if (this.message === 5 || this.message === 7) tRight = true;
        
        if (worldX !== this.wx || worldY !== this.wy) {
            this.active = false;
            this.canvas.style.display = div.style.display = 'none';
        } else  {
            this.active = true;
            this.canvas.style.display = 'block';
            if (div.textContent !== 'blank') div.style.display = 'block';
        }
    };
    tutorial.startUp = function(x, y) {
        this.active = true;
        this.velocity.x = this.velocity.y = 0;
        this.pos.x = x;
        this.pos.y = y;
        this.wx = worldX;
        this.wy = worldY;
        this.next(blanks[selected].index);
    };
    tutorial.update = function() {
        if (!this.dashing && !p.frozen) this.velocity = vector.add(this.velocity, this.acceleration);
        if (this.yPause && !this.deeping && !this.bounce) {
            this.velocity.y = 0;
        }
        if (this.velocity.x > 5 && !this.dashing) this.velocity.x = 5;
        if (this.velocity.x < -5 && !this.dashing) this.velocity.x = -5;
        if (this.velocity.y > 15 && !this.deeping) {
            this.velocity.y = 15
        }
        if (this.pos.x < levelW && this.pos.x > 0) {
            this.acceleration = vector(0, this.inAir ? 0.2 : 0);
        } else {
            this.acceleration = vector(0, 0);
            this.velocity.y = 0;
        }
        if (((tLeft && this.left) || (tRight && this.right))) {
            if (this.velocity.y > 0.8 && !this.deeping) {
                this.velocity.y = 0.8;
            }
            this.climbing = true;
        } else {
            this.climbing = false;
        }
        
        if (!this.dashing) {
            if (tLeft) {
                this.acceleration.x = -0.7;
                this.camDir = -1;
            }
            if (tRight) {
                this.acceleration.x = 0.7;
                this.camDir = 1;
            }
            if (tUp) {
                tUp = false;
                if (this.coyoteTime > 0) {
                    window.setTimeout(function() {
                        tUp = false;
                    }, 490);
                    this.jumped = true;
                    this.coyoteTime = 0;
                    this.velocity.y = -5.8;
                    this.jump = false;
                    for (let i = 0; i < 50; i ++) {
                        jumpParticles.add(this.pos.x+this.velocity.x, this.pos.y+this.velocity.y);
                    }
                    if (Math.abs(this.velocity.x) > 1) {
                        for (let i = 0; i < 5; i ++) {
                            runParticles.add(this.pos.x+this.velocity.x, this.pos.y+this.velocity.y);
                        }
                    }
                    
                } else if (this.double > 0 && !this.jumped && !this.deeping) {
                    this.double --;
                    this.velocity.y = -5.8;
                    if (this.climbing) this.velocity.x = -this.camDir*10
                }
            }
            if (!tLeft && !tRight && !this.dashing || this.deeping) this.velocity.x /= 1.3;
            
            if (tDash && this.dashToggle && this.inAir && !this.dashing) { // If the player wants to dash, has a dash stored, and in air
                this.dashToggle = false;
                this.dashing = true;
                this.velocity.x = this.camDir*20;
                this.dashingTimer = 5;
                this.deeping = false;
            }
            if (this.dashing) { // Through the snow
                this.velocity.y = 0;
                if (!--this.dashingTimer) {
                    this.dashing = false;
                }
            }
            if (tDown && this.deepToggle && this.inAir && !this.deeping && !this.bounce) { // If the player wants to deepening dive, has a deepening dive stored, and in air
                this.deepToggle = false;
                this.deeping = true;
                this.velocity.y = 20.000001;
                this.dashing = false;
            }
            if (!tUp) this.jumped = false;
        }
    };
    tutorial.next(tutorial.message);
    
    delete tutorial.die; // The tutorial shouldn't ever die, so, I'm deleting this incase of a glitch
    
    const chaser = {
        log: [],
        pos: p.pos,
        pPos: p.pos,
        velocity: vector(0, 0),
        canvas: document.getElementById('chaser-canvas'),
        ctx: document.getElementById('chaser-canvas').getContext('2d'),
        toggle: true,
        done: false,
        display: function() {
            const stretch = this.velocity.y/2 > 3 ? 3 : this.velocity.y/2;
            const squash = this.velocity.y/2 > 1.5 ? 1.5 : this.velocity.y/2;
            const tilt = this.velocity.x > 13 ? 13 : this.velocity.x < -13 ? -13 : this.velocity.x
            
            // this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height);
            // this.ctx.fillStyle = 'rgb(36, 36, 36)';
            // this.ctx.beginPath();
            // this.ctx.moveTo(-squash/2-cam.x+halfW+this.pos.x+shakeX, 15-stretch/2+25+this.pos.y-15-cam.y+halfH+shakeY);
            // this.ctx.lineTo(-squash/2+tilt-cam.x+halfW+this.pos.x+shakeX, 15+stretch+this.pos.y-15-cam.y+halfH+shakeY);
            // this.ctx.lineTo(25+squash+tilt-cam.x+halfW+this.pos.x+shakeX, 15+stretch+this.pos.y-15-cam.y+halfH+shakeY);
            // this.ctx.lineTo(squash+25-cam.x+halfW+this.pos.x+shakeX, 15-stretch/2+25+this.pos.y-15-cam.y+halfH+shakeY);
            // this.ctx.fill();
        },
        updatePos: function() {
            if (this.log.length === 120) {
                shakes.push(new Shake(10));
                
                editLevel(118, 
[
    '             bsbblllbssbssbsssbbbb         ',
    '             bssssssbsssssbsssbbb          ',
    '              bssssssbbbblssssbb           ',
    '               bssssssssssssssb            ',
    '                bsssssssssssssb            ',
    '                bsbslsssssssssb            ',
    '                bsssssssssssssb            ',
    '                bsssssssssssssb            ',
    '                bsssssssssbsssb            ',
    '                bsssssssssssssb            ',
    '                bsssssbbssssssb            ',
    '                bs   ssss   ssb            ',
    '                b     ss     sb            ',
    '                b     ss  c  sb            ',
    'bbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbllbbbbb',
    'bbbb     bbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbb',
    'bb         bbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbb',
    'blllllllllllbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbb',
    'blllllllllllbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbb',
]);
                createWorld();
                // savedCP.run(true);
                
                poundParticles.extra2 = 5;
                poundParticles.extra(false, vector(16*40, 13.3*40));
            }
            if (this.log.length === 70 && tToggles.noChaserAdd) {
                p.cutscene = false;
                tToggles.noChaserAdd = false;
            }
            
            if (this.log.length > 70) {
                this.pos = this.log.shift();
                this.velocity = vector.sub(this.pos, this.pPos);
                this.pPos = this.pos;
                if (playerIn({
                    x: this.pos.x,
                    y: this.pos.y,
                    w: 25,
                    h: 25,
                })) {
                    p.die();
                    this.log.length = 0;
                    this.velocity = vector(0, 0);
                }
            }
            if (this.toggle) {
                chaserParticles.add();
                chaserParticles.add();
                chaserParticles.add();
            } else {
                for (let i = 20; i --;) {
                    chaserParticles.add('This is');
                    chaserParticles.add('how I tell');
                    chaserParticles.add('it to explode');
                }
                delete this.updatePos;
            }
            if (p.pos.y < levelH-60*4.5 && levelNum === 120 && !transLevel.active) this.toggle = false;
        }
    };
    
    storyTeller = {
        messages: document.getElementsByClassName('fire'),
        message: localStorage.getItem('story message') === null ? 0 : +localStorage.getItem('story message'),
        x: localStorage.getItem('story pos') === null ? 310+600*13 : JSON.parse(localStorage.getItem('story pos')).x,
        y: localStorage.getItem('story pos') === null ? 490 : JSON.parse(localStorage.getItem('story pos')).y,
        run: function() {
            const div = this.messages[this.message];
            div.style.left = this.x-window.getComputedStyle(div).width.slice(0, -2)+-37+shakeX+'px';
            div.style.top = this.y-window.getComputedStyle(div).height.slice(0, -2)-16+shakeY+'px';
        },
        next: function(num) {
            this.messages[this.message].style.animationDelay = '0s';
            this.messages[this.message].style.animationName = 'fadeOut';
            if (!isNaN(+num) && num !== undefined) {
                this.message = num;
            } else {
                this.message ++;
            }
            if (this.messages[this.message].textContent == 'blank') {
                this.messages[this.message].style.display = 'none';
            }
            this.messages[this.message].style.animationDelay = '0.2s';
            this.messages[this.message].style.animationName = 'fadeIn';
        },
    };
    storyTeller.next(storyTeller.message);
    
    activate = function(yes) {
        tToggles.started = true;
        if (!tToggles.skipped) {
            if (!yes) {
                
                tutorial.canvas.style.display = 'none';
                tutorial.messages[tutorial.message].style.animationName = 'fadeOut';
                window.setTimeout(function() {
                    tutorial.messages[tutorial.message].style.display = 'none';
                    tutorial.message ++;
                }, 200);
                tutorial.active = false;
                tToggles.skipped = true;
                for (let i = 0; i < 25; i += 5) {
                    for (let j = 0; j < 25; j += 5) {
                        // Loops are much slower so I just called it 3 times here because it isn't too much of a hassle to do
                        deathParticles.add(tutorial.pos.x+j+3, tutorial.pos.y+i+3);
                        deathParticles.add(tutorial.pos.x+j+3, tutorial.pos.y+i+3);
                        deathParticles.add(tutorial.pos.x+j+3, tutorial.pos.y+i+3);
                    }
                }
            } else {
                tutorial.next();
                blanks[0].index ++;
            }
        }
    }
    createWorld();
    
    let cam = vector(halfW, halfH);
    function follow() {
        if (p.pos.x-halfW < 15) {
            cam.x += (halfW-cam.x)/15;
        } else if (levelW-(p.pos.x+halfW) < 15) {
            cam.x += (levelW-halfW-cam.x)/15;
        } else {
            cam.x += (p.pos.x-cam.x)*0.1;
        }
        
        if (p.pos.y-halfH < 15) {
            cam.y += (halfH-cam.y)/15;
        } else if (levelH-(p.pos.y+halfH) < 15) {
            cam.y += (levelH-halfH-cam.y)/15;
        } else {
            cam.y += (p.pos.y-cam.y)*0.1;
        }
        
        if (transLevel.darkened && ((transLevel.dir % 2 === 1 ? cam.y < levelH-halfH+1 : false) || (transLevel.dir % 2 === 0 ? cam.x < levelW-halfW+1 : false))) {
            transLevel.darkened = false;
            back.style.backgroundColor = 'rgb(252, 252, 252)'
        }
    };
    
    let transZ = 0, rotX = 0, rotY = 0, abilityY = 700, billboards = document.getElementsByClassName('3d'), back = document.getElementById('back');
    
    const transAbility = {
        active: false,
        started: false,
        timer: 0,
        ability: 'double',
        run: function() {
            if (!this.started) {
                abilityY = 700;
                this.started = true;
                p.frozen = true;
                overlay.ctx.drawImage(windPartsCanvas, -cam.x+halfW, -cam.y+halfH);
                overlay.ctx.drawImage(backBlocks, -cam.x+halfW, -cam.y+halfH);
                overlay.ctx.drawImage(partsCanvas, -cam.x+halfW, -cam.y+halfH);
                overlay.ctx.drawImage(canvas, -cam.x+halfW, -cam.y+halfH);
                overlay.ctx.drawImage(pCanvas, p.pos.x-15-cam.x+halfW, p.pos.y-15-cam.y+halfH);
                transZ = rotX = rotY = 0;
                this.timer = 0;
                
                back.style.backgroundColor = 'rgb(36, 36, 36)'
                overlay.canvas.style.display = 'block';
                partsCanvas.style.display = 'none';
                windPartsCanvas.style.display = 'none';
                canvas.style.display = 'none';
                pCanvas.style.display = 'none';
                backBlocks.style.display = 'none';
                
                // nCanvas.style.display = 'none';
            }
            
            switch(this.ability) {
                case 'double':
                    jump.canvas.style.top = abilityY+'px';
                    jump.canvas.style.transform = 'perspective(10000px) translateZ('+transZ+'px) rotateX('+rotX+'deg) rotateY('+rotY+'deg)';
                break;
                case 'dash':
                    dash.canvas.style.top = abilityY+'px';
                    dash.canvas.style.transform = 'perspective(10000px) translateZ('+transZ+'px) rotateX('+rotX+'deg) rotateY('+rotY+'deg)';
                break;
                case 'dive':
                    dive.canvas.style.top = abilityY+'px';
                    dive.canvas.style.transform = 'perspective(10000px) translateZ('+transZ+'px) rotateX('+rotX+'deg) rotateY('+rotY+'deg)';
                break;
                case 'camera':
                    cameraIcon.canvas.style.top = abilityY+'px';
                    cameraIcon.canvas.style.transform = 'perspective(10000px) translateZ('+transZ+'px) rotateX('+rotX+'deg) rotateY('+rotY+'deg)';
                break;
            }
            if (this.timer < 50) {
                transZ += (-1000-transZ)/5;
                rotX += (-30-rotX)/5;
                rotY += (15-rotY)/5;
                abilityY += (501-abilityY)/7;
            } else if (this.timer < 110) {
                abilityY --;
            } else if (this.timer < 130) {
                transZ += (-transZ)/5;
                rotX += (-rotX)/5;
                rotY += (-rotY)/5;
            } else {
                this.active = false;
                this.started = false;
                p.frozen = false;
                overlay.canvas.style.display = 'none';
                partsCanvas.style.display = 'block';
                windPartsCanvas.style.display = 'block';
                canvas.style.display = 'block';
                pCanvas.style.display = 'block';
                backBlocks.style.display = 'block';
                switch(this.ability) {
                    case 'double':
                        jump.canvas.style.display = 'none';
                    break;
                    case 'dash':
                        dash.canvas.style.display = 'none';
                    break;
                    case 'dive':
                        dive.canvas.style.display = 'none';
                    break;
                }
                back.style.backgroundColor = 'rgb(252, 252, 252)'
                p.unlocked[this.ability] = true;
                window.setTimeout(this.tutorialStuff, 100);
            }
            
            overlay.canvas.style.transform = 'perspective(10000px) translateZ('+transZ+'px) rotateX('+rotX+'deg) rotateY('+rotY+'deg)';
            
            this.timer ++;
        },
    }
    if (localStorage.getItem('dev')) {
        tToggles.gotCam = true;
        p.unlocked.double = true;
        p.unlocked.dash = true;
        p.unlocked.dive = true;
        p.unlocked.camera = true;
    }
    
    if (tToggles.double || tToggles.dash || tToggles.dive) orbAlpha = 0;
    
    let camAbilityTrans = 1,
        abilityRotDir = 1,
        pastAbRot = Infinity,
        oTimer = 0,
        noTimer = 0,
        nnoTimer = 0; // I've forgotten my acronyms!
    
    function particles() {
        if ((!p.frozen || p.dead) && levelNum !== 27) {
            runParticles.run();
            jumpParticles.run();
            poundParticles.run();
            softBreakParticles.run();
            softAmbientParticles.run();
            lavaParticles.run();
            splashParticles.run();
        }
        if (!p.frozen && levelNum !== 27) {
            trailParticles.run();
        }
        flameParticles.run();
        deathParticles.run();
        windParticles.run();
        eraseParticles.run();
        ascendParticles.run();
        catacombsAmbientParticles.run();
        if (levelNum >= 118) chaserParticles.run();
    }
    
    tToggles.beginningOfTheEnd = !true;
    tToggles.noChaserAdd = !true;
    tToggles.done = false;
    tToggles.end = false;
    
    function loop() {
        if (!transAbility.active) frameCount ++;
        
        if (!transAbility.active) {
            windPartsCtx.fillStyle = 'rgb(255, 255, 255)';
            windPartsCtx.fillRect(0, 0, windPartsCanvas.width, windPartsCanvas.height);
            partsCtx.clearRect(0, 0, partsCanvas.width, partsCanvas.height);
        }
        if (levelNum === 74 && camAbilityTrans >= 0) {
            partsCtx.filter = `invert(85.9%) opacity(${camAbilityTrans*100}%)`;
            if (!savable) partsCtx.drawImage(cameraImg, 280+Math.cos(frameCount/50)*2, 240+Math.sin(frameCount/30)*5, 40, 40);
            partsCtx.filter = 'none';
            if (p.pos.x+25 > 280 && p.pos.x < 320 && p.pos.y+25 > 240 && p.pos.y < 280 && !transLevel.active && !p.unlocked.camera) {
                updateControls('camera');
                updateControls('photo');
                updateControls('reset');
                transAbility.active = true;
                transAbility.ability = 'camera';
                tToggles.gotCam = true;
            }
        }
        if (tToggles.gotCam && !transAbility.active) {
            camAbilityTrans -= 0.05;
        }
        
        if (!transLevel.active && !transAbility.active && !p.cutscene) follow();
        for (let s in shakes) {
            shakes[s].active(s);
        }
        // setPos(canvas, -cam.x+halfW+shakeX, -cam.y+halfH+shakeY);
        // setPos(partsCanvas, -cam.x+halfW+shakeX, -cam.y+halfH+shakeY);
        canvas.style.left = -cam.x+halfW+shakeX+'px';
        canvas.style.top = -cam.y+halfH+shakeY+'px';
        partsCanvas.style.left = -cam.x+halfW+shakeX+'px';
        partsCanvas.style.top = -cam.y+halfH+shakeY+'px';
        windPartsCanvas.style.left = -cam.x+halfW+shakeX+'px';
        windPartsCanvas.style.top = -cam.y+halfH+shakeY+'px';
        backBlocks.style.left = -cam.x+halfW+shakeX+'px';
        backBlocks.style.top = -cam.y+halfH+shakeY+'px';
        
        curCP.run?.();
        if (worldX === savedCP.wx && worldY === savedCP.wy && !transAbility.active) {
            flameParticles.add(savedCP.x+map(Math.random(), 0, 1, 10, 30), savedCP.y+30);
        }
        
        if ((!p.frozen || p.ascend) && !p.cutscene) p.update();
        
        p.jump = p.inAir = p.inLadder = p.left = p.right = false;
        let collided;
        for (let i = 0; i < level.length; i ++) {
            const block = level[i];
            if (!p.frozen && Math.abs(block.x/40-p.pos.x/40) < 1.5 && Math.abs(block.y/40-p.pos.y/40) < 1.5) { // If the Manhattan distance of the block and the player is less than 1.5, do the collision.
                const touchTop = block.collide?.(p, i);
                
                if (touchTop) {
                    collided = true;
                }
            }
            block.particleCall?.();
        }
        if (collided) {
            p.coyoteTime = 6;
            p.jump = true;
            p.dashToggle = true;
            p.deepToggle = true;
            p.jumped = false;
            p.double = 1;
        } else {
            p.coyoteTime --;
            p.inAir = true;
        }
        
        // Run particle systems
        if (!transAbility.active && levelNum !== 80) {
            particles();
        }
        if (!p.unlocked.double && levelNum === 11) {
            p.dashToggle = true;
        }
        
        partsCtx.save();
        switch(levelNum) {
            case 9:
                if (!gotTotem.feet) {
                    if (playerIn({
                        x: 210,
                        y: 200,
                        w: 40,
                        h: 80,
                    }) && !transLevel.active) {
                        
                        p.cutscene = true;
                        gotTotem.feet = true;
                        totemFeet();
                        totemConstruct.style.display = 'block';
                        totemConstruct.style.animationName = 'fadeIn'
                        fragments.textContent ++;
                        localStorage.setItem('totems', JSON.stringify(gotTotem));
                    }
                    
                    
                    partsCtx.fillStyle = 'rgb(36, 36, 36)';
                    partsCtx.beginPath();
                    partsCtx.ellipse(230+Math.cos(frameCount/50), 170+Math.sin(frameCount/30)*3*Math.sin(frameCount/100), 13+Math.cos((frameCount+2)/10)*3, 13+Math.sin(frameCount/15)*3, frameCount/40, 0, tau);
                    partsCtx.fill();
                    partsCtx.closePath();
                }
            break;
            case 10:
                if (!tToggles.double) {
                    partsCtx.translate(190+Math.cos(frameCount/50), 490+Math.sin(frameCount/30)*3);
                    partsCtx.rotate(Math.tan(frameCount/50));
                    partsCtx.drawImage(orb.canvas, -10, -10);
                    orbAlpha = 1;
                    
                    if (!transLevel.active && playerIn({
                        x: 170,
                        y: 470,
                        w: 40,
                        h: 80,
                    })) {
                        selected = 4;
                        tutorial.startUp(-25, 400);
                        tToggles.double = true;
                        transAbility.active = true;
                        transAbility.tutorialStuff = function() {
                            tRight = true;
                            window.setTimeout(() => {
                                tRight = false;
                            }, 900);
                        };
                    }
                } else if (orbAlpha > 0 && !transAbility.active) {
                    partsCtx.globalAlpha = orbAlpha;
                    partsCtx.translate(190+Math.cos(frameCount/50), 490+Math.sin(frameCount/30)*3);
                    partsCtx.rotate(Math.tan(frameCount/50));
                    partsCtx.drawImage(orb.canvas, -10, -10);
                    partsCtx.globalAlpha = 1;
                    orbAlpha -= 0.03;
                }
            break;
            case 28:
                if (!tToggles.dash) {
                    partsCtx.translate(170+Math.cos(frameCount/50), 450+Math.sin(frameCount/30)*3);
                    partsCtx.rotate(Math.tan(frameCount/50));
                    partsCtx.drawImage(orb.canvas, -10, -10);
                    orbAlpha = 1;
                    
                    if (!transLevel.active && playerIn({
                        x: 150,
                        y: 430,
                        w: 40,
                        h: 80,
                    })) {
                        updateControls('dash');
                        p.frozen = true;
                        tToggles.dash = true;
                        tToggles.gotDash = true;
                        selected = 5;
                        tutorial.startUp(325-(transLevel.dir-3)*600, -26);
                        transAbility.ability = 'dash';
                        transAbility.active = true;
                        transAbility.tutorialStuff = function() {
                            tLeft = false;
                            tutorial.pos = vector(400, -26);
                            tutorial.yPause = true;
                            tutorial.deeping = true;
                            tutorial.velocity.y = 20;
                        };
                    }
                } else if (orbAlpha > 0 && !transAbility.active) {
                    partsCtx.globalAlpha = orbAlpha;
                    partsCtx.translate(170+Math.cos(frameCount/50), 450+Math.sin(frameCount/30)*3);
                    partsCtx.rotate(Math.tan(frameCount/50));
                    partsCtx.drawImage(orb.canvas, -10, -10);
                    partsCtx.globalAlpha = 1;
                    orbAlpha -= 0.03;
                }
            break;
            case 51:
                if (!tToggles.dive) {
                    partsCtx.translate(770+Math.cos(frameCount/50), 360+Math.sin(frameCount/30)*3);
                    partsCtx.rotate(Math.tan(frameCount/50));
                    partsCtx.drawImage(orb.canvas, -10, -10);
                    orbAlpha = 1;
                    
                    if (!transLevel.active && playerIn({
                        x: 750,
                        y: 360,
                        w: 40,
                        h: 80,
                    })) {
                        updateControls('dive');
                        tutorial.dashToggle = true;
                        p.frozen = true;
                        selected = 6;
                        tToggles.dive = true;
                        p.velocity.x = 0;
                        transAbility.ability = 'dive';
                        transAbility.active = true;
                        window.setTimeout(() => {
                        
                        tutorial.startUp(p.pos.x, p.pos.y);
                        transAbility.tutorialStuff = function() {
                            tLeft = true;
                            window.setTimeout(() => {
                                tLeft = false;
                            }, 300);
                        };
                        }, 300);
                    }
                } else if (orbAlpha > 0 && !transAbility.active) {
                    partsCtx.globalAlpha = orbAlpha;
                    partsCtx.translate(770+Math.cos(frameCount/50), 360+Math.sin(frameCount/30)*3);
                    partsCtx.rotate(Math.tan(frameCount/50));
                    partsCtx.drawImage(orb.canvas, -10, -10);
                    partsCtx.globalAlpha = 1;
                    orbAlpha -= 0.03;
                }
            break;
            case 62:
                if (!gotTotem.fin) {
                    if (playerIn({
                        x: 580,
                        y: 480,
                        w: 40,
                        h: 80,
                    }) && !transLevel.active) {
                        
                        p.cutscene = true;
                        gotTotem.fin = true;
                        // totemBody();
                        totemFin();
                        totemConstruct.style.display = 'block';
                        totemConstruct.style.animationName = 'fadeIn'
                        fragments.textContent ++;
                        localStorage.setItem('totems', JSON.stringify(gotTotem));
                    }
                    
                    
                    partsCtx.fillStyle = 'rgb(36, 36, 36)';
                    partsCtx.beginPath();
                    partsCtx.ellipse(230+370+Math.cos(frameCount/50), 480+Math.sin(frameCount/30)*3*Math.sin(frameCount/100), 13+Math.cos((frameCount+2)/10)*3, 13+Math.sin(frameCount/15)*3, frameCount/40, 0, tau);
                    partsCtx.fill();
                    partsCtx.closePath();
                }
            break;
            case 91:
                if (!gotTotem.body) {
                    if (playerIn({
                        x: 420,
                        y: 280,
                        w: 40,
                        h: 80,
                    }) && !transLevel.active) {
                        
                        p.cutscene = true;
                        gotTotem.body = true;
                        totemBody();
                        totemConstruct.style.display = 'block';
                        totemConstruct.style.animationName = 'fadeIn'
                        fragments.textContent ++;
                        localStorage.setItem('totems', JSON.stringify(gotTotem));
                    }
                    
                    
                    partsCtx.fillStyle = 'rgb(36, 36, 36)';
                    partsCtx.beginPath();
                    partsCtx.ellipse(480+Math.cos(frameCount/50), 300+Math.sin(frameCount/30)*3*Math.sin(frameCount/100), 13+Math.cos((frameCount+2)/10)*3, 13+Math.sin(frameCount/15)*3, frameCount/40, 0, tau);
                    partsCtx.fill();
                    partsCtx.closePath();
                }
            break;
        }
        partsCtx.restore();
        
        if (!p.frozen) p.updatePos();
        p.display();
        if (p.cutscene) p.velocity.x /= 1.3, p.velocity.y += 0.2;
        
        if (p.pos.y < levelH-60*4.5 && levelNum === 120 && !transLevel.active && !tToggles.done) {
            // p.pos.x += (levelW/2+67-p.pos.x)/40;
            noTimer ++;
            if (p.velocity.y <= -1.5) {
                p.velocity.y /= 1.1;
            }
            if (!p.ascend) {
                p.ascend = true;
            }
            if (p.pos.y < levelH-60*5.5 && !p.burst) {
                p.burst = true;
                pCanvas.style.display = 'none';
                for (let i = 0; i < 24; i += 6) {
                    for (let j = 1; j < 24; j += 6) {
                        ascendParticles.add(p.pos.x+j+3, p.pos.y+i+3);
                        ascendParticles.add(p.pos.x+j+3, p.pos.y+i+3);
                        ascendParticles.add(p.pos.x+j+3, p.pos.y+i+3);
                    }
                }
                ascendParticles.run();
            }
            
            if (noTimer > 180+50) {
                p.velocity.y = 0;
                tToggles.end = true;
                overlay.ctx.fillStyle = 'rgb(36, 36, 36, 0.2)'
                overlay.ctx.fillRect(0, 0, width, height);
            }
            if (noTimer > 240+50 && noTimer < 480+90) {
                oCtx.clearRect(0, 0, width, height);
                oCtx.fillStyle = `rgb(36, 36, 36, ${oTimer})`
                oTimer += 0.2;
                oCtx.fillText('Welcome back.', width/2, height/2);
                oCtx.globalCompositeOperation = 'source-atop';
                spooksParticles.run();
                oCtx.globalCompositeOperation = 'source-over';
            }
            
            if (noTimer >= 480+90) {
                end.style.display = 'block';
                const grad = map((noTimer-(480+90) <= 75 ? (75-(noTimer-(480+90)))/75 : 0), 0, 1, 0, 1);
                
                oCtx.clearRect(0, 0, width, height);
                oCtx.fillStyle = `rgb(255, 255, 255, ${grad})`
                oCtx.fillRect(0, 0, width, height);
                if (!tToggles.setEndTime) document.getElementById('end-time').textContent = convertTime(+window.sessionStorage.getItem('st')), tToggles.setEndTime = true;
            }
            if (noTimer >= 555+90) tToggles.done = true;
        }
        
        
        if (tutorial.active && !tToggles.skipped && !transLevel.active) {
            tutorial.update();
        }
        tutorial.jump = tutorial.inAir = tutorial.left = tutorial.right = false;
        collided = false;
        if (tutorial.active) {
            for (let i = 0; i < level.length; i ++) {
                const block = level[i];
                if (Math.abs(block.x/40-tutorial.pos.x/40) < 1.5 && Math.abs(block.y/40-tutorial.pos.y/40) < 1.5) { // If the Manhattan distance of the block and the player is less than 1.5, do the collision.
                    const touchTop = block.collide?.(tutorial, i);
                    
                    if (touchTop) {
                        collided = true;
                    }
                }
            }
            if (collided) {
                tutorial.coyoteTime = 3;
                tutorial.jump = true;
                tutorial.dashToggle = true;
                tutorial.deepToggle = true;
                tutorial.jumped = false;
                tutorial.double = 1;
            } else {
                tutorial.coyoteTime --;
                tutorial.inAir = true;
            }
        }
        
        if (tToggles.beginningOfTheEnd && !tToggles.done) {
            chaser.display();
            chaser.updatePos?.();
        }
        
        if (levelNum === 67 && !tToggles.doneE && !tutorial.skipped) {
            if (!transLevel.active && p.pos.x < 200 && !tToggles.startE && !p.dead) {
                tToggles.startE = true;
                p.cutscene = true;
                tutorial.startUp(400, 295);
                if (!tToggles.middleE) {
                    tutorial.next(39);
                } else {
                    tutorial.next(44);
                    saxophoneNum ++;
                    oCanvas.style.animationName = 'fadeIn';
                }
                tutorial.canvas.style.animationName = 'fadeIn'
                
                while (spooksParticles.active.length !== 150) {
                    spooksParticles.add();
                }
            }
            if (tToggles.startE) {
                
                oCtx.save();
                oCtx.translate(0, -60);
                
                oCtx.clearRect(0, 0, width, height);
                oCtx.fillStyle = 'rgb(36, 36, 36)';
                // oCtx.fillRect(0, 280, width, 100);
                oCtx.font = 'bold 20px roboto-slab'
                for (let i = 0; i < saxophoneTalk[saxophoneNum].length; i ++) {
                    oCtx.fillText(saxophoneTalk[saxophoneNum][i], 300, 300+i*28-(saxophoneNum === 3 ? 10 : 0));
                }
                
                oCtx.globalCompositeOperation = 'source-atop';
                spooksParticles.run();
                oCtx.globalCompositeOperation = 'source-over';
                oCtx.restore();
            }
            
        }
        if (levelNum === 118) {
            if (p.pos.x > 1020 && p.pos.x < 1020+40 && p.pos.y > levelH - 6*40 && !p.cutscene && !tToggles.beginningOfTheEnd) {
                p.cutscene = true;
                tToggles.beginningOfTheEnd = true; // This is a pain to write out
                tToggles.noChaserAdd = true;
                for (let i = 0; i < 750; i += 5) {
                    chaser.log.push(vector(i,19*40-6*40+15));
                }
                for (let i = 0; i < 600; i += 5) {
                    chaser.log.push(vector(750,19*40-6*40+15));
                }
                for (let i = 750; i < p.pos.x; i += 5) {
                    chaser.log.push(vector(i,19*40-6*40+15));
                }
            }
            
            if (p.cutscene) {
                cam.x += (800-cam.x)/40;
            }
        }
        
        
        if (!tToggles.skipped) {
            if (tutorial.active) {
                tutorial.updatePos();
                tutorial.display();
            }
            tutorial.run();
        }
        
        storyTeller.run();
        if (storyTeller.message === storyTeller.messages.length-2) {
            oCtx.save();
            oCtx.translate(0, 190);
            oCtx.fillRect(310, 300, 25, 25);
            oCtx.fillStyle = 'rgb(36, 36, 36)';
            
            oCtx.globalCompositeOperation = 'source-atop';
            spooksParticles.run();
            oCtx.globalCompositeOperation = 'source-over';
            oCtx.restore();
        }
        if (storyTeller.message === 37 || storyTeller.message === 35) {
            final.style.display = 'block';
            nnoTimer ++;
            const grad = map((nnoTimer <= 75 ? (75-(nnoTimer))/75 : 0), 0, 1, 0, 1);
            
            oCtx.clearRect(0, 0, width, height);
            oCtx.fillStyle = `rgb(255, 255, 255, ${grad})`
            oCtx.fillRect(0, 0, width, height);
        }
        
        if (p.pos.x > levelW && worldX < world[0].length) {
            worldX ++;
            getNextLevel();
            transLevel.active = true;
            transLevel.dir = 1;
            transLevel.left = 600;
            transLevel.top = 0;
            transLevel.started = false;
            
            tToggles.came = true;
        } else if (p.pos.x+25 < 0 && worldX) {
            worldX --;
            getNextLevel();
            transLevel.active = true;
            transLevel.dir = 3;
            transLevel.left = 0;
            transLevel.top = 0;
            transLevel.started = false;
        }
        
        if (p.pos.y > levelH && worldY < world.length-1) {
            worldY ++;
            getNextLevel();
            transLevel.active = true;
            transLevel.dir = 2;
            transLevel.left = 0;
            transLevel.top = 600;
            transLevel.started = false;
        } else if (p.pos.y+25 < 0 && worldY) {
            worldY --;
            getNextLevel();
            transLevel.active = true;
            transLevel.dir = 0;
            transLevel.left = 0;
            transLevel.top = 0;
            transLevel.started = false;
        }
        
        if (transLevel.active) {
            transLevel.run();
        }
        if (transAbility.active) {
            transAbility.run();
        }
        
        timers();
    }
    if (loopTimer) window.clearInterval(loopTimer);
    var loopTimer = window.setInterval(loop, 1000/60);
    
    window.setInterval(function() {
        if (showTime.checked && !transAbility.active) {
            time.textContent = convertTime((+window.sessionStorage.getItem('st')).toFixed(1));
        }
        if (!tToggles.done) window.sessionStorage.setItem('st', (+window.sessionStorage.getItem('st'))+0.1);
    }, 100);
    
    firstFrame = false;
} catch(e) {}
</script>
    </body>
</html>
<!--You found the easter egg! Thank you for viewing my program-->